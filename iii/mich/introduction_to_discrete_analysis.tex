\documentclass{article}

\def\npart{III}
\def\nyear{2018}
\def\nterm{Michaelmas}
\def\nlecturer{Professor W.\ T.\ Gowers}
\def\ncourse{Introduction to Discrete Analysis}
\def\draft{Ongoing course, rough}
\usepackage{scalerel}
\usepackage{bbm}
\usepackage{chngcntr}
\input{header}

\DeclareMathOperator*{\E}{\scalerel*{\mathbb{E}}{\textstyle\sum}}
\newcommand{\1}[1]{\mathbbm{1}_{#1}}
\counterwithout{nthm}{section}
\DeclarePairedDelimiter\ceil{\lceil}{\rceil}
\DeclarePairedDelimiter\floor{\lfloor}{\rfloor}

\DeclareMathOperator{\osc}{osc}

% preamble

%\setcounter{section}{-1}

%\DeclarePairedDelimiter\ceil{\lceil}{\rceil}
%\DeclarePairedDelimiter\floor{\lfloor}{\rfloor}

%\newtheorem{manualtheoreminner}{Theorem}
%\newenvironment{manualtheorem}[1]{%
%    \renewcommand\themanualtheoreminner{#1}%
%    \manualtheoreminner
%}{\endmanualtheoreminner}

%\newcommand{\red}[1]{\textcolor{bred}{#1}}
%\newcommand{\green}[1]{\textcolor{bgreen}{#1}}
%\newcommand{\blue}[1]{\textcolor{bblue}{#1}}
%\newcommand{\yellow}[1]{\textcolor{byellow}{#1}}
%\newcommand{\orange}[1]{\textcolor{borange}{#1}}
%\newcommand{\purple}[1]{\textcolor{bpurple}{#1}}

% and here we go!

\begin{document}
\maketitle

\tableofcontents

\clearpage
\section{The discrete Fourier transform}
Let $N$ be some fixed positive integer. Write $\omega$ for $e^{\frac{2\pi i}{N}}$, and $\mathbb{Z}_N$ for $\mathbb{Z}/N\mathbb{Z}$.

\begin{defi}[Discrete Fourier transform]\hypertarget{def:dft}
  Let $f: \mathbb{Z}_N \to \mathbb{C}$.
  Given $r \in \mathbb{Z}_N$, define $\hat{f}(r)$ to be
  \begin{equation*}
    \frac{1}{N} \sum_{x \in \mathbb{Z}_N} f(x) \omega^{-r x}.
  \end{equation*}
\end{defi}

\begin{notation}
  From now on, we shall use notation $\E_{x \in \mathbb{Z}_N}$ for $\frac{1}{N} \sum_{x \in \mathbb{Z}_N}$, where the subscript is omitted when it is clear from context.
\end{notation}

Notice we can write
\begin{equation*}
  \hat{f}(r) = \E_x f(x) e^{-\frac{2 \pi i r x}{N}},
\end{equation*}
highlighting the similarity with the usual Fourier transform.

% say something about cyclic groups and well-definedness?
If we write $\omega_r$ for the function $x \mapsto \omega^{r x}$, and $\langle f, g \rangle$ for $\E_x f(x) \overline{g(x)}$, then $\hat{f}(r) = \langle f, \omega_r \rangle$.
Let us write $\| f \|_p$ for $\left(\E_x |f(x)|^p\right)^{\frac{1}{p}}$ and call the resulting space $L_p(\mathbb{Z}_N)$.

\paragraph{Important convention.} We use \emph{averages} for the `original functions' in `physical space' and \emph{sums} for their Fourier transforms in `frequency space'

% Lemma 1.
\begin{nlemma}[Parseval's identity]
  If $f,g: \mathbb{Z}_N \to \mathbb{C}$, then $\langle \hat{f}, \hat{g} \rangle = \langle f, g \rangle$.
\end{nlemma}
\begin{proof}
  \begin{align*}
    \langle \hat{f}, \hat{g} \rangle &= \sum_r \hat{f}(r) \overline{\hat{g}(r)} \\
                                     &= \sum_r (\E_x f(x) \omega^{-r x}) \overline{(\E_y g(y) \omega^{-r y})} \\
                                     &= \E_x \E_y f(x) \overline{g(y)} \sum_r \omega^{-r(x-y)} \\
                                     &= \E_x \E_y f(x) \overline{g(y)} \Delta_{xy} \\
                                     &= \E_x f(x) \E_y \overline{g(y)} \Delta_{xy} \\
                                     &= \E_x f(x) \overline{g(x)} = \langle f, g \rangle
  \end{align*}
  where
  \begin{equation*}
    \Delta_{xy} =
    \begin{cases}
      N & x = y \\
      0 & x \neq y.
    \end{cases} \qedhere
  \end{equation*}
   % reformat this...
\end{proof}

\begin{defi}[Convolution]\hypertarget{def:conv}
  The convolution $\widehat{f * g}(x)$ is defined to be \begin{equation*}\E_{y + z = x} f(y) g(z) = \E_y f(y) g(x-y).\end{equation*}
\end{defi}

\begin{nlemma}[Convolution identity]
  \begin{equation*}
    \widehat{\hyperlink{def:conv}{f * g}}(r) = \hat{f}(r) \hat{g}(r).
  \end{equation*}
\end{nlemma}
\begin{proof}
  \begin{align*}
    \widehat{f * g}(r) &= \E_x f * g(x) \omega^{-r x} \\
                       &= \E_x \E_{y + z = x} f(y) g(z) \omega^{- r x} \\
                       &= \E_x \E_{y + z = x} f(y) g(z) \omega^{- r y} \omega^{- r z} \\
                       &= \E_y f(y) \omega^{-r y} \E_z g(z) \omega^{-r z} = \hat{f}(r) \hat{g}(r). \qedhere
  \end{align*}
\end{proof}

\begin{nlemma}[Inversion formula]
  \begin{equation*}
    f(x) = \sum_r \hat{f}(r) \omega^{r x}
  \end{equation*}
\end{nlemma}
\begin{proof}
  \begin{align*}
    \sum_r \hat{f}(r) \omega^{r x} &= \sum_r \E_y f(y) \omega^{r (x-y)} \\
                                   &= \E_y f(y) \sum_r \omega^{r (x-y)} \\
                                   &= \E_y f(y) \Delta_{x y} = f(x). \qedhere
  \end{align*}
\end{proof}

Further observations:
\begin{itemize}
  \item If $f$ is real-valued, then $\hat{f}(-r) = \E_x f(x) \omega^{r x} = \overline{\E_x f(x) \omega^{- r x}} = \overline{\hat{f}(r)}$.
  \item If $A \subset \mathbb{Z}_n$, write $A$ (instead of $\1{A}$ or $\chi_A$) for the characteristic function of $A$.
    Then $\hat{A}(0) = \E_x A(x) = \frac{|A|}{N}$, the density of $A$.
  \item Also, $\|\hat{A}\|^2_2 = \langle \hat{A}, \hat{A} \rangle = \langle A, A \rangle = \E_x A(x)^2 = \E_x A(x) = \frac{A}{N}$.
\end{itemize}

Let $f : \mathbb{Z}_N \to \mathbb{C}$. Given $\mu \in \mathbb{Z}_N$ with $(\mu,N) = 1$, define $f_\mu(x)$ to be $f(\mu^{-1}x)$.
Then
\begin{align*}
  \hat{f_\mu}(r) &= \E_x f_\mu(x) \omega^{-r x} \\
                 &= \E_x f(x / \mu) \omega^{-r x}  \\
                 &= \E_x f(x) \omega^{- r \mu x}  \\
                 &= \hat{f}(\mu r).
\end{align*}

\subsection{Roth's Theorem}
\begin{nthm}
  For every $\delta > 0$, there exists $N$ such that if $A \subseteq \{1, \dotsc, N\}$ is a set of size at least $\delta N$ then $A$ must contain an arithmetic progression of length 3.
\end{nthm}
This is the $k=3$ case of Szemer\'{e}di's theorem.

Basic strategy: show that if $A$ has density $\geq \delta$ and no arithmetic progression of length 3, then there is a long arithmetic progression $P \subseteq \{1, \dotsc, N\}$ such that
\begin{equation*}
  |A \cap P| \geq (\delta + c(\delta)) |P|.
\end{equation*}
In particular, we have that $|P| \to \infty$ as $N \to \infty$.

The proof we give will produce a bound $\delta \geq \frac{C}{\log \log N}$, but this is not the best known.
If the bound was reduced to $\frac{1}{\log N}$, this produces a combinatorial proof of the fact that there are arbitrarily long arithmetic progressions in the primes.
The best known bound is $\frac{(\log \log N)^4}{\log N}$ by Thomas Bloom.
In the other direction, we know $e^{- \sqrt{\log N}}$ does not work.

% lecture 2
\begin{nlemma}
  Let $A, B, C \subset \mathbb{Z}_N$ have densities $\alpha, \beta, \gamma$, for $N$ odd.
  If $\max_{r \neq 0} |\hat{A}(r)| \leq \frac{\alpha(\beta \gamma)^\frac{1}{2}}{2}$ and $\frac{\alpha\beta\gamma}{2} > \frac{1}{N}$ then there exists $x,d \in \mathbb{Z}_N$ with $d \neq 0$ such that $(x, x+d, x+2d) \in A \times B \times C$.
\end{nlemma}
\begin{proof}
  \begin{align*}
    \E_{x,d} A(x) B(x+d) C(x+2d) &= \E_{\mathclap{x + z = 2y}} A(x) B(y) C(z) \\
                                 &= \E_u (\E_{x+z=u} A(x) C(z)) \E_{2y=u} B(y) \\
                                 &= \E_u (A * C)(u) B_2(u) = \langle A * C, B_2 \rangle \\
                                 &= \langle \widehat{A * C}, \hat{B} _2 \rangle \\
                                 &= \langle \hat{A} \hat{C}, \hat{B}_2 \rangle \\
                                 &= \sum_r \hat{A}(r) \hat{C}(r) \hat{B}(-2r) \\
                                 &= \alpha \beta \gamma + \sum_{r\neq 0} \hat{A}(r) \hat{C}(r) \hat{B}(-2r).
  \end{align*}
  We have a lower bound on the left term, so focus on the right.
  \begin{align*}
    \left| \sum_{r\neq0} \hat{A}(r) \hat{B}(-2r) \hat{C}(r) \right| &\leq \frac{\alpha(\beta\gamma)^\frac{1}{2}}{2} \sum_{r\neq0} |\hat{B}(-2r) \hat{C}(r)| \\
                                                      &\leq \frac{\alpha(\beta\gamma)^\frac{1}{2}}{2} \left(\sum_r |\hat{B}(-2r)|^2\right)^\frac{1}{2} \left(\sum_r |\hat{C}(r)|^2\right)^\frac{1}{2} \\
                                                      &= \frac{\alpha(\beta\gamma)^\frac{1}{2}}{2} \|\hat{B}\|_2 \|\hat{C}\|_2 = \frac{\alpha(\beta\gamma)^\frac{1}{2}}{2} \|B\|_2 \|C\|_2 \\
                                                      &= \frac{\alpha\beta\gamma}{2}.
  \end{align*}
  The contribution to $\E_{x,d} A(x) B(x+d) C(x+2d)$ from $d=0$ is at most $\frac{1}{N}$, so if $\frac{\alpha\beta\gamma}{2} > \frac{1}{N}$, we are done.
\end{proof}

Now let $A$ be a subset of $\{1, \dotsc, N\}$ of density $\geq \delta$ and let $B = C = A \cap (\frac{N}{3}, \frac{2N}{3}]$.
If $B$ has density $< \frac{\delta}{5}$, then either $A \cap [1, \frac{N}{3}]$ or $A \cap [\frac{2N}{3}, N]$ has density at least $\frac{2 \delta}{5}$.
So in that case we find an AP $P$ of length about $\frac{N}{3}$ such that $\frac{|A \cap P|}{|P|} \geq \frac{6 \delta}{5}$.

Otherwise, we find that if $\max_{r \neq 0} |\hat{A}(r)| \leq \frac{\delta^2}{10}$ and $\frac{\delta^3}{50} > \frac{1}{N}$ then $A \times B \times C$ contains a 3AP $\implies A$ contains a 3AP.
So if $A$ does not contain a 3AP, then either we find $P$ of length about $\frac{N}{3}$ with $\frac{|A \cap P|}{|P|} \geq \frac{6 \delta}{5}$ or $\exists r \neq 0$ such that $|\hat{A}(r)| \geq \frac{\delta}{10}$.

\begin{defi}
  If $X$ is a finite set and $f: X \to \mathbb{C}$, $Y \subseteq X$, write $\osc(f|_Y)$ to mean $\max_{y_1, y_2 \in Y} |f(y_1) - f(y_2)|$.
\end{defi}
\begin{nlemma}\label{lem:6}
  Let $r \in \hat{\mathbb{Z}}_n$ and let $\epsilon > 0$. Then there is a partition of $\{1,2,\dotsc,N\}$ into arithmetic progressions $P_i$ of length at least $c(\epsilon) \sqrt{N}$ such that $\osc(\omega_r|_{P_i}) \leq \epsilon$ for each $i$.
\end{nlemma}
\begin{proof}
  Let $t = \floor{\sqrt{N}}$. Of the numbers $1, \omega^r, \omega^{2r}, \dotsc, \omega^{tr}$ there must be two that differ by at most $\frac{2\pi}{t}$.
  If $|\omega^{ar} - \omega^{br}| \leq \frac{2\pi}{t}$ with $a < b$, then $|1 - \omega^{dr}| \leq \frac{2\pi}{t}$ where $d = b-a$.
  Now, by the triangle inequality, if $u < v$, then
  \begin{equation*}
    |\omega^{u rd} - \omega^{v r d}| \leq |\omega^{urd} - \omega^{(u+1) r d}| + |\omega^{urd} - \omega^{(u+1) r d}| + \dotsb + |\omega^{urd} - \omega^{(u+1) r d}| \leq \frac{2\pi}{t} (v-u).
  \end{equation*}
  So if $P$ is a progression with common difference $d$ and length $l$, then $\osc(\omega_r|_P) \leq \frac{2\pi l}{t}$.
  So divide up $\{1,\dotsc,N\}$ into residue classes mod $d$ and partition each residue class into parts of length between $\frac{\epsilon t}{4 \pi}$ and $\frac{\epsilon t}{2 \pi}$ (possible, since $d \leq t \leq \sqrt{N}$).
  We are done, with $c(\epsilon) = \frac{\epsilon}{16}$.
\end{proof}
Now let us use the information that $r \neq 0$ and $|\hat{A}(r)| \geq \frac{\delta^2}{10}$.
Define the balanced function $f$ of $A$ by $f(x) = A(x) - \frac{|A|}{N}$ for each $x$.

Note that $\hat{f}(0) = 0$ and $\hat{f}(r) = \hat{A}(r)$ for all $r \neq 0$.
Now let $P_1, \dotsc, P_m$ be given by \cref{lem:6} with $\epsilon = \frac{\delta^2}{20}$.
Then
\begin{align*}
  \frac{\delta^2}{10} = \frac{1}{N} \left| \sum_x f(x) \omega^{-rx} \right| &\leq \frac{1}{N} \sum_{i=1}^m \left|\sum_{x\in P_i} f(x) \omega^{-r x}\right| \\
                                                                      &\leq \frac{1}{N} \sum_{i=1}^m \left[\left|\sum_{x \in P_i} f(x) \omega^{-r x_i}\right| + \left|\sum_{x \in P_i} f(x) (\omega^{-r x} - \omega^{-r x_i})\right|\right] \\
                                                                      \shortintertext{where $x_i \in P_i$ is arbitrary }
                                                                      &\leq \frac{1}{N} \sum_{i=1}^m |\sum_{x \in P_i} f(x)| + \frac{\delta^2}{20}
                                                                      \shortintertext{So}
                                                                      \sum_{i=1}^N |\sum_{x \in P_i} f(x) | \geq \frac{\delta^2 N}{20}.
\end{align*}
Also,
\begin{equation*}
  \sum_{i=1}^m \sum_{x \in P_i} f(x) = 0.
\end{equation*}
So
\begin{equation*}
  \sum_{i=1} \left( |\sum_{x \in P_i} f(x)| )
\end{equation*}

\end{document}
