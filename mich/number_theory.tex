\documentclass{article}

\def\npart {II}
\def\nyear {2017}
\def\nterm {Michaelmas}
\def\nlecturer{Prof. A. Scholl}
\def\ncourse{Number Theory}
\input{header}
% preamble
\setcounter{section}{-1}
\newcommand{\legendre}[2]{\genfrac{(}{)}{}{}{#1}{#2}}
\newcommand{\SL}{\mathrm{SL}}
\DeclareMathOperator{\disc}{disc}
\DeclarePairedDelimiter\ceil{\lceil}{\rceil}
\DeclarePairedDelimiter\floor{\lfloor}{\rfloor}
\newtheorem*{note}{Note}
% and here We go!

\begin{document}
\maketitle
\tableofcontents

\clearpage

\section{Introduction}
Number theory is concerned with the (non-obvious, sometimes mysterious) properties of the integers, $\Z = \{0, \pm 1, \pm 2, \dots\}$ and the rationals, $\Q = \{\frac{m}{n} \mid m, n \in \Z, n \ne 0\}$.
It has been around for thousands of years, and has always been an experimental science where one can conduct experiments with numbers to spot their properties. Experimental data leads to conjectures which can turn out to be very hard to prove, for instance:
\begin{enumerate}
    \item Congruent number problem: Let $N \geq 1$ be an integer of the form $8n + 5$, $8n+6$ or $8n + 7$.
        Does there exist a right-angled triangle with sides of rational length, and area equal to $N$?
    \item Twin prime conjecture: Does there exist infinitely many primes $p$ such that $p+2$ is also prime?
        Very recently, we know there are infinitely many primes $p$ such that $\{p+2, p+4, \dots, p+246\}$ contains a prime.
    \item $\pi(x)$ refers to the prime counting function, the number of prime numbers $p \leq x$.
        The prime number theorem says that $\pi(x) \sim \mathrm{li}(x) \coloneqq \int_2^x \frac{dt}{\log t}$.
        It is not known whether or not $\abs{\pi(x) - \mathrm{li}(x)} \leq \sqrt{x} \log(x)$, which is equivalent to the Riemann hypothesis - a statement about a certain complex analytic function.
\end{enumerate}
Problem 1 follows from the Birch-Swinnerton-Dyer conjecture, related to algebraic geometry.
Often these proofs can require sophisticated theorems, well beyond the statement of the problem.
\clearpage

\section{Euclid's algorithm and factoring}
\begin{defi}[\hypertarget{def:divisionAlg}Division algorithm]
    Given $a, b \in \Z$, with $b > 0$, there are $q, r \in \Z$ with $0 \leq r < b$ and $a = b q + r$, that is, we can divide $a$ by $b$ to give a quotient $q$ and remainder $r$.
\end{defi}

\begin{proof}
    Let $S = \set{a - n b \mid n \in \Z}$, which certainly contains some non-negative integers. Let $r$ be the least of them  which exists by the well ordering property of the non-negative integers.  Claim $r < b$, since if not then $r - b \in S$, and $r - b \geq 0$, contradicting the choice of $r$.
\end{proof}

\begin{notation}
    If $r = 0$ (that is, $a = bq$ for some $q \in \Z$), write $b \mid a$ (read as `$b$ divides $a$'), otherwise write $b \nmid a$.
\end{notation}

Given $a_1, \dots, a_n \in \Z$ not all zero, let
\begin{equation*}
    I = \{\lambda_1 a_1 + \dots + \lambda_n a_n \mid \lambda_i \in \Z\}
\end{equation*}

We recognise this from GRM as the ideal generated by $\{a_1, \dots, a_n\}$.
Note if $a, b \in I$, for any choice $l, m \in \Z$ then $l a + m b \in I$.

\begin{nlemma}\label{lem:pid_lemma}
    $I = d \Z = \{\lambda d \mid \lambda \in \Z\}$ for some $d \leq 1$, clearly unique.
\end{nlemma}

\begin{proof}
    As not all of $a_i$ are $0$, $I$ contains some positive integer, let $d$ be the least of them.  So, $d \in I$, and hence $d \Z \subset I$.
    On the other hand, for $a \in I$ the \hyperref{def:divisionAlg}{division algorithm} gives us $a = qd + r$ with $0 \leq r < d$. But then $r = a - dq \in I$ so by minimality of $d$ we have $r = 0$, and so $a \in d \Z$, giving $I \subset d \Z$ as required.
\end{proof}

\begin{defi}[\hypertarget{def:gcd}Greatest common divisor]
    $a_i \in I = d \Z$ so $d \mid a_i$.
    If in addition, we have that $\forall i, \, e \mid a_i$, then $e$ divides every element of $I$, so $e \mid d$.
    Write $d = \gcd(a_1, \dots, a_n) = (a_1, \dots, a_n)$, the \textbf{greatest common divisor} (alternatively the highest common factor).
\end{defi}

The study of \textbf{Diophantine equations} involves solving equations with integer solutions, and may have more variables than equations.  The simplest case is is linear in two variables, and can be solved easily.
\begin{cor}
    Let $a, b, c \in \Z$ with not both $a, b$ equal to $0$.  Then we can find $x, y \in \Z$ such that ${a x + by = c \Leftrightarrow (a, b) \mid c}$.
\end{cor}
The definition of the greatest common divisor given here is non-constructive, but \textbf{Euclid's algorithm} is an efficient way to compute it.

\paragraph{Euclid's algorithm}
Assume $a > b > 0$. Apply successively the \hyperlink{def:divisionAlg}{division algorithm}:
\begin{align*}
    a &= q_1 b + r_1 & 0 \leq r_1 < b\\
    b &= q_2 r_1 + r_2 & 0 \leq r_2 < b\\
    r_1 &= q_3 r_2 + r_3 & 0 \leq r_3 < b\\
    \vdots \\
    r_{k-2} &= q_k r_{k-1} + r_k & 0 \leq r_k < b\\
    r_{k-1} &= q_{k+1} r_k + 0
\end{align*}
for some $k$, so $r_k \mid r_{k-1}$
We claim $r_k = (a, b)$. Indeed, $(a, b) = (a - q_1 b, b) = (b, r_1) = (r_1, r_2) = \dots = (r_{k-1}, r_k) = r_k$.
\begin{remark}
     By \cref{lem:pid_lemma}, $(a, b) = r a + s b$ for some integers $r, s$. Euclid's algorithm gives such $r, s$.
\end{remark}

Recall that if $n > 1$ then $n$ is \textbf{prime} if its only positive divisors are $\{1, \dots, n\}$, otherwise $n$ is \textbf{composite}.
\begin{nlemma}
    Let $p$ be prime, $a, b \in \Z$.  Then $p \mid ab \implies p \mid a$ or $p \mid b$.
\end{nlemma}

\begin{proof}
    Suppose $p \mid ab$, $p \nmid a$. Then $\gcd(a, b) \ne p$, so it must be $1$. So $\exists r, s \in \Z$ such that $ar + ps = 1$.
    Therefore, $b = (ab) r + p(bs)$, and hence $p \mid b$.
\end{proof}

This lets us prove the fundamental theorem of arithmetic.
\begin{thm}[Fundamental theorem of arithmetic]
    Every integer $n > 1$ can be written as a product of primes, and this representation is \emph{unique} up to ordering.
\end{thm}
\begin{proof}
    Existence is trivial. Uniqueness: suppose $n = p_1 \dots p_r = q_1 \dots q_s$. $p_1 \mid n$, so $p_1$ divides some $q_j$. Hence $p_1 = q_j$ and so we can cancel $p_1$ and $q_j$ from the relation, and repeat the process for $\frac{n}{p_1}$, eventually giving that the $\{p_1, \dots, p_r\}$ are the same as the $\{q_1, \dots, q_s\}$, up to ordering.
\end{proof}

% Lecture 2

If we know $a = \prod_{i=1}^k p_i^{\alpha_i}$, $b = \prod_{i=1}^k p_i^{\beta_i}$ for $\alpha_i, \beta_i \geq 0$ and $p_i$ are distinct primes, then by uniqueness of prime factorisation,
\begin{equation*}
    (a, b) = \prod_{i=1}^k p_i^{\gamma_i} \, , \quad \gamma_i = \min(\alpha_i, \beta_i)
\end{equation*}
However if $a, b$ are large, this is an inefficient way to compute GCDs.
\begin{defi}
    An algorithm with input an integer $N> 0$ is \textbf{polynomial time} if $\exists b, c > 0$ for which the algorithm completes after less than $c (\log N)^b$ `elementary operations'.
    Examples of elementary operations include adding or multiplying digits in some fixed base.

    If there are $k$ integer inputs, we require less than $c (\max_k(\log N_i))^b$ operations.
\end{defi}

\begin{eg}\leavevmode
    \begin{itemize}
        \item Adding, multiplying integers (usual method)
        \item Computing GCDs by Euclid's algorithm
        \item Testing if $N$ is prime (recent discovery, 2002)
    \end{itemize}
\end{eg}

\paragraph{Factoring} What about factoring $N$? The obvious method is trial division by integers $\leq \sqrt{N}$. If $N = pq$, then $p, q \sim \sqrt{N}$ this will take $\sqrt{N}$ divisions - asymptotically larger than any power of $\log N$.
For instance, if $N$ has $100$ digits, and we can do $2^9$ divisions every second, this will take around $10^{50} / 2^9$ seconds, which is about $6 \times 10^{39}$ years.  However, Euclid's algorithm will compute the GCD of two such numbers in a few milliseconds.
However, there are better algorithms for factoring which we will see later, but so far no polynomial-time algorithm is known (important for security of encryption algorithms like RSA).
These are practical for numbers with fewer than 200 digits (for a large computer - the record is 232 digits using thousands of computers and several months)

We will study the distribution of primes and the counting function later.  For now,
\begin{thm}[Euclid]
    There are infinitely many primes
\end{thm}
\begin{proof}
    It is enough to show that given $N$, there is a prime $p > N$. Let $q$ be the largest prime $\leq N$, and set $M = (2 \times 3 \times 5 \times \dots \times q) + 1$. If $p$ is any prime factor of $M$, then $p \notin \set{2, 3, \dotsc, q}$ so $p > N$.
\end{proof}

\begin{remark}
    This is constructive, in that it gives a way to find a prime greater than any $N$, but is is not efficient. For instance, if $N=1000$, $M$ has over $400$ digits.
\end{remark}

\paragraph{Finding large primes} For reasonable size numbers (fewer than 1000 digits), it is reasonable to pick numbers at random and test for primality.
For very large primes, there are special (faster) tests for primality of numbers of the form $N = 2^q - 1$, called Mersenne numbers.
Using these, it has been shown that that $2^q - 1$ is prime when $q = 74207281$.

\clearpage

\section{Congruences}
Fix $n \geq 1$ (the modulus).  Typically we will use $n > 1$.
\begin{defi}
    $ a \equiv b \pmod{n}$ if $n \mid a-b$, and we say `$a$ is congruent to $b$ mod $n$'
\end{defi}

This defines an equivalence relation on $\Z$. Write $\Z / n\Z$ for the set of equivalence classes $\set{a + n \Z}$, where $a + n \Z = b + n \Z \iff a \equiv b \pmod{n}$.  It is easy to see that the operations of addition and multiplication in $\set{a + n \Z}$ are well defined.  [In other words, $n \Z$ is an ideal in the ring $\Z$, and $\Z / n\Z$ is the quotient ring.]

\begin{nlemma}\label{lem:2_1}
    Let $a \in \Z$. The following are equivalent:
    \begin{enumerate}[label=\roman*.]
        \item $(a, n) = 1$
        \item $\exists b \in \Z$ with $ab \equiv 1 \pmod{n}$
        \item (The equivalence class of) $a$ is a generator of the group $(\Z/n\Z, +)$.
    \end{enumerate}
\end{nlemma}

\begin{proof}
    \leavevmode
    \begin{itemize}[label={}]
        \item i. $\Rightarrow$ ii. If $(a, n) = 1$, $\exists b, c \in \Z$ with $ab+nc=1$ so $ab \equiv 1 \pmod{n}$
        \item ii. $\Rightarrow$ i. $ab \equiv 1 \pmod{n} \iff ab+kn=1$, for some $k \in \Z \implies (a, n)= 1$
        \item ii. $\Leftrightarrow$ iii. $ab \equiv 1 \pmod{n}$ for some $b \iff 1$ belongs to the subgroup of $\Z / n \Z$ generated by $a \iff$ the subgroup generated by $a$ is $\Z / n \Z$
    \end{itemize}
\end{proof}

\begin{notation}
    For $n > 1$, we write $(\Z / n \Z)^*$ to denote the set of units (invertible elements) of $\Z / n \Z$. By \cref{lem:2_1}, this is the set of classes $a + n \Z$ where $(a, n) = 1$.
    We can then define $\phi(n) =\# (\Z / n \Z)^* = \# \set{a \in \Z | 1 \leq a \leq n, \, (a, n) = 1}$, the \textbf{Euler $\phi$-function}.
\end{notation}

\begin{remark}
    For $n>1$, $\Z/n\Z$ is a field $\iff$ every non-zero element has an inverse under $X$ $\iff$ $n$ is prime $\iff$ $\phi(n) = n-1$.
\end{remark}

\begin{thm}[Euler-Fermat Theorem]
    If $(a, n) = 1$, then $a^{\phi(n)} \equiv 1 \pmod{n}$
\end{thm}

\begin{proof}
    $(n>1)$ Apply Lagrange's theorem to the group $G = (\Z/n\Z)^*$ which has order $\phi(n)$. Then $a \in \Z$ with $(a, n) = 1$ defines an element of $G$ whose order divides $\phi(n)$. So $a^{\phi(n)} \equiv 1 \pmod{n}$.
\end{proof}

This has an important special case, called Fermat's Little Theorem.
\begin{thm}[Fermat's Little Theorem\hypertarget{thm:fermatLittle}]
    If $p$ is prime and $a \in \Z$, then $a^p \equiv a \pmod{p}$.
\end{thm}

\begin{proof}
    Trivial if $p \mid a$.  If not, $(a, p) = 1$ so $a^{\phi(p)} \equiv 1 \pmod{p} \implies a^p \equiv a \pmod{p}$
\end{proof}

% Lecture 3

\begin{nlemma}\label{lem:2_2}
    Let $G$ be a cyclic group of order $n \geq 1$. Then
    \begin{align*}
        \varphi (n) &=  \# \set{g \in G | (\text{order of } g) = n} \\
                    &=  \# \text{ of generators of } G
    \end{align*}
\end{nlemma}

\begin{proof}
    We may assume $G = \Z/ n \Z$, in which case this is just \cref{lem:2_1}
\end{proof}

\subsection{Simultaneous Congruences}

\begin{eg}
    We would like to find all $x \in \Z$ such that $x \equiv 7 \pmod{10}$ and $x \equiv 3 \pmod{13}$.
    One way might be to try $7, 17, 27, \dotsc$ in turn.

    A better way: suppose we have $u, v \in \Z$ such that
    \begin{align*}
        u &\equiv 1 \pmod{10} & v &\equiv 0 \pmod{10} \\
        u &\equiv 0 \pmod{13} & v &\equiv 1 \pmod{13}
    \end{align*}

    Then $x = 7u + 3v$ is a solution.

    To find $u, v$: $(10, 13) = 1$ so $\exists r, s$ with $10r + 13s = 1$, so setting $u=13s$ and $v=10r$ ensures the above congruences are satisfied.
    From the Euclidean algorithm, we see $r=4$ and $s=-3$ work, so $u=-39$ and $v=40$.

    We can confirm  $x = 7(-39) + 3(40) \equiv 107 \pmod{130}$ is a solution.
    In fact, the set of all solutions is $ \set{ x | x \equiv 107 \pmod {130}} $.
\end{eg}

This is a special case of

\begin{thm}[\hypertarget{thm:crt}{Chinese Remainder Theorem}]
    Let $m_1, \dotsc, m_k$ be integers $\geq 1$ with $(m_i, m_j) = 1$ if $i \neq j$ (they are pairwise coprime).
    Write $M = m_1 \dotsm m_k$ for $k \geq 2$. Let $a_1, \dotsc, a_k \in \Z$. Then there exists a solution $x \in \Z$ of
    \begin{equation}\label{eq:crt}
        \begin{cases}
            x \equiv a_1 \pmod{m_1} \\ \vdots \\ x \equiv a_k \pmod{m_k}
        \end{cases}
    \end{equation}
    and $x$ is unique mod $M$.
\end{thm}

\begin{remark}
    If $x$ satisfies \cref{eq:crt}, then so does $x+Mn$ for $n \in \Z$, so the solution is just $x + M\Z$.
\end{remark}

\begin{proof}
    \leavevmode
    \begin{itemize}
        \item Uniqueness: If $x, y$ satisfies  \cref{eq:crt}, then $m_i \mid (x-y)$ for every $i$. As no prime divides two of the $m_i$, it follows that $M= \prod m_i \mid (x-y)$, so $x \equiv y \pmod{M}$.
        \item Existence: Write $M_i = M/m_i = \prod_{j\neq i} m_j$.
            By the hypothesis, $(M_i, m_i) = 1$. So $ \exists c_i \in \Z$ with $c_i M _i \equiv 1 \pmod{m_i}$.
            Obviously $c_i M_i \equiv 0 \pmod{m_j}\; \forall j \neq i$. Let $x = \sum_{i=1}^k a_i c_i M_i$, then $x$ satisfies \cref{eq:crt}, as required.
    \end{itemize}
\end{proof}

Note we find the $c_i$ by Euclid's algorithm, so this is constructive.

\begin{cor}
    If $M = \prod_{i=1}^k m_i$, with $m_i$ pairwise coprime, then
    \begin{equation*}
        \varphi(M) = \varphi(m_1) \dotsm \varphi (m_k)
    \end{equation*}
\end{cor}

\begin{proof}
    $(a, M) = 1 \Leftrightarrow \forall i, (a, m_i)=1$. So by the \hyperlink{thm:crt}{Chinese Remainder Theorem}, we have a bijection
    \begin{equation*}
        \set{ 1 \leq x \leq M | (x, M) = 1} \stackrel{\sim}{\longleftrightarrow} \set{ (a_1, \dotsc, a_k | 1 \leq a_i \leq m_i, (a_i, m_i) = 1 }
    \end{equation*} So
    % TODO fix
    \[ \#\text{LHS} = \varphi (M) \text{ , } \#\text{RHS} = \prod_i \varphi (m_i) \]
\end{proof}

Algebraic aside: We can write thus in terms of the rings $R_i = \Z / m_i \Z$.

\begin{defi}[Product ring]
    The \textbf{product ring} is
    \begin{equation*}
        R_1 \times \dotsb \times R_k = \set{(r_1, \dotsc, r_k) | r_i \in R_i }
    \end{equation*} with $+, \times$ defined component-wise.
    This is a ring with $0$ as the zero vector, and $1$ as the vector of ones.
\end{defi}

\begin{nthm}
    Take $M = \prod m_i$, with $ m_i$ pairwise coprime.
    The map
    \begin{align*}
        \Theta : \Z/M\Z &\longrightarrow \Z/m_1\Z \times \cdots \times \Z / m_k \Z \\
                       a + M \Z &\longmapsto (a + m_1 \Z, \dotsc , a + m_k \Z )
    \end{align*}
    is an isomorphism of rings.
\end{nthm}

\begin{proof}
    $m_i \mid M \Rightarrow a+m_i \Z$ only depends on $a + M\Z$, so $\Theta$ is well-defined.
    It is a homomorphism (by definition of $+, \times$ in the product ring), and the \hyperlink{thm:crt}{Chinese Remainder Theorem} implies that it is bijective.
\end{proof}

\begin{defi}[Multiplicative function]\hypertarget{def:multiplicativeFunction}
    A \textbf{multiplicative function} is a function $f: \N = \set{1, 2, 3, \dotsc } \to \C$ for which
    \begin{equation*}
        (m, n) = 1 \implies f(mn) = f(m)f(n)
    \end{equation*}
    (This is the traditional terminology, although it is confusing we don't require $\forall m, n, f(mn)=f(m)f(n)$, which is sometimes called \textbf{totally multiplicative})
\end{defi}

\begin{eg}
    Examples of \hyperlink{def:multiplicativeFunction}{multiplicative functions}.
    \begin{itemize}
        \item $\varphi(n)$
        \item $\tau (n) = \#$ of positive divisors of  $n$
        \item $\sigma (n) = \sum_{1 \leq d \mid n} d$
        \item More generally $\sigma_k (n) = \sum_{1 \leq d \mid n} d^k$, note $\sigma = \sigma_1, \tau = \sigma_0$
    \end{itemize}
\end{eg}

\begin{nlemma}\label{lem:2_4}
    Let $f$ be a multiplicative function. Then so is $g$, defined by \begin{equation*} g(n) = \sum_{d \mid n} f(d) \end{equation*}
\end{nlemma}

\begin{proof}
    Let $(m, n) = 1$.
    Then $\set{ \text{divisors } d \text{ of } mn } = \set{ d = d_1 d_2 | d_1 \mid m, d_2 \mid n }$.
    \begin{equation*}
        g(mn) = \sum_{d \mid mn} f(d) = \sum_{d_1 \mid m} \sum_{d_2 \mid n} f(d_1 d_2) = \sum_{d_1 \mid m} f(d_1) \sum_{d_2 \mid n} f(d_2) = g(m)g(n)
    \end{equation*}
\end{proof}

\begin{eg}
    $f(n) = n^k$ (obviously multiplicative). Then $g(n) = \sigma_k(n)$.
    Later we will see how to recover $f$ from $g$.
\end{eg}

% Lecture 4 (probably)

\begin{nthm}\label{thm:2_5}
    \leavevmode
    \begin{enumerate}[label=(\roman*)]
        \item $p$ prime, $k \leq 1 \implies \varphi(p^k) = p^{k-1} (p-1) = p^k \left(1-\frac{1}{p}\right)$
        \item $n \geq 1$: $\varphi (n) = n \prod_{p \mid n}\left( 1-\frac{1}{p} \right)$
        \item $\sum_{d \mid n} \varphi(d) = n$
    \end{enumerate}
\end{nthm}

\begin{proof}
    \leavevmode
    \begin{enumerate}[label=(\roman*)]
        \item $\varphi (p^k) = \# \set{ 1 \leq a \leq p^k | p \nmid a } = p^k - p^{k-1}$
        \item Write
            \begin{equation*}
                n = \prod_i p_i^{k_i}
            \end{equation*}
            with $p_i$ distinct. Then,
            \begin{align*}
                \varphi (n) &= \prod_i \varphi (p_i^{k_i}) \\% \text{ by Corollary to CRT } \\
                            &= \prod_i p_i^{k_i} \left(1 - \frac{1}{p_i}\right) \\
                            &= n \prod_i \left(1 - \frac{1}{p_i} \right)
            \end{align*}
        \item By \cref{lem:2_4}, the left hand side is multiplicative. The right hand side is obviously multiplicative, so it is enough to prove for $n = p^k$.
            \begin{align*}
                \sum_{d \mid n} \varphi(d) &= \varphi(1) + \varphi(p) + \dotsb + \varphi(p^k) \\
                                       &= 1 + (p - 1) + (p^2 - p) + \dotsb + (p^k - p^{k-1}) \\
                                       &= p^k
            \end{align*}
    \end{enumerate}
\end{proof}

\subsection{Polynomial Congruences}

We will take $R = \Z, \Q$ or $\Z/n\Z$ (or any commutative ring with $1$)

Recall $R[X]$ refers to polynomials in $X$ taking coefficients from $R$, formally:
\begin{equation*}
    \set{a_n X^n + a_{n-1} X^{n-1} + \dots + a_0 \mid n \geq 0, \ a_i \in R}
\end{equation*}

Two polynomials are equal if their coefficients are the same.
Importantly, a polynomial $f \in R[X]$ determines a function $R \to R$, given by $\alpha \mapsto f(\alpha) = \sum a_i \alpha^i$.
It can happen that different polynomials give the same function.

\begin{eg}
    For $p$ a prime and $R = \Z/p\Z$, consider $f(X) = X^p - X$.
    Then $\forall a \in R$, $f(a) = 0$ in $\Z/p\Z$ by Fermat's Little Theorem.
    So $f$ and the zero polynomial determine the same function.
\end{eg}

Multiplication and addition of polynomials is defined in the obvious way: for $f = \sum_{i=0}^n a_i X^i$, $g = \sum_{i=0}^n b_i X_i$, we have
\begin{align*}
    f + g &= \sum_{i=0}^n (a_i + b_i) X^i \\
    fg &= \sum_{i=0}^{2n} \left(\sum_{j+k=i} a_j b_k\right) X^i
\end{align*}
so $R[X]$ is a ring.

We also have a division algorithm for polynomials, where the measure of size is the degree.

\begin{defi}
    $\deg(f)$ is the largest $i$ for which the coefficient of $X^i$ is non-zero, and $\deg(f) = \infty$ if $f$ is the zero polynomial.
\end{defi}

We also have $\deg(fg) \leq \deg(f) + \deg(g)$.

\begin{defi}[Divison algorithm for polynomials\hypertarget{def:polyDivisionAlg}]
    Let $f, g \in R[X]$. Assume that the leading coefficient of $g$ is a unit in $R$ (that is, has an inverse under multiplication)
    Then $\exists q, r \in R[X]$ with $\deg(r) < \deg(g)$ and $f = gq + r$.
\end{defi}

\begin{proof}
    Induction on $\deg f$. If $\deg f < \deg g$, then $q = 0$ and $r = f$ will do.

    Otherwise $f = a X^m + \dots$, $a \neq 0$, $g = b X^n + \dots$, with $b = \frac{1}{c}$ invertible by assumption and $m \geq n$.

    Then $f_1 = f - ac X^{m-n} g \in R[X]$ has degree strictly less than $m$. So $f_1 = g q_1 + r$ say, $\deg(r) < \deg(g)$ and so $f = (q_1 + ac X^{m-n}) g + r$, as required.
\end{proof}

\begin{ncor}[Remainder theorem\label{cor:remainderThm}]
    Take $f \in R[X]$ and $\alpha \in R$. Then \begin{equation*}f(X) = (X-\alpha) f_1(X) + f(\alpha)\end{equation*}
\end{ncor}

\begin{proof}
    Apply the division algorithm with $g=X-a$, so $f = (X-\alpha) f_1 + c$.
    $c$ has degree less than 1, so must be in $R$.
    Now, evaluate both sides at $X = \alpha$, so $c = f(\alpha)$.
\end{proof}

In particular, if $f(\alpha) = 0$ then $f(X) = (X - \alpha) f_1(X)$.

However in general a polynomial can have more roots than its degree - consider $f(X) = X^2 - 1$ with $R = \Z / 8\Z$

\begin{defi}
    A nonzero ring $R$ is an integral domain if $ab=0$ implies $a=0$ or $b=0$.
\end{defi}

\begin{eg}
    $\Q$ and $\Z$ are integral domains, and $\Z/n\Z$ is an integral domain if and only if $N$ is prime.
\end{eg}

\begin{nthm}\label{thm:2.7}
    If $R$ is an integral domain, and $f \in R[X]$ is a non-zero polynomial of degree $n \geq 0$, then $f$ has $\leq n$ roots in $R$.
\end{nthm}

\begin{cor}[Lagrange's Theorem]
    Take $p$ prime, $f \in \Z[X]$ of degree $n$, and $f$ not divisible by $p$.
    Then the congruence $f(x) \equiv 0 \pmod{p}$ has $\leq n$ solutions mod $p$.
\end{cor}

\begin{proof}
    The $n=0$ case is trivial.

    Suppose $n > 0$. If $f$ has no roots in $R$, we have nothing to prove.

    Otherwise $\exists \alpha \in R$, $f(\alpha) = 0$ so $f(X) = (X - \alpha) f_1(X)$, $f_1 \in R[X]$ with $\deg(f_1) = n-1$.
    By induction, $f_1$ has $\leq n-1$ roots in $R$.
    If $\beta$ is a root of $f$, then $(\beta-\alpha) f_1(\beta) = 0$ so either $\beta = \alpha$ or $f_1(\beta) = 0$, as $R$ is an integral domain.
    So, the roots of $f$ are exactly $\alpha$ and the roots of $f_1$, so $f$ has $\leq n$ roots.
\end{proof}

\begin{eg}
    Take $p$ prime, and set
    \begin{equation*}f(X) = X^{p-1} - 1 - \prod_{a=1}^{p-1} (X - a) \in \Z / p \Z [X]\end{equation*}
    Then, $\deg f \leq p-2$. If $a=1, \dotsc, p=1$ then $a^{p-1} \equiv 1 \pmod{p}$ so $f(a) = 0 \in \Z/p\Z$.
    So as $f$ has $\geq p-1$ roots mod $p$, it must be identically zero mod $p$. So $f(0)$ is zero mod $p$, and
    \begin{equation*}
        -1 - \prod_{a=1}^{p-1} (-a) \equiv 0 \pmod{p}
    \end{equation*}
    Giving us Wilson's Theorem, $(p-1)! \equiv -1 \pmod{p}$.
\end{eg}

The additive group $(\Z / n\Z, +)$ is cyclic. What about $((\Z/n\Z)^*, \times)$?

\begin{eg}
    Consider $n=7$, then we can check $3$ is a generator of $(\Z / n \Z)^*$ and hence the group is cyclic.
\end{eg}

\begin{nthm}\label{thm:2.8}
    If $p$ is prime, then $G = (\Z / p \Z)^*$ is cyclic of order $p-1$.
\end{nthm}

\begin{proof}
    $\# G = p-1 = \sum_{d \mid p-1} \phi(d)$ by \cref{thm:2_5} part (iii).

    Also, by Lagrange's Theorem in elementary group theory, \begin{equation*}\# G = \sum_{d \mid p-1} \# \set{g \in G \ \text{of order d}} = \sum_{d \mid p-1} N_d\end{equation*}
    Suppose $G$ is not cyclic, so $G$ has no element of order $p-1$, then ${N_{p-1} = 0 < \phi(p-1)}$.
    As $\sum \phi(d) = \sum N_d$, there exists some $d$ for which $N_d > \phi(d) > 0$. Let $\alpha \in G$ be an element of order $d$.
    Then $\langle\alpha\rangle \coloneqq \set{1, \alpha, \alpha^2, \dotsc, \alpha^{d-1}} \subset G$ is a cyclic subgroup of order $d$ so has exactly $\phi(d)$ elements of order $d$ by \cref{lem:2_2}.
    So $\exists \beta \notin \langle\alpha\rangle$ where $\beta$ has order $d$.
    Then $1, \alpha, \alpha^{d-1}, \beta$ are $(d+1)$ roots of the polynomial $X^d - 1$, contradicting \cref{thm:2.7}.
    So, $G$ must be cyclic.
\end{proof}

% Lecture 5

\begin{defi}[Primitive root\hypertarget{def:primRoot}]
    If $g$ is a generator of $(\Z / p \Z)^*$ then $g$ is said to be a \textbf{primitive root mod $p$}.
\end{defi}

By \cref{thm:2.8}, \hyperlink{def:primRoot}{primitive roots} exist.

\begin{eg}
    Take $p = 19$, and let $d$ be the order of $2$ inside $(\Z/19\Z)^*$, then $d \mid p-1$ = 18.  We have $2^6 \equiv 7 \not\equiv 1 \pmod{19}$, so $d \nmid 6$.
    Similarly, $2^9 \equiv -1 \pmod{19}$ so $d \nmid 9$.  Hence, $d=18$ and $2$ is a \hyperlink{def:primRoot}{primitive root} mod $19$.
\end{eg}

There are many unsolved problems about \hyperlink{def:primRoot}{primitive roots}:
\begin{enumerate}
    \item Artin's Primitive Root conjecture:

        Fix $g \geq 2$. Then there exist infinitely many $p$ for which $g$ is a primitive root mod $p$ (say $g$ is prime).
        Even the case $g=2$ is unknown.
        From analytic number theory, it is known there are infinitely many $p$ for which one of $2, 3, 5$ is a primitive root.
    \item How large is the smallest primitive root mod $p$?

        We can show that this goes to $\infty$ as $p$ grows.
        It is known that is is bounded above by $c p^{1/4 + \epsilon}$ for any $\epsilon > 0$, but expected to be smaller (bounded by $c (\log p)^2$).
\end{enumerate}

Now let's consider the more general case of $(\Z / p^n \Z)^*$ for $n > 1$, and ask if it is cyclic.
$(\Z / 8 \Z)^* = \{\pm 1, \pm 3\}$, which all have order $1$ or $2$, so the group is not cyclic.  If $n \geq 3$, the map $(\Z/2^n \Z)^* \to (\Z/8 \Z)^*$ is surjective:
\begin{equation*}\forall n \geq 1, \quad (x, 8) = 1 \iff x \text{ odd } \iff (x, 2^n) = 1 \end{equation*}

So, $(\Z/2^n \Z)^*$ is not cyclic for $n \geq 3$ since a generator would map to a generator of $(\Z / 8 \Z)^*$.

\begin{nthm}\label{thm:2.9}
    If $p > 2$ and $n \geq 1$ then $(\Z/p^n \Z)^*$ is cyclic.
\end{nthm}

\begin{proof}
    The proof is deferred until \cpageref{pf:2.9}.
\end{proof}

\begin{nlemma}\label{lem:2_10}
    Take $p$ an odd prime, and let $y \in \Z$ and $k \geq 1$. Then,
    \begin{enumerate}[label=(\roman*)]
        \item If $x \equiv 1 + p^k y \pmod{p^{k+1}}$ then $x^p \equiv 1 + p^{k+1} y \pmod{p^{k+2}}$
        \item $(1 + p y)^{p^k} \equiv 1 + p^{k+1} y \pmod{p^{k+2}}$
    \end{enumerate}
\end{nlemma}

\begin{proof}
    \leavevmode
    \begin{enumerate}[label=(\roman*)]
        \item We may as well assume (by replacing $y$ with $y + pz$) that $x = 1 + p^k y$. Then,
            \begin{align*}
                x^p &= \sum_{j=0}^p \binom{p}{j} (p^k y)^j \\
                    &= 1 + p^{k+1} y + \sum_{j=2}^{p-1} \binom{p}{j} p^{kj} y^j + p^{p^k} y^p.
            \end{align*}
            For $2 \leq j \leq p-1$, we have $\binom{p}{j} \equiv 0 \pmod{p}$ and hence $\binom{p}{j} p^{kj} \equiv 0 \pmod{p^{2k+1}}$ and $2k+1 \geq k+2$.
            Since $p > 2$, we have $p^k \geq k+2$ so the last term is also $\equiv 0 \pmod{p^{k+2}}$, hence we are done.

        \item Apply part (i) $k$ times to $1 + py$.
    \end{enumerate}
\end{proof}

\begin{nlemma}\label{lem:2_11}
    If $g \in \Z$, $(g, p) = 1$, $g$ is a primitive root mod $p$, and $g^{p-1} \not\equiv 1 \pmod{p^2}$, then $g$ is a generator of $(\Z/p^n \Z)^* = G$.
\end{nlemma}

\begin{proof}
    Let $d$ be the order of $g$ in $G$. We know $d \mid \#G = p^{n-1}(p-1)$, so if $g$ is not a generator, one of the following two cases must hold:

    \begin{enumerate}[label=(\roman*)]
        \item $d \mid p^{n-2} (p-1)$, so $g^{p^{n-2}(p-1)} \equiv 1 \pmod{p^n}$.
        \item $d = p^{n-1} e$, with $1 \leq e < p-1$ and $e \mid p-1$, and so $g^{p^{n-1} e} \equiv 1 \pmod{p^n}$.
    \end{enumerate}
    Deal with these cases in turn:

    \begin{enumerate}[label=(\roman*)]
        \item Let $x = g^{p-1} = 1+py$ with $y \not\equiv 0 \pmod{p}$, because $g^{p-1} \not\equiv 1 \pmod{p^2}$.
            Then by \cref{lem:2_10} part (ii), we have $x^{p^{n-2}} \equiv 1 + p^{n-1} y \pmod{p^n}$, so $g^{p^{n-2}(p-1)} \not\equiv 1 \pmod{p^n}$.

        \item $g^{p^{n-1}e} \equiv g^e \pmod{p}$ by Fermat-Euler, and this is not congruent to $1 \pmod{p}$ as $g$ is a primitive root mod $p$.
    \end{enumerate}

    So neither (i) nor (ii) can hold, and hence $g$ has order $p^{n-1}(p-1)$.
\end{proof}

We can return and prove \cref{thm:2.9}.

\begin{proof}[Proof of \cref{thm:2.9}\label{pf:2.9}]
    Let $g \in \Z$ be a primitive root mod $p$. If $g^{p-1} \not\equiv 1 \pmod{p^2}$, then by \cref{lem:2_11}, $g$ generates $(\Z/p^n \Z)^*$.
    If not, $g^p \equiv g \pmod{p^2}$. Let $g_1 = g(1 + p)$.
    Then, $g_1^p = g^p (1+p)^p$ and $(1+p)^p \equiv 1 \pmod{p^2}$ by \cref{lem:2_10}.

    So, $g_1^p \equiv g^p \pmod{p^2} \equiv g \pmod{p^2} \not\equiv g_1 \pmod{p^2}$, so by \cref{lem:2_11}, $g_1$ generates $(\Z/p^n \Z)^*$.
\end{proof}

\begin{remark}
    \leavevmode
    \begin{enumerate}
        \item Our proof gives an easy way to find a generator for $(\Z / p^n \Z)^*$, independent of $n \geq 2$.
        \item What happens when $p=2$? \Cref{lem:2_10}(i) fails to hold for $p=2$, $k=1$: $(1+2)^2 \equiv 1 \pmod{8}$.  It does hold for $p=2$ and $k \geq 2$ however. Part (ii) becomes $(1+4)^{k-1} \equiv 1 + 2^{k+1} \pmod{2^{k+2}}$.
            We can then show (following the argument for $p$ odd), that $(\Z/2^n \Z)^*$ for $n \geq 3$ is generated by $-1$ and $5$ which have orders $2$ and $2^{n-2}$ respectively.
            So, we have that
            \begin{equation*}
                (\Z/2^n \Z)^* \cong \Z/2\Z \times \Z/2^{n-2} \Z
            \end{equation*}
        \item If $N = \prod_{1 \leq i \leq r} p_i^{k_i}$, then
            \begin{equation*}
                (\Z/N \Z)^* \cong (\Z/{p_1}^{k_1} \Z)^* \times \dotsm \times (\Z/{p_r}^{k_r} \Z)^*
            \end{equation*}
            by the \hyperlink{thm:crt}{Chinese Remainder Theorem}.
    \end{enumerate}
\end{remark}

\clearpage

\section{Quadratic residues}
Take $p > 2$ an odd prime. If $a \in \Z$, we know $x^2 \equiv a \pmod{p}$ has $\leq 2$ solutions mod $p$.

For $a \equiv 0 \pmod{p}$, then there is one solution, $x \equiv 0 \pmod{p}$.

For $a \not \equiv 0 \pmod{p}$, if $x$ is a solution then so is $-x$, and $-x \equiv x \pmod{p} \Leftrightarrow 2x \equiv 0 \pmod{p}$ but $a \not\equiv 0 \Rightarrow x \not\equiv 0 \pmod{p}$ so we have either $0$ or $2$ solutions.

\begin{defi}
    $a \equiv 0 \pmod{p}$ is a \textbf{quadratic residue} mod $p$ if $x^2 \equiv a \pmod{p}$ is soluble, and a \textbf{quadratic non-residue} if not.
\end{defi}

% Lecture 6

So $a$ is a quadratic residue mod $p$ iff its class in $(\Z / p \Z)^*$ is a square.

% TODO table
% 1 4 2 2 4 1

We can check directly that % get rid of this line
the quadratic resides mod $7$ are $\{1, 2, 4\}$.

\begin{nlemma}\label{lem:3.1}
    Let $p$ be an odd prime. There are exactly $\frac{p-1}{2}$ quadratic residues mod $p$.
\end{nlemma}

\begin{proof}[Proof 1]
    Consider
    \begin{align*}
        (\Z / p \Z)^* \xrightarrow{\sigma} (\Z/p\Z)^* \\
        x &\mapsto x^2 \pmod{p}
    \end{align*}
    $\sigma(x) = \sigma(y) \iff x^2 \equiv y^2 \pmod{p} \iff (x-y)(x+y) \equiv 0 \pmod{p} \iff x \equiv \pm y \pmod{p}$.
    Since $p$ is odd, if $(x, p) = 1$ then $x \not\equiv -x \pmod{p}$. So, $\sigma$ is $2$-to-$1$, hence the image of $\sigma$ has $\frac{p-1}{2}$ elements.
\end{proof}

\begin{proof}[Proof 2]
    Let $g$ be a primitive root mod $p$. Then $(\Z / p \Z)^* = \{1, g, g^2, \dotsc, g^{p-2}\}$ as $g^{p-1} = 1$.
    So,
    \begin{align*}
        \set{x^2 | x \in (\Z / p\Z)^*} &= \{1, g^2, g^4, \dotsc, g^{p-3}, g^{p-1}, g^{p+1}, \dotsc, g^{2p-4}\} \\
                                      &= \{1, g^2, g^4, \dotsc, g^{p-3}\}
    \end{align*}
    since $g^{p-1} = 1$ and $g^{p+1} = g^2$, and so on, hence there are $\frac{p-1}{2}$ elements.
\end{proof}

\begin{defi}
    The \textbf{Legendre symbol} of $a \pmod{p}$ ($p$ an odd prime, $a \in \Z$) is
    \begin{equation*}
        \legendre{a}{p} =
        \begin{cases}
            0 & \text{if } p \mid a \\
            +1 & \text{if $a$ is a quadratic residue mod $p$} \\
            -1 & \text{if $a$ is a quadratic non-residue mod $p$}
        \end{cases}
    \end{equation*}
\end{defi}

\begin{lemma}[Euler's Criterion\hypertarget{lem:eulerCriterion}]
    \begin{equation*}
        \legendre{a}{p} \equiv a^{\frac{p-1}{2}} \pmod{p}
    \end{equation*}
\end{lemma}

\begin{remark}
    $\legendre{a}{p} \in \{0, \pm 1\}$ which is a set of $3$ distinct integers mod $p$ as $p > 2$. So the congruence in the lemma determines $\legendre{a}{p}$ completely.
\end{remark}

\begin{proof}
    If $p \mid a$, obvious. Suppose $(a, p) = 1$. Then $a^{p-1} = \left(a^{\frac{p-1}{2}}\right)^2 \equiv 1 \pmod{p}$.
    Hence $a^{\frac{p-1}{2}} \equiv \pm 1 \pmod{p}$. If $a \equiv x^2 \pmod{p}$, then $a^{\frac{p-1}{2}} \equiv x^{p-1} \equiv +1 \pmod{p}$.
    By \cref{lem:3.1}, this gives $\frac{p-1}{2}$ solutions of $a^{\frac{p-1}{2}} \equiv 1 \pmod{p}$.
    So there are no more solutions, that is if $\legendre{a}{p} = -1$, then $a^{\frac{p-1}{2}} \equiv -1 \pmod{p}$.
\end{proof}

\begin{ncor}\label{cor:3.2}
    Take $a, b \in \Z$ where $p$ is an odd prime. Then
    \begin{equation*}
        \legendre{ab}{p} = \legendre{a}{p} \legendre{b}{p}
    \end{equation*}
\end{ncor}

\begin{proof}
    \begin{equation*}
        \legendre{ab}{p} \equiv (ab)^{\frac{p-1}{2}} \equiv a^{\frac{p-1}{2}} b^{\frac{p-1}{2}} \equiv \legendre{a}{p} \legendre{b}{p} \pmod{p}
    \end{equation*}
    By the previous remark, we have $\legendre{ab}{p} = \legendre{a}{p} \legendre{b}{p}$.
\end{proof}

\begin{remark}
    We have the following equivalent statements
    \begin{itemize}
        \item The map $(\Z/ p\Z)^* \to \{+1\}$ given by $a \mapsto \legendre{a}{p}$ is a homomorphism of groups.
        \item The product of residues is a residue; the product of a residue and non-residue is a non-residue, and the product of non-residues is a residue.
    \end{itemize}
\end{remark}

Another consequence of \hyperlink{lem:eulerCriterion}{Euler's Criterion} allows equivalent computation of $\legendre{a}{p}$ because there is a polynomial time algorithm to compute $a^n \pmod{N}$.
\begin{itemize}
    \item write $n = n_0 + 2 n_1 + 4 n_2 + \dotsb + 2^k n_k$ in binary, $n_i \in \{0, 1\}$
    \item compute $a^2, \, a^4 = (a^2)^2, \, a^8 = (a^4)^2, \dotsc, a^{2^k} \pmod{N}$.
    \item $a^n \equiv \prod_{i: n_i = 1} a^{2^i} \pmod{N}$
\end{itemize}

\begin{ncor}\label{cor:3.3}
    For $p$ an odd prime,
    \begin{equation*}
        \legendre{-1}{p} =
        \begin{cases}
            +1 & p \equiv 1 \pmod{4} \\
            -1 & p \equiv 3 \pmod{4}
        \end{cases}
    \end{equation*}
\end{ncor}

\begin{proof}
    By \hyperlink{lem:eulerCriterion}{Euler's criterion}, if $p = 4k + l$, with $l = 1 $ or $3$,
    \begin{equation*}
        \legendre{-1}{p} = (-1)^{\frac{p-1}{2}} = (-1)^{2k + \frac{l-1}{2}} =
        \begin{cases}
            +1 & l = 1 \\
            -1 & l = 3
        \end{cases}
    \end{equation*}
\end{proof}

What about $\legendre{2}{p}$? So what is $2^{\frac{p-1}{2}} \pmod{p}$?
Recall the proof of \hyperlink{thm:fermatLittle}{Fermat's Little Theorem}, and imitate this using $\left(\frac{p-1}{2}\right)!$ instead.
This will prove

\begin{lemma}[Gauss's Lemma]\hypertarget{lem:gausssLemma}
    Take $p$ an odd prime and $(a, p) = 1$. Then $\legendre{a}{p} = (-1)^\mu$ where $\mu$ is the number of $j \in \{1, \dotsc, \frac{p-1}{2}\}$ such that $aj \equiv k \pmod{p}$ where $\frac{p+1}{2} \leq k \leq p-1$.
\end{lemma}

\begin{proof}
    $1 \leq j \leq \frac{p-1}{2}$. Write $aj \equiv \epsilon_j c_j \pmod{p}$ with $1 \leq c_j \leq \frac{p-1}{2}$ and $\epsilon_j \in \{\pm 1\}$ (by reducing $aj$ mod $p$ into the interval $(-\frac{p}{2}, \frac{p}{2})$).

    Now claim that if $j \neq k$ with $1 \leq j, k \leq \frac{p-1}{2}$ then $c_j \neq c_k$. Indeed if $c_j = c_k$ then $\epsilon_j aj \equiv e_k ak \pmod{p}$, that is, $j \equiv \pm k \pmod{p}$.
    As $1 \leq j, k \leq \frac{p-1}{2}$, $j + k \not\equiv 0 \pmod{p}$ so $j = k$.

    So, $\{c_1, \dotsc, c_{\frac{p-1}{2}}\} = \{1, 2, \dotsc, \frac{p-1}{2}\}$ in some order.

    Now, $\mu = \#\set{j \in \{1, \dotsc, \frac{p-1}{2}\} | aj \equiv k \pmod{p}, \frac{p+1}{2} \leq k \leq p-1} = \#\set{j | \epsilon_j = -1}$
    So,
    \begin{equation*}
        a^{\frac{p-1}{2}} \cdot \left(\frac{p-1}{2}\right)!
        = \prod_{j=1}^{\frac{p-1}{2}} (aj)
        \equiv \prod_{j=1}^{\frac{p-1}{2}} \epsilon_j c_j
        \equiv \left(\prod_{j=1}^{\frac{p-1}{2}} \epsilon_j \right) \left(\prod_{j=1}^{\frac{p-1}{2}} c_j \right)
        \equiv (-1)^\mu \cdot \frac{p-1}{2}!
    \end{equation*}
    This gives
    \begin{equation*}
        \legendre{a}{p} \equiv a^{\frac{p-1}{2}} \equiv (-1)^\mu
    \end{equation*}
\end{proof}

% Lecture 7

\begin{eg}
    Take the (trivial) special case of $a = -1$, then $-j \in (-\frac{p}{2}, 0)$ so $\epsilon_j = -1$ and $c_j = j$ for any $j$.
    So, $\mu = \frac{p-1}{2}$ and $\legendre{-1}{p} = (-1)^\frac{p-1}{2}$.

    Now consider the case of $n=2$.  Then
    \begin{equation*}
        \set{2j | 1 \leq j \leq \frac{p-1}{2}} = \{2, 4, \dotsc, p-3, p-1\}
    \end{equation*}
    If $0 < j < \frac{p}{4}$ then $2j \in \{1, \dotsc, \frac{p-1}{2}\}$ while if $\frac{p}{4} < j < \frac{p}{2}$ then $\frac{p}{2} < 2j < p$.
    So,
    \begin{align*}
        \mu &= \# \set{j \in \Z | \frac{p}{4} < j < \frac{q}{2}} \\
            &= \floor*{\frac{p}{2}} - \floor*{\frac{p}{4}}
    \end{align*}

    Split into cases:
    \begin{align*}
        p &= 8k+1 &&\implies &&\mu = 4k - 2k = 2k &\implies (-1)^\mu &= 1 \\
        p &= 8k+3 &&\implies &&\mu = (4k+1) - 2k = 2k+1 &\implies (-1)^\mu &= -1 \\
        p &= 8k+5 &&\implies &&\mu = (4k+2) - (2k+1) = 2k+1 &\implies (-1)^\mu &= -1 \\
        p &= 8k+7 &&\implies &&\mu = (4k+3) - (2k+1) = 2k+2 &\implies (-1)^\mu &= 1 \\
    \end{align*}

    Note that $8 \mid p^2 - 1$ and that $16 \mid p^2 - 1 \iff p = 8k \pm 1$, both easy to check.
\end{eg}

\begin{ncor}\label{cor:3.4}
    \begin{equation*}
        \legendre{2}{p} =
        \begin{cases}
            +1 & p \equiv \pm 1 \pmod{8} \\
            -1 & p \equiv \pm 3 \pmod{8}
        \end{cases}
        = (-1)^\frac{p^2 - 1}{8}
    \end{equation*}
\end{ncor}

What about $a = 3, 5, \dotsc$?  For $p > 3$, consider $\set{3j | 1 \leq j \leq \frac{p-1}{2}}$.
\begin{itemize}[label={}]
    \item $0 < j < \frac{p}{6} \implies 0 < 3j < \frac{p}{2}$
    \item $\frac{p}{6} < j < \frac{p}{3} \implies \frac{p}{2} < 3j < p$
    \item $\frac{p}{3} < j < \frac{p}{2} \implies 0 < 3j - p < \frac{p}{2}$
\end{itemize}
So, $\mu = \#\set{j | \frac{p}{6} < j < \frac{p}{3}}$ which we can work out from looking at $p$ mod 12.

For general $1 \leq a \leq p-1$, look at $\set{aj | 1 \leq j \leq \frac{p-1}{2}}$.
Then for $k \in \Z$,
\begin{align*}
    kp < aj < \left(k+ \frac{1}{2}\right) p &\implies 0 < aj - kp < \frac{p}{2} & &\text{does not contribute to $\mu$} \\
    \left(k-\frac{1}{2}\right)p < aj < kp &\implies -\frac{p}{2} < aj - kp < 0 & &\text{contributes to $\mu$}
\end{align*}

So $\mu = \sum_{k \in \Z} \#\set{j | 1 \leq j \leq \frac{p-1}{2}, (k-\frac{1}{2}) \frac{p}{a} < j < \frac{kp}{a}}$, that is $\frac{p}{2} < aj - kp < 0$.
Note also that $0 < k < \frac{1}{2} + \frac{a j}{p} < \frac{a+1}{2}$.

\begin{thm}[Quadratic Reciprocity]\label{thm:qr}
    For $(p, q)$ distinct odd primes,
    \begin{align*}
        \legendre{p}{q} \legendre{q}{p} &= (-1)^{\frac{p-1}{2} \frac{q-1}{2}} \\
                        \legendre{q}{p} &=
                        \begin{cases}
                            -\legendre{p}{q} & \text{if } p \equiv q \equiv 3 \pmod{4} \\
                            \legendre{p}{q} & \text{otherwise}
                        \end{cases}
    \end{align*}
\end{thm}

\begin{eg}
    \leavevmode
    \begin{enumerate}[label=(\roman*)]
        \item $\legendre{3}{p} = (-1)^\frac{p-1}{2} \legendre{p}{3}$, but
            \begin{align*}
                (-1)^\frac{p-1}{2} &=
                \begin{cases}
                    +1 & p \equiv 1 \pmod{4} \\
                    -1 & p \equiv 3 \pmod{4}
                \end{cases}
                \\
                \legendre{p}{3} &=
                \begin{cases}
                    +1 & p \equiv 1 \pmod{3} \\
                    -1 & p \equiv 2 \pmod{3}
                \end{cases}
                \\
                \therefore \legendre{3}{p} &=
                \begin{cases}
                    +1 & p \equiv \pm 1 \pmod{12} \\
                    -1 & p \equiv \pm 5 \pmod{12}
                \end{cases}
            \end{align*}
        \item
            \begin{equation*}
                \legendre{19}{73} = \legendre{73}{19} = \legendre{16}{19} = \legendre{4^2}{19} = 1
            \end{equation*}
        \item
            \begin{equation*}
                \legendre{34}{97} = \legendre{2}{97} \legendre{17}{97}
                = (+1) \times \legendre{97}{17}
                = \legendre{12}{17}
                = \legendre{3}{17} \legendre{2^2}{17}
                \equiv -1
            \end{equation*}
            since $17 \equiv 5 \pmod{12}$.
    \end{enumerate}
\end{eg}

\begin{proof}[Proof of Quadratic Reciprocity]
    By the previous calculation from Gauss' Lemma, $\legendre{q}{p} = (-1)^\mu$
    where
    \begin{equation*}
        \mu =\#\Set{(j, k) \in S | 0 < kp - jq < \frac{p}{2}}
    \end{equation*}
    and
    \begin{equation*}
        S = \Set{(j, k) | 1 \leq j \leq \frac{p-1}{2}, 1 \leq k \leq \frac{q-1}{2}}
    \end{equation*}

    By symmetry, $\legendre{p}{q} = (-1)^\nu$ where
    \begin{equation*}
        \nu =\#\Set{(j, k) \in S | 0 < jp - kq < \frac{p}{2}}
    \end{equation*}

    Now, $\#S = \frac{p-1}{2} \frac{q-1}{2} = \mu + \nu + \#A + \#B$ where
    \begin{align*}
        A = \Set{(j, k) \in S | kp - jq > \frac{p}{2}} \\
        B = \Set{(j, k) \in S | jp - kq > \frac{p}{2}}
    \end{align*}

    If $(j, k) \in S$, write $j' = \frac{p+1}{2} - j$, $k' = \frac{q+1}{2} - k$.
    Then $(j', k') \in S$, and
    \begin{equation*}
        j'q - k'p = \left(\frac{p+1}{2} - j\right) q - \left(\frac{q+1}{2} - k\right) p = \left(kp - jq - \frac{p}{2}\right) + \frac{q}{2}
    \end{equation*}

    So $(j, k) \in A \iff (j', k') \in B$, so $\#A = \#B$.
    Hence $\frac{p-1}{2} \frac{q-1}{2} = \mu + \nu + 2 \#A$ and
    \begin{equation*}
        (-1)^{\frac{p-1}{2} \frac{q-1}{2}} = (-1)^{u+v} = \legendre{q}{p} \legendre{p}{q}\qedhere
    \end{equation*}
\end{proof}

\begin{eg}
    \begin{align*}
        \legendre{7411}{9283} &= -\legendre{9283}{7411} \\
                              &= -\legendre{1872}{7411} \\
                              &= -\legendre{2^4 \cdot 3^2 \cdot 13}{7411} \\
                              &= -\legendre{13}{7411} \\
                              &= -\legendre{7411}{13} \\
                              &= -\legendre{1}{13} = -1
    \end{align*}

    The problem here is that we needed to know that 7411 was prime and factor 1872.
    To avoid this, we will generalise the Legendre symbol to the Jacobi symbol.
\end{eg}

\begin{defi}[Jacobi symbol]\hypertarget{def:jacobi}
    Let $n \geq 1$ be odd, and $n = p_1 \dotsm p_k$ with $p_i$ primes, not necessarily distinct.
    The \textbf{Jacobi symbol} is
    \begin{equation*}
        \legendre{a}{n} = \prod_{j=1}^k \legendre{a}{p_j} \quad \text{for } a \in \Z
    \end{equation*}

    Note if $(a, n) > 1$ then $\legendre{a}{n} = 0$, and if $n=1$ then $\legendre{a}{1} = 1$.
\end{defi}

\begin{nprop}\label{prop:3.5}
    \begin{enumerate}[label=(\roman*)]
        \item
            \begin{equation*}
                \legendre{a}{n} = \legendre{b}{n} \ \text{if} \ a \equiv b \pmod{n}
            \end{equation*}
        \item
            \begin{equation*}
                \legendre{ab}{n} = \legendre{a}{n} \legendre{b}{n}, \; \legendre{a}{mn} = \legendre{a}{m} \legendre{a}{n}
            \end{equation*}
        \item
            \begin{equation*}
                \legendre{-1}{n} = (-1)^\frac{n-1}{2}
            \end{equation*}
        \item
            \begin{equation*}
                \legendre{2}{n} = (-1)^\frac{n^2-1}{8}
            \end{equation*}
    \end{enumerate}
\end{nprop}

% Lecture 8

\begin{proof}
    \begin{enumerate}[label=(\roman*)]
        \item
            \begin{equation*}
                a \equiv b \pmod{n} \implies a \equiv b \pmod{p_j} \; \forall j \implies \legendre{a}{p_j} \legendre{b}{p_j}
            \end{equation*}
        \item
            \begin{equation*}
                \legendre{ab}{p_j} = \legendre{a}{p_j} \legendre{b}{p_j} \; \forall j
            \end{equation*}
            This proves the first equation, while the second follows by definition.
        \item This is true if $n$ is prime, so by part (ii) it is enough to show that if $m, n \geq 1$ are odd then
            \begin{equation*}
                (-1)^\frac{m-1}{2} \cdot (-1)^\frac{n-1}{2} = (-1)^\frac{mn-1}{2}.
            \end{equation*}
            Indeed, $(m-1)(n-1) \equiv 0 \pmod{4}$, so $mn-1 \equiv m+n-2 \pmod{4}$ and hence
            \begin{equation*}
                \frac{mn-1}{2} \equiv \frac{m-1}{2} + \frac{n-1}{2} \pmod{2}
            \end{equation*}
        \item Similarly to (iii), only need to show that for $m, n \geq 1$ odd
            \begin{equation*}
                (-1)^\frac{m-1}{2} \cdot (-1)^\frac{n-1}{2} = (-1)^\frac{mn-1}{2}.
            \end{equation*}
            Indeed, $(m^2 - 1)(n^2 - 1) \equiv 0 \pmod{16}$ so $m^2 n^2 - 1 \equiv m^2 + n^2 - 2 \pmod{16}$, hence
            \begin{equation*}
                \frac{m^2n^2-1}{8} \equiv \frac{m^2-1}{8} + \frac{n^2-1}{8} \pmod{2}
            \end{equation*}
    \end{enumerate}
\end{proof}

\begin{nthm}[Quadratic Reciprocity for Jacobi symbol]\label{thm:3.6}
    Let $m, n \geq 1$ odd. Then
    \begin{equation*}
        \legendre{m}{n} = (-1)^{\frac{m-1}{2} \frac{n-1}{2}} \legendre{n}{m}
    \end{equation*}
    and if $(m, n) = 1$,
    \begin{equation*}
        \legendre{m}{n} \legendre{n}{m} = (-1)^{\frac{m-1}{2} \frac{n-1}{2}}
    \end{equation*}
\end{nthm}

\begin{proof}
    If $(m, n) > 1$, trivial since both sides are 0.

    Assume that $(m, n) = 1$, with
    \begin{equation*}
        m = \prod_{i=1}^k p_i \ , \; n = \prod_{j=1}^l q_j \quad \text{no} \ p_i = q_j
    \end{equation*}

    Let
    \begin{align*}
        r &= \# \set{i | p_i \equiv 3 \pmod{4}} \\
        s &= \# \set{j | q_j \equiv 3 \pmod{4}}
    \end{align*}

    (rest of the proof coming soon)
    % TODO this
\end{proof}

For $p$ prime and $(a, p) = 1$, $\legendre{a}{p} = 1 \iff a$ is a square mod $p$.

Generalising to the Jacobi symbol, for $n \geq 1$ odd and $(a, n) = 1$, if $a \equiv x^2 \pmod{n}$, then
\begin{equation*}
    \legendre{a}{n} = \legendre{x^2}{n} = \legendre{x}{n}^2 = +1
\end{equation*}
but the converse does not hold! For instance
\begin{equation*}
    \legendre{2}{15} = \legendre{2}{3} \legendre{2}{5} = (-1) (-1) = +1.
\end{equation*}
But $2$ is not a square mod $15$ as it is not a square mod $3$ or mod $5$.

Let $n = pq$, $p \neq q$ odd primes. Then by the \hyperlink{thm:crt}{CRT} for $(a, pq) = 1$,
\begin{equation*}
    a \ \text{is square mod} \ pq \iff a \ \text{is a square mod $p$ and mod $q$} \iff \legendre{a}{p} = \legendre{a}{q} = 1
\end{equation*}
but of course
\begin{align*}
    \legendre{a}{pq} = 1 \iff \ &\text{either} \legendre{a}{p} = \legendre{a}{q} = +1 \\
    & \text{or} \legendre{a}{p} = \legendre{a}{q} = +1
\end{align*}

If we know $\legendre{a}{pq} = 1$, to determine whether or not $a$ is a square mod $pq$, it is at least plausible that we need to know $p$ and $q$, i.e. we need to factor $n$.
(This is generally believed to be true - there are cryptographic protocols which rely on the difficulty of finding out whether $a$ is a square mod $pq=n$, without knowing the factorisation of $n$.)

In computing Legendre symbols, need to factor the numerator to apply \namecref{thm:qr}.
Using \namecref{thm:3.6}, this can be avoided. For instance,
\begin{equation*}
    \legendre{33}{73} = \legendre{73}{33} = \legendre{7}{33} = \legendre{33}{7} = \legendre{5}{7} = -1
\end{equation*}
where the fact that $33 \equiv 1 \pmod{4}$ was used.

At worst, we have to take out factors of 2 (since \nameref*{thm:qr} requires $m, n$ odd):
\begin{equation*}
    \legendre{66}{73} = \legendre{2}{73} \legendre{33}{73} = -1.
\end{equation*}
So, it is very similar to Euclid's algorithm.

What about higher reciprocity laws?
\begin{itemize}
    \item Higher powers, for instance cubes mod $p$.
        If $p \equiv 2 \pmod{3}$ then $3 \nmid p-1$, and we can easily see that everything is a cube mod $p$, since $x \mapsto x^3$ is a bijection $(\Z/p\Z)^* \to (\Z/p\Z)^*$.
        For $p \equiv 1 \pmod{3}$, we can define a `cubic Legendre symbol' taking values in $\{0\} \cup \{1, \omega, \omega^2\}$ where $\omega$ is a cube root of unity.
        There is a cubic reciprocity law.
        A big success of 19\textsuperscript{th} century number theory was a proof of a reciprocity law for $n$\textsuperscript{th}, for any $n \geq 2$.
    \item A highlight of the (early) 20\textsuperscript{th} century:
        Recall that for $p$ odd,
        \begin{align*}
            \legendre{-1}{p} = 1 \iff p \equiv 1 \pmod{4} &\iff p = x^2 + y^2 \; \text{for some } x, y \in \Z \\
            &\iff p = (x+iy)(x-iy) \in \Z[i]
        \end{align*}
        This was hugely generalised to Artin's Reciprocity Law (in Algebraic Number Theory), and tells us how primes factor in more general number fields.
\end{itemize}

\begin{proof}[Another proof of infinitude of $p \equiv 3 \pmod{4}$]
    \begin{equation*}
        \legendre{-1}{n} =
        \begin{cases}
            0 & n \ \text{even} \\
            1 & n \equiv 1 \pmod{4} \\
            -1 & n \equiv 3 \pmod{4}
        \end{cases}
    \end{equation*}
    and we know
    \begin{equation*}
        \legendre{-1}{n} = \prod_i \legendre{-1}{p_i} \; \text{if} \; n = \prod_i p_i
    \end{equation*}

    The series
    \begin{equation*}
        \sum_{n \geq 1} \legendre{-1}{n} \frac{1}{n} = \frac{1}{1} - \frac{1}{3} + \frac{1}{5} - \frac{1}{7} \dots
    \end{equation*}
    is convergent as it is an alternating series.

    Suppose $p \equiv 3 \pmod{4}$. Then
    \begin{align*}
        \left(1 + \frac{1}{p}\right) \sum_{n \geq 1} \legendre{-1}{n} \frac{1}{n}
        &= \sum_{n \geq 1} \legendre{-1}{n} \frac{1}{n} + \sum_{m \geq 1} \legendre{-1}{m} \frac{1}{mp} \\
        &= \sum_{n \geq 1} \legendre{-1}{n} \frac{1}{n} - \sum_{m \geq 1} \legendre{-1}{mp} \frac{1}{mp} \\
        &= \sum_{\substack{(n, p) = 1 \\ n \geq 1}} \legendre{-1}{n} \frac{1}{n}
    \end{align*}
    must also be convergent.

    If there are only a finite set $\{p_1, \dotsc, p_k\}$ of primes $\equiv 3 \pmod{4}$, then
    \begin{equation}\label{eq:series}
        \left(1 + \frac{1}{p_1}\right) \left(1 + \frac{1}{p_2}\right) \dotsm \left(1 + \frac{1}{p_k}\right) = \sum_{(n, p_1 \dotsm p_k)=1} \legendre{-1}{n} \frac{1}{n} \tag{$*$}
    \end{equation}
    is also convergent.

    But $(n, p_1 \dots p_k) = 1$ means that every odd prime dividing $n$ is $\equiv 1 \pmod{4}$ so
    \begin{align*}
        \legendre{-1}{n} =
        \begin{cases}
            0 & n \; \text{even} \\
            1 & n \; \text{odd}
        \end{cases} \\
        \implies \text{\eqref{eq:series}} = \sum_{(n, 2p_1 \dotsm p_k) = 1} \frac{1}{n}
    \end{align*}
    but this is divergent.
\end{proof}

% Lecture 9

\clearpage

\section{Binary quadratic forms}
Motivating problem: Which $n \geq 1$ can be written as a sum of 2 integer squares?

\begin{nthm}\label{thm:4.1}
    Take $N \geq 1$ an integer.
    Then $N$ is a sum of two integer squares $\iff$ every prime factor $p \equiv 3 \pmod{4}$ if $N$ divides it to an even power.
\end{nthm}

\begin{proof}
    ($\implies$) Suppose $N = x^2 + y^2$. Let $p \mid N$, $p \equiv 3 \pmod{4}$.
    Then $x^2 \equiv -y^2 \pmod{p}$, so $x \equiv 0 \equiv y \pmod{p}$, since otherwise $\exists z \in \Z$ with $y z \equiv 1 \pmod{p}$ and $(xz)^1 \equiv 1 \pmod{p}$, but $\legendre{-1}{p} = -1$.
    So $p^2 \mid N$ and $N/p^2 = (x / p)^2 + (y / p)^2$, then repeat until no prime factor $p \equiv 3 \pmod{4}$ remains.

    ($\impliedby$) Write $N = M^2 N_1$, where $N_1$ is a product of distinct primes, each either 2 or $\equiv1 \pmod{4}$.
    It suffices to show $N_1 = x^2 + y^2$.

    As $(x^2 + y^2)(z^2 + t^2) = (xz - yt)^2 + (xt + yz)^2$ and $2 = 1^2 + 1^2$, it's enough to show if $p \equiv 1 \pmod{4}$ then $p = x^2 + y^2$, which is done later (in lecture 11).
\end{proof}

There are similar results (Euler) for $x^2 + 2y^2$ and $x^2 + 3y^2$.  Meanwhile, $x^2 + 6y^2$ is complicated, we'll see why.

The general problem is to consider \textbf{binary quadratic forms} with integer coefficients
\begin{equation*}
    f(x, y) = a x^2 + b x y + c y^2 \quad a,b,c \in \Z
\end{equation*}

What are possible sets $\set{f(x, y) | x, y \in \Z}$?
Say $f$ \textbf{represents} $n \in \Z$ if $\exists x, y \in \Z$ with $f(x, y) = n$.

We use the convenient shorthand $(a,b,c)$ for the form $a x^2 + b x y + c y^2$.
Define a BQF as a binary quadratic form with coefficients in $\Z$.
$f$ can be written in matrix form:
\begin{equation*}
    a x^2 + b x y + c y^2 =
    \begin{pmatrix}
        x & y
    \end{pmatrix}
    \begin{pmatrix}
        a & \frac{b}{2} \\
        \frac{b}{2} & c
    \end{pmatrix}
    \begin{pmatrix}
        x \\ y
    \end{pmatrix}
\end{equation*}

\begin{eg}
    \leavevmode
    \begin{itemize}
        \item $f(x, y) = x^2 + y^2$ or $(1, 0, 1)$ has matrix
            $\begin{pmatrix}1 & 0 \\ 0 & 1\end{pmatrix}$.
        \item $g(x, y) = 4 x^2 + 12 xy + 10y^2$ or $(4, 12, 10)$ has matrix
            $\begin{pmatrix}4 & 6 \\ 6 & 10\end{pmatrix}$.
    \end{itemize}
    Note $g(x, y) = (2 x + 3 y)^2 + y^2 = X^2 + Y^2 = f(X, Y)$, so $f, g$ are related by an integer change of variables.
    But they don't represent the same set of integers - $g$ only represents even integers.
    \begin{equation*}
        \begin{pmatrix} X \\ Y \end{pmatrix}
        =
        \begin{pmatrix} 2 & 3 \\ 0 & 1 \end{pmatrix}
        \begin{pmatrix} x \\ y \end{pmatrix}
        \iff
        \begin{pmatrix} x \\ y \end{pmatrix}
        = \frac{1}{2}
        \begin{pmatrix} 1 & -3 \\ 0 & 2 \end{pmatrix}
        \begin{pmatrix} X \\ Y \end{pmatrix}.
    \end{equation*}
\end{eg}

\begin{defi}
    \leavevmode
    \begin{enumerate}[label=(\arabic*)]
        \item A \textbf{unimodular substitution} is one of the form
            \begin{gather*}
                X = \alpha x + \gamma y, \; Y = \beta x + \delta y, \; \alpha, \beta, \gamma, \delta \in \Z, \; \alpha \delta - \beta \gamma = 1 \\
                \text{so} \;
                \begin{pmatrix} X \\ Y \end{pmatrix}
                =
                \begin{pmatrix} \alpha & \gamma \\ \beta & \delta \end{pmatrix}
                \begin{pmatrix} x \\ y \end{pmatrix}
                = A^T
                \begin{pmatrix} x \\ y \end{pmatrix}
                \, , \;
                A =
                \begin{pmatrix} \alpha & \beta \\ \gamma & \delta \end{pmatrix}
            \end{gather*}
        \item BQFs $f, g$ are \textbf{equivalent} if $f(X, Y) = g(x, y)$ for a unimodular substitution.
    \end{enumerate}
\end{defi}

\begin{remark}
    \leavevmode
    \begin{enumerate}[label=(\arabic*)]
        \item As $A^{-1}$ has integer entries, if $f, g$ are equivalent then they represent the same integers.
        \item (Exercise) This is an equivalence relation
    \end{enumerate}

    More formally,
    \begin{equation*}
        \Set{A = \begin{pmatrix} \alpha & \beta \\ \gamma & \delta \end{pmatrix} | \alpha, \beta, \gamma, \delta \in \Z, \ \alpha \delta - \gamma \beta = 1} = \SL _2(\Z)
    \end{equation*}
    is a group under matrix multiplication ($\det A = 1 \implies A^{-1} \in \SL_2(\Z)$) which acts on the set of BQFs by
    \begin{equation*}
        A : f(x,y) \longmapsto f(\alpha x + \gamma y, \beta x + \delta y)
    \end{equation*}
    and the equivalence classes of BQFs are the orbits of this action.

    We can check this is a group action:
    \begin{equation*}
        A = \begin{pmatrix} 1 & 0 \\ 0 & 1 \end{pmatrix} \implies A f = f
    \end{equation*}
    We must also check $(AB) f = (A (B f))$.

    If $f = (a,b,c)$, $g = Af = (a',b',c')$ for $A = \begin{pmatrix} \alpha & \beta \\ \gamma & \delta \end{pmatrix}$ then
    \begin{align*}
    g(x,y) = f(X,Y) &= \begin{pmatrix}X & Y\end{pmatrix}\begin{pmatrix}a & \frac{b}{2} \\ \frac{b}{2} c \end{pmatrix}\begin{pmatrix}X \\ Y\end{pmatrix} \\
                    &= \begin{pmatrix}x & y\end{pmatrix}A\begin{pmatrix}a & \frac{b}{2} \\ \frac{b}{2} & c \end{pmatrix}A^T \begin{pmatrix}x \\ y\end{pmatrix} \\
        \shortintertext{and}
                    A\begin{pmatrix}a & \frac{b}{2} \\ \frac{b}{2} & c \end{pmatrix}A^T&= \begin{pmatrix} a' & \frac{b'}{2} \\ \frac{b'}{2} & c' \end{pmatrix} \label{eq:9star}\tag{$*$}
    \end{align*}
    So to see that $A(Bf) = (AB)f$, write in matrix form
    \begin{equation*}
    A[B \begin{pmatrix}a & \frac{b}{2}\\\frac{b}{2} & c\end{pmatrix} B^T]A^T = (AB) \begin{pmatrix}a & \frac{b}{2}\\\frac{b}{2} & c\end{pmatrix} B^T A^T
    \end{equation*}
    and $B^TA^T = (AB)^T$.

\end{remark}

\begin{defi}[Discriminant]
    The \textbf{discriminant} of $f = ax^2 + b x y + c y^2$ is $\mathrm{disc}(f) = b^2 - 4ac$.
    Observe $\mathrm{disc}(f) = -4 \times \det\begin{pmatrix}a & \frac{b}{2} \\ \frac{b}{2} & c\end{pmatrix}$.
\end{defi}

\begin{eg}
    \begin{align*}
        \mathrm{disc}(1, 0, 1) &= -4 \\
        \mathrm{disc}(4, 12, 10) &= -16
    \end{align*}
\end{eg}

\begin{nlemma}\label{lem:4.2}
    Equivalent forms have the same discriminant (so the discriminant is an invariant of BQFs under equivalence).
\end{nlemma}

\begin{proof}
    Take identity \eqref{eq:9star}:
    \begin{align*}
        \begin{pmatrix} a' & \frac{b'}{2} \\ \frac{b'}{2} & c \end{pmatrix}
        &= A \begin{pmatrix} a & \frac{b}{2} \\ \frac{b}{2} & c \end{pmatrix}
        A^T \\
        \implies \mathrm{disc}(a', b', c') &= \mathrm{disc}(a, b, c) \det A \det A^T \\
                                           &= \mathrm{disc}(a, b, c) \qedhere
    \end{align*}
\end{proof}

\begin{remark}
    The converse is false: forms of the same discriminant need not be equivalent:
    \begin{equation*}
        f = (1, 0, 6) = x^2 + 6y^2, \; g = (2, 0, 3) = 2x^2 + 3y^2
    \end{equation*}
    and $\mathrm{disc}(f) = -24 = \mathrm{disc}(g)$, but $f$ represents 1 and $g$ doesn't.
\end{remark}

\begin{nlemma}\label{lem:4.3}
    $\exists$ BQF $f$ with $\mathrm{disc}(f) = d \iff d \equiv 0 \ \text{or}\ 1 \pmod{4}$.
\end{nlemma}
\begin{proof}
    $\implies$ $d = \disc(a, b, c) = b^2 - 4ac \equiv b^2 \pmod{4} \implies d \equiv 0 \text{ or } 1 \pmod{4}$
    \begin{align*}
        \impliedby& & \text{if } d &\equiv 0 \pmod{4} & \text{then}& &\disc\left(1, 0, -\frac{d}{4}\right) &= d \\
                  & & \text{if } d &\equiv 1 \pmod{4} & \text{then}& &\disc\left(1, 1, \frac{1-d}{4}\right) &= d
    \end{align*}
\end{proof}

% Lecture 10

\begin{defi}\hypertarget{def:definite}
    A real quadratic form
    \begin{equation*}
        f(\vec{x}) = \sum_{1 \leq i \leq j \leq n} a_{ij} x_i x_j \quad (a_{ij} \in \R)
    \end{equation*}
    is
    \begin{itemize}
        \item \textbf{positive definite} if $\forall 0 \neq x \in \R^n$, $f(\vec{x}) > 0$
        \item \textbf{negative definite} if $\forall 0 \neq x \in \R^n$, $f(\vec{x}) < 0$
        \item \textbf{indefinite} if $\exists \vec{x}, \vec{x'} \in \R^n$ with $f(\vec{x} )> 0 > f(\vec{x'})$
    \end{itemize}
\end{defi}

Consider the case $n = 2$:

\begin{nlemma}\label{lem:4.4}
    Take $f=(a,b,c)$ a BQF with $d = b^2 - 4ac$.
    \begin{enumerate}[label=(\roman*)]
        \item $d<0,\ a>0 \implies f$ is \hyperlink{def:definite}{positive definite}
        \item $d<0,\ a<0 \implies f$ is \hyperlink{def:definite}{negative definite}
        \item $d>0 \implies f$ is \hyperlink{def:definite}{indefinite}
        \item $d=0 \implies f = l(m x + ny)^2 \quad l,m,n \in \Z$
    \end{enumerate}
\end{nlemma}

\begin{proof}
    \begin{enumerate}[label=(\roman*)]
        \item,(ii) $d < 0$, so $ac > 0$ and $a,c$ have the same sign.
            \begin{equation*}
                4a f(x, y) = 4 a^2 x^2 + 4 a b x y + 4 a c y^2 = (2ax+by)^2 - dy^2
            \end{equation*}
            so $\forall x, y \in \R$, $4a f(x, y) \geq 0$ (as $d < 0$) with equality if and only if $x = y = 0$.
            $f$ is positive definite if $a > 0$ and negative definite if $a < 0$.
        \setcounter{enumi}{2}
    \item Assume $d > 0$ and $a > 0$.
        Consider $f(x, 1) = a x^2 + b x + c = a(x - \alpha)(x - \beta)$ with real $\alpha < \beta$ and
        \begin{equation}
            \alpha, \beta = \frac{-b \pm \sqrt{d}}{2a}
        \end{equation}
        If $\frac{r}{s} \in \Q$,
        \begin{equation*}
            f(r, s) = s^2 f(\frac{r}{s}, 1) = a s^2 (\frac{r}{s} - \alpha)(\frac{r}{s} - \beta)
        \end{equation*}
        \begin{align*}
            \text{so } \frac{r}{s} &> \beta & f(r, s) &> 0 \\
            \alpha < \frac{r'}{s'} &< \beta & f(r', s') &< 0.
        \end{align*}
        so $f$ is indefinite.
        Indeed $\exists$ integer pairs $(r, s), (r', s')$ with $f(r, s) > 0 > f(r', s')$.

        If $a > 0$ consider $-f$. If $a = 0$, $c \neq 0$ consider $f(1, y)$ instead.
        If $a=c=0$ then $f = b xy$ and $b = \pm \sqrt{d} \neq 0$, so obviously indefinite.
    \item $\alpha = \beta$, left as an exercise.
    \end{enumerate}
\end{proof}

\begin{note}
    We can have $a, b, c > 0$ but $f$ \hyperlink{def:definite}{indefinite}, for instance $(1, 3, 1)$ which has $d > 0$.
    We can also have $b < 0$ but $f$ \hyperlink{def:definite}{positive definite}, for example $(1, -1, 2)$ which has $d < 0$.
\end{note}

From now on, we restrict to positive definite BQFs $(a, b, c)$ with $a,c>0$ and $d = b^2 - 4 ac < 0$.
The first aim is to identify the `simplest' or `smallest' form in each equivalence class.
\begin{eg}
    Take $(10, 34, 29)$ and we look for equivalent forms with smaller coefficients (this has $d=-4$)

    First try to reduce $b=45$ by replacing $x$ with $x + \lambda y$ for suitable $\lambda$.

    \begin{equation*}
        f(x, y) = a x^2 + b x y + c y^2 \implies f(x + \lambda y, y) = x^2 + (b + 2 \lambda a) x y + (\lambda^2 a + \lambda b + c) y^2
    \end{equation*}

    Take $\lambda = \pm 1$, so
    \begin{equation*}
        (a, b, c) \sim (a, b \pm 2a, a \pm b + c) \tag{$*$} \label{eq:proc1}
    \end{equation*}
    and in our example $(10, 34, 29) \sim (10, 14, 5) \sim (10, -6, 1)$.

    To reduce the size of $a$, apply $\begin{pmatrix}0 & -1 \\ 1 & 0\end{pmatrix}$ so $X = y$, $Y = -x$ and
    \begin{equation*}
        (a, b, c) \sim (c, -b, a) \tag{$**$} \label{eq:proc2}
    \end{equation*}

    In the example,
    \begin{align*}
        (10, -6, 1) &\overset{\eqref{eq:proc2}}{\sim} (1, 6, 10) \\
                    &\overset{\eqref{eq:proc1}}{\sim} (1, 4, 5) \\
                    &\overset{\eqref{eq:proc1}}{\sim} (1, 2, 2) \\
                    &\overset{\eqref{eq:proc1}}{\sim} (1, 0, 1)
    \end{align*}
\end{eg}

\begin{remark}
    \begin{itemize}
        \item Applying \eqref{eq:proc1} repeatedly, we can replace $f$ by an equivalent form with the same $a$ and $\abs{b} \leq a$.
        \item Applying \eqref{eq:proc2} repeatedly, we can replace $f$ by an equivalent form with $a \leq c$ and $\abs{b}$ unchanged.
    \end{itemize}
\end{remark}

\begin{defi}
    A positive definite BQF is reduced if either
    \begin{equation*}
        -a < b \leq a < c \text{ or } 0 \leq b \leq a = c.
    \end{equation*}
    Note that in both cases $\abs{b} \leq a \leq c$.

    In the example, $(10, 34, 29)$ is not reduced as $\abs{b} \nleq a$, but $(1, 0, 1)$ is.
\end{defi}

\begin{nlemma}\label{lem:4.5}
    Every positive definite BQF is equivalent to a reduced form.
\end{nlemma}

\begin{proof}Consider the unimodular substitutions
    \begin{align*}
        T_\pm =
        \begin{pmatrix} 1 & 0 \\ \pm 1 & 1 \end{pmatrix} : (a, b, c) \mapsto (a, b \pm 2a, a \pm b + c) \\
        S =
        \begin{pmatrix} 0 & -1 \\ 1 & 0 \end{pmatrix} : (a, b, c) \mapsto (c, -b, a)
    \end{align*}
    If $a > c$, apply $S$ to replace $f$ with an equivalent form with smaller $a$ but $\abs{b}$ unchanged.

    If $a \geq c$ and $\abs{b} > a$, use one of $T_\pm$ to decrease $\abs{b}$ (as $\abs{b \pm 2a} < \abs{b}$ for some $\pm$ since $a < \abs{b}$) leaving $a$ unchanged.

    Repeat. At each step, $a + \abs{b}$ is decreased, and $a + \abs{b} > 0$.
    So the process must terminate; after a finite number of substitutions, we reach a form $(a, b, c)$ with $\abs{b} \leq a \leq c$.
    There are two cases:
    \begin{enumerate}[label=\alph*)]
        \item $a < c$: then $(a, b, c)$ will be reduecd unless $b = -a$ and then
            \begin{equation*}
                (a, b, c) = (a, -a, c) \sim (a, a, c)
            \end{equation*}
            which is reduced since $-a < b = a < c$.
        \item $a = c$, then $(a, b, c)$ will be reduced provided $0 \leq b \leq a$. Otherwise, $-a \leq b < 0$ and then $(a, b, c) = (a, b, c) \sim (a, -b, a)$ which is reduced. \qedhere
    \end{enumerate}
\end{proof}

\begin{remark}
    We showed that our form was equivalent to a reduced form using only the substitutions $S$, $T_\pm$.
    With a bit more work, this shows that any unimodular substitution may be written as a product of $S$s and $T_\pm$s, so $SL_2(Z)$ is generated by $S$ and $T_+$.
\end{remark}

% Lecture 11

\begin{nlemma}\label{lem:4.6}
    Let $f = (a,b,c)$ be a reduced positive definite BQF, $d = b^2 - 4ac < 0$.
    Then $\abs{b} \leq a \leq \sqrt{\frac{\abs{d}}{3}}$ and $b \equiv d \pmod{2}$.
\end{nlemma}

\begin{remark}
    For fixed $d$, there are only finitely many possible $(a, b)$, and $c = \frac{b^2 - d}{4a}$, so there is only a finite number of reduced forms of discriminant $d$.
\end{remark}

\begin{proof}
    $b^2 \equiv d \pmod{4}$ so $b \equiv d \pmod{2}$.
    $f$ is reduced $\implies \abs{b} \leq a \leq c$, and $d = b^2 - 4ac \leq ac - 4ac = -3ac \leq -3a^2$, so $a^2 \leq \frac{1}{3} \abs{d}$.
\end{proof}

\begin{eg}
    Take $d = -4$.
    Then $\abs{b} \leq a \leq 1$, and $b \equiv 0 \pmod{2}$ so $a = 1, b=0 \implies c=1$.
    So the only reduced BQF of discriminant -4 (positive definite) is $x^2 + y^2$.

    Use this to prove the `serious' part of \cref{thm:4.1}: if $p \equiv 1 \pmod{4}$ then $p = x^2 + y^2$, $x, y \in \Z$.

    \begin{proof}
        $p \equiv 1 \pmod{4} \implies \legendre{-1}{p} = 1$, so $\exists u, k \in \Z$ such that $u^2 = -1 + pk$.
        Let $f = (p, 2u, k)$. Then $f(1, 0) = p$, $disc(f) = 4u^2 - 4pk = -4$.

        But by \cref{lem:4.5} and the last calculation, $f$ is equivalent to $x^2 + y^2$. So $\exists x, y \in \Z$ such that $x^2 + y^2 = p$.
    \end{proof}
\end{eg}

This method can be applied more generally.
Note if $f(x, y) = n$ then $f(kx, ky) = k^2n$.

Recall $f$ represents $n$ if $\exists x, y \in \Z$ such that $f(x,y) = 1$.
\begin{defi}[Proper representation]
    $f$ \textbf{properly represents} $n$ if $\exists x, y \in \Z$ such that $f(x, y) = n$ and $(x, y) = 1$ (in particular $(x, y) \neq (0, 0)$.)
\end{defi}

\begin{remark}
    Suppose $f(x, y) = g(X, Y)$ with $\begin{pmatrix}X \\ Y\end{pmatrix} = \begin{pmatrix}\alpha & \gamma \\ \beta & \delta\end{pmatrix} \begin{pmatrix}x \\ y\end{pmatrix}$ and $\alpha\delta - \beta \gamma = 1$, so $\begin{pmatrix}\delta & -\gamma \\ -\beta &  \alpha \end{pmatrix} \begin{pmatrix}X \\ Y\end{pmatrix}$.
    For $x, y \in \Z$, $\gcd(x, y) = \gcd(X, Y)$, so $f, g$ properly represent the same integers.
\end{remark}

\begin{nlemma}\label{lem:4.7}
    The least integers properly represented by a reduced positive definite BQF $f = (a, b, c)$ are $a$, $c$ and $a - \abs{b} + c$ in that order.
\end{nlemma}
A number in this list is repeated $\iff$ it is (properly) represented by $f$ in more than one way -- excluding $f(x, y) = f(-x, -y)$.
For example, take $f=x^2 + y^2 = (1, 0, 1)$. $f(1, 0) = a = f(0, 1) = c < f(1, 1) = 2 = a - \abs{b} + c$.

\begin{proof}
    If $f(x, 0) = n$ properly, then $(x, y) = 1 \implies x = \pm 1 \implies n = f(1, 0) = a$.
    If $f(0, y) = n$ properly, then $y = \pm 1 \implies n = f(0, 1) = c$. \\
    Suppose $n = f(x, y), \abs{x} \geq \abs{y} > 0$, $\gcd(x, y) = 1$. \\
    Then
    \begin{align*}
        n = a x^2 + b xy + cy^2 &\geq a x^2 - \abs{b} \abs{x} \abs{y} + c y^2 \\
                                &\geq a x^2 -\abs{b} x^2 + c y^2 \\
                                &\geq (a - \abs{b}) + c \geq c
    \end{align*}

    For a choice of sign, $f(1, \pm1) = a \pm b + c = a - \abs{b} = c$. So $a \leq c \leq a - \abs{b} + c$ are the least values properly represented by $f$.
\end{proof}

\begin{nthm}\label{thm:4.8}
    Every positive definite BQF is equivalent to a \emph{unique} reduced form.
\end{nthm}

\begin{proof}
    By \cref{lem:4.5}, every positive definite BQF is equivalent to some reduced form, so have to show that if $f \sim g$ and $f, g$ are reduced, then $f = g$.
    Say $f = (a, b, c) \sim g=(a', b', c')$ are both reduced.

    By \cref{lem:4.7}, the least $n$ properly represented by $f$ is $a$, and by $g$ is $a'$, so $a = a'$.
    The next least integer properly represented by $f$ is $c$, and by $g$ is $c'$, so $c = c'$.
    (The $a=c$ case needs to be taken care of, and is left as an exercise).
    So, $b^2 = d + 4ac = d + 4a'c' = b'^2$, so $g = (a, b, c)$ or $g = (a, -b, c)$.

    If $a = c$ then $(a, b', a)$ is reduced $\iff 0 \leq b' \leq a$, so $(a, -b, a)$ is excluded and $f = g$.

    Otherwise $a < c$, $-a < b \leq a$.
    If $(a, -b, c)$ is reduced then $-a < b < a$.
    Then $a < c < a - \abs{b} + c$ (no repeats).
    By the proof of \cref{lem:4.7}
    \begin{equation*}
        f(x, y) =
        \begin{cases}
            a & \iff (x, y) = (\pm 1, 0) \\
            c & \iff (x, y) = (0, \pm 1)
        \end{cases}
    \end{equation*}
    and same for $g$.

    As $g(x, y) = f(X, Y)$, $\begin{pmatrix} X \\ Y \end{pmatrix}=\begin{pmatrix}\alpha & \gamma \\ \beta & \delta\end{pmatrix} \begin{pmatrix} x \\ y\end{pmatrix}$ so $(x, y) = (\pm 1, 0) \iff f=a=g \iff (X, Y) = (\pm 1, 0)$.
    Similarly, $(x,y) = (0, \pm 1) \iff (X, Y) = (0, \pm 1)$ so $\begin{pmatrix}\alpha & \gamma \\ \beta & \delta\end{pmatrix} = \begin{pmatrix}\pm 1 & 0 \\ 0 & \pm 1\end{pmatrix}$.
    As $\alpha \delta - \beta \gamma = 1$, $\begin{pmatrix}\alpha & \gamma \\ \beta & \delta\end{pmatrix} = \pm \begin{pmatrix}1 & 0 \\ 0 & 1 \end{pmatrix}$, hence $g(x, y) = f(\epsilon x, \epsilon y) = f(x, y)$.
\end{proof}

\begin{remark}
    The definition of `reduced' was cooked up precisely to ensure that this Theorem holds.
\end{remark}

\begin{eg}
    For $d = -24$, $x^2 + 6y^2$ and $2x^2 + 3y^2$ are reduced and inequivalent, with $\disc = -24$.
    Are there others?
    $\norm{b} \leq a \leq \sqrt{8}$ so $\abs{b} \leq a \leq 2$, and $b = d = 0 \pmod{2}$.

    For $a = 1$, we have $b=0$ so $c = 6$, giving $(1, 0, 6)$.
    For $a=2$, $b\in \{0, \pm 2\}$ and $c = \frac{b^2 +24}{8}$. $b = \pm 2 \implies c \notin \Z$, so $b=0$ and $c=3$ giving $(2, 0, 3)$.
    So there are no others.
\end{eg}

% Lecture 12

So every positive definite BQF is equivalent to a unique reduced form, and $\exists$ only a finite number of reduced forms of discriminant $d$.
\begin{defi}[Class number]
    The number of positive definite reduced forms of discriminant $d$ is called the \textbf{class number} $h(d)$.
\end{defi}

\begin{eg}
    $h(-4) = 1 = h(-7)$, and $h(-24) = 2$.
\end{eg}

We saw that for given $d$, we can easily work out what the reduced forms are.
How does $h(d)$ behave as a function of $d$?
How many $d$ are there with $h(d) = 1$?
Some results (beyond the scope of this course), mostly using analytic number theory:
\begin{enumerate}
    \item $h(d) \to \infty$ as $d \to -\infty$ (1934 Heilbronn), so $\#\set{d | h(d) \leq X}$ is finite.
        First Siegel showed $h(d) \to \infty$ assuming the generated Riemann hypothesis in analytic number theory.
        Then Heilbronn proved $h(d) \to \infty$ assuming GRH false by a completely different method.
    \item `On average $h(d) \approx \sqrt{\abs{d}}$':
        \begin{equation*}
            \frac{1}{\frac{1}{2} X} \sum_{\substack{0 \geq d \geq -x \\ d\equiv 0,1\pmod{4}}}{h(d)} \sim c \sqrt{X} \text{ for some } c > 0. \tag{(1874, Mertens)}
        \end{equation*}
    \item $h(d) = 1 \iff -d = 3,4,7,8,11,19,43,67,163 \text{ and } 12,16,27,28$.
        It was known since around 1900 that this was true, except for possibly one other $d$ with $-d$ very large.
        (1967 Baker, Stark showed the list was complete, but was actually proved 10 years earlier by Heeger).
    \item $\set{d | h(d) \leq 100}$ is known.
        In fact $\exists$ explicit bound for the largest $\abs{d}$ with $h(d) = N$, but it is not very practical, for $N=1$ is is $e^{5000}$.
        This is nevertheless a very hard result using analytic number theory, algebraic geometry and elliptic curves.
\end{enumerate}

Now study the problem: if $f$ is a BQF and $n \in \Z$, when does $f$ represent $n$?
We've seen the answer for $x^2 + y^2$.
Now partially generalise this to positive definite BQFs.
For indefinite forms look at the section on continued fractions the method is very different.

\begin{nlemma}\label{lem:4.9}
    Let $f$ be a BQF, $n \in \Z$. Then $f$ properly represents $n \iff f \sim g = (a, b, c)$ with $a =n$.
\end{nlemma}

\begin{proof}
    $(\impliedby)$. $g(n, b, c) \implies g(1, 0) = n$, so $g$ represents $n$ properly. Hence if $f \sim g$, so does $g$. \\
    $(\implies)$ $f$ properly represents $n$ means $\exists \gamma, \delta \in \Z$ with $f(\gamma, \delta) = n$ and $(\gamma, \delta) = 1$.
    Then $\exists \alpha, \beta \in \Z$ such that $\alpha \delta - \beta \gamma = 1$ by Euclid.
    Let $g(x) = f(\gamma x + \alpha y, \delta x +\beta y) \sim f$.
    Then $g(1, 0) = f(\gamma, \delta) = n$, i.e. $g = (n, b, c)$.
\end{proof}

Recall $p = x^2 + y^2 \iff p = 2$ or $\legendre{-1}{p} = 1$. Generalise:

\begin{nthm}\label{thm:4.10}
    Let $d < 0$ be a discriminant (i.e. $d \equiv 0 \text{ or } 1 \pmod{4}$), $n \geq 1$.
    Then ($n$ is properly represented by some BQF of discrimant $d$) $\iff$ ($x^2 \equiv d \pmod{4n}$ is soluble).
\end{nthm}

\begin{proof}
    $(\implies)$ Suppose $n = f(x, y)$ properly, and $\disc(f) = d$.
    Then \cref{lem:4.9} $\implies f \sim g = (n, b, c)$ with $b, c \in \Z$ and $d = \disc(g) = b^2 - 4cn \implies b^2 \equiv d \pmod{4n}$.  \\
    $(\impliedby)$ Suppose soluble. $\exists b, c \in \Z$ with $b^2 = d + 4 n c$.
    Then $(n, b, c)$ has discriminant $d$, and properly represents $n$.
\end{proof}

\begin{eg}
    What integers are represented (properly) by $f = x^2 + xy + 2y^2$. $\disc(f) = -7$.
    $f$ is reduced. If $(a, b, c)$ is any reduced form of $\disc(f)$ then $\abs{b} \leq a \leq \sqrt{\frac{7}{3}}$ and $b \equiv d \pmod{2}$ is odd, so $a = 1$, $b = \pm 1$, $c = 2$ and $(a, b, c)$ reduced $\implies (a, b, c) = (1, 1, 2)$ so $h(-7) = 1$.

    Let's first consider $f(x,y) = p$, $p$ prime, $p \neq 2, 7$.
    By \cref{thm:4.10}, $p$ is properly represented by $f \iff x^2 \equiv -7 \pmod{4p}$ is soluble
    \begin{align*}
        &\iff \begin{cases} x^2 \equiv -7 \pmod{4} \\ x^2 \equiv -7 \pmod{p}\end{cases} \text{ are soluble}.
        &\iff \legendre{-7}{p} = 1.
    \end{align*}
    But
    \begin{equation*}
        \legendre{-7}{p} = \legendre{-1}{p} (-1)^\frac{p-1}{2} \legendre{p}{7} = \legendre{p}{7} = \begin{cases}1 & p \equiv 1,2,4 \pmod{7} \\ -1 & p \equiv 3,5,6 \pmod{7}\end{cases}.
    \end{equation*}
    Also $f(0, 1) = 2$ and $f(1, -2) = 7$.

    So, a prime $p$ is properly represented $\iff$ $p = 7 \text{ or } p \equiv 1, 2, 4 \pmod{7}$.
\end{eg}
For more general $n$, let $n = 2^{e_2} 3^{e_3} = \prod_p p^{e_p}, e_p \geq 0$ and $e_p = 0$ for all but finitely many $p$.
Then
\begin{equation*}
    x^2 \equiv d \pmod{4n}\text{ is soluble } \iff
    \begin{cases}
        \forall p \neq 2 & x^2 \equiv d \pmod{p^e_p} \\
        \text{and} & x^2 \equiv d \pmod{2^{e_p + 2}}
    \end{cases}
    \text{ are soluble}
\end{equation*}

The next goal is to show if $x^2 \equiv d \pmod{p}$ soluble ($p \nmid d$), then soluble mod $p^e\ \forall e \geq 1$ for $p$ odd, i.e. that the Legendre symbol determines solubility..
% Lecture 13

\begin{nlemma}\label{lem:4.11}
    \begin{enumerate}[label=(\roman*)]
        \item Take $p$ an odd prime, $a \in \Z$ with $\legendre{a}{p} = 1$.
            Then $\forall n \geq 1$, $x^2 \equiv a \pmod{p^n}$ is soluble.
        \item $a \equiv 1 \pmod{8} \implies x^2 \equiv a \pmod{2^n}$ soluble $\forall n \geq 1$.
    \end{enumerate}
\end{nlemma}

\begin{proof}
    \begin{enumerate}[label=(\roman*)]
        \item $\legendre{a}{p} = 1 \implies $ there is a solution to $x^2 \equiv 0 \pmod{p}$.
            So, by induction assume that for some $n \geq 1$, $x^2 = a + k p^n$ for some $k \in \Z$.
            Consider $t \in \Z$, so
            \begin{align*}
                (x + t p^n)^2 &= x^2 + 2 x t p^n + t^2 p^{2n} \\
                              &\equiv a + (k+ 2xt)p^n \pmod{p^{n+1}}.
            \end{align*}
            Since $\legendre{a}{p} \neq 0$, $(a, p) = 1 = (x, p)$. So, $\exists t \in \Z$ such that $k + 2 x t \equiv 0 \pmod{p}$.
            For this $t$, $(x + p^n t)^2 \equiv a \pmod{p^{n+1}}$.
        \item $n \geq 3$ is easy, take $x=1$.
            So again by induction, assume $x^2 = a + 2^n k$ for $n \geq 3$.
            If $k$ even, then $x^2 \equiv a \pmod{2^{n+1}}$. Otherwise,
            \begin{align*}
                (x + 2^{n-1})^2 = x^2 + x 2^n + 2^{2n-2} &\equiv a + (x+k)2^n \pmod{2^{n+1}} \\
                                                         &\equiv a \pmod{2^{n+1}}.
            \end{align*}
    \end{enumerate}
\end{proof}

\begin{eg}
    Continuing the example of $f = (1, 1, 2)$ with $d = -7$,
    $-7 \equiv 1 \pmod{8} \implies x^2 \equiv -7 \pmod{2^n}$ is soluble $\forall n$.
    For $p$ odd and $ p \equiv 1, 2, 4 \pmod{7}, \legendre{-7}{p} = 1 \implies x^2 \equiv -7 \pmod{p^n}$ is soluble $\forall n \geq 1$.
    For $p = 7$: $x^2 \equiv -7 \pmod{7}$ is soluble, but $x^2 \equiv -7 \pmod{49}$ is insoluble, hence insoluble mod $7^n$ $\forall n \geq 2$.
    Conclusion: $f = (1, 1, 2)$ properly represents $n \geq 1$ if and only if
    \begin{equation*}
        n = 2^{e_2} 7^{e_7} \prod_{p \equiv 1, 2, 4 \pmod{7}} p^{e_p} \qquad e_p \geq 0, \; e_7 \in \{0, 1\}
    \end{equation*}
    The numbers represented (not necessarily properly) by $f$ are $k^2 n$, $k \geq 1$ with $n$ as above.
    That is, $n = x^2 + x y + 2y^2$ for some $x, y \in \Z$ if and only if $n = 0$ or every prime $p \not\equiv 1, 2, 4 \pmod{7}$ dividing $n$ divides it to an even power.
\end{eg}

This method completely describes the integers represented by $f$ of discriminant $d < 0$ when $h(d) = 1$.
For $h(d) > 1$, all this tells us is which $n$ are represented by \emph{some} equivalence class of BQFs of discriminant $d$.

Sometimes (as on the example sheet), you can figure out which just by congruence conditions, but usually not.
For example, $x^2 + 23 y^2$ - the representability of $n$ by $x^2 + 23 y^2$ cannot be described using congruence conditions on $p \mid n$.
(Why? Deep algebraic number theory related to `non-abelian reciprocity laws')

\begin{defi}[Fundamental discriminant]\hypertarget{def:fundDisc}
    $d \equiv 0 \text{ or } 1 \pmod{4}$ is a \textbf{fundamental discriminant} if $d \equiv k^2 d'$, where $k \geq 2$ and $d' \equiv 0 \text{ or } 1 \pmod{4}$.
\end{defi}
For fundamental discriminant $d < 0$, Gauss defined composition of 2 BQFs of discriminant $d$ to get a third, turning \{equivalence classes of positive definite BQFs of discriminant $d$\} into an abelian group, the class group.
This turns out to be the ideal class group of the quadratic field $\Q(\sqrt{d})$ (see Number Fields).

Negative definite forms now provide nothing new, but what about indefinite forms?

The key difference between definite and indefinite forms is that for a definite form $f$, $\#\set{(x, y) \in \Z^2 | f(x, y) = n}$ is always finite.
For instance, $x^2 + y^2 = n \implies \abs{x}, \abs{y} \leq \sqrt{n}$. In general, $f(x, y) = n$ is the equation of an ellipse in $\R^2$, so integer points $(x, y)$ on it have bounded size.
On the other hand, if $f$ is indefinite, then there can be infinitely many solutions.
For example, $x^2 - 2y^2$ is indefinite. Consider $x^2 - 2y^1 = 1$. We have solutions $(x, y) = (1, 0)$ and also $(3, 2)$. If $(x, y)$ is a solution, then $(x^2 + 2y^2)^2 - 2 (2xy)^2 = (x^2 - 2y^2)^2 = 1$ as well.
So starting with $(3, 2)$ and repeating gets solutions of arbitrarily large size. We study $x^2 - dy^2 = 1$ later.

What about more variables? For instance, what integer values does $x_1^2 + x_2^2 + \dotsb + x_k^2$ take?

\begin{thm}[1770, Lagrange]
    Every positive integer $n$ is a sum of $4$ squares. So for $k \geq 4$, we are done.
\end{thm}

\begin{proof}
    Not in the scope of this course, but there is a formula for the number of representations involving 'modular forms'.
\end{proof}

Harder is
\begin{thm}[1797, Legendre]
    \begin{equation*}
        n = x^2 + y^2 + z^2 \iff n \neq 4^a (8b + 7)
    \end{equation*}
\end{thm}

\begin{proof}
    The $\implies$ direction is easy, and the usual proof of $\impliedby$ is hard and uses quadratic reciprocity, and Dirichlet's theorem on existence of primes in arithmetic progressions. Again, this is out of scope.
\end{proof}

\clearpage
\section{Distribution of the primes}
\begin{equation*}
    2, 3, 5, 7, 11, 13, 17, \dotsc, 691, \dotsc, 144169, \dotsc
\end{equation*}
an infinite sequence (Euclid).

Two natural questions are:
\begin{enumerate}
    \item How rapidly does the sequence grow?
    \item How (ir)regular e.g. how big are the gaps?
\end{enumerate}

(i) is partially answered by the
\begin{thm}[Prime Number Theorem]
    \begin{equation*}
        \pi(X) = \#\{\text{primes } p \leq X\} &\sim \frac{X}{\log X} \text{ as } X \to \infty \\
                                               &\sim \int_2^X \frac{dt}{\log t} \text{logarithmic integral}
    \end{equation*}
\end{thm}
The proof uses complex analysis.

% Lecture 14
We'll eventually prove
\begin{thm}[Tchebyshev's Theorem]
    $\exists c_2 > c_1 > 0$ such that
    \begin{equation*}
        c_1 \frac{x}{\log x} < \pi(x) < c_2 \frac{x}{\log x}
    \end{equation*}
\end{thm}
For the moment, we'll prove some weaker results:
\begin{nlemma}\label{lem:5.1}
    \begin{equation*}
        \pi(x) \geq \frac{\log x}{2 \log 2} \quad \forall \text{integers } x \geq 1
    \end{equation*}
\end{nlemma}

\begin{proof}
    Let $\{p_1, \dotsc, p_r\} = \{\text{primes } \leq x\}$ (so $\pi(x) = r$).
    If $n \leq x$, $n = k^2 = p_1^{\alpha_1} \dotsm p_r^{\alpha_r}$, $1 \leq K \leq \sqrt{x}$, $\alpha_i \in \{0, 1\}$ (so $K$ is the largest square dividing $n$).
    \begin{gather*}
        \begin{rcases*}
            \leq \sqrt{x} & possibilities for $k$ \\
            \leq 2^r & possibilities for $\alpha_i$s
        \end{rcases*}
        \implies x = \#\{1 \leq n \leq x\} \leq \sqrt{x} 2^r \\
        2^r = 2^{\pi(x)} \geq \sqrt{x} \implies \pi(x) \geq \frac{\log{x}}{2 \log 2}.
    \end{gather*}
\end{proof}

Say $p_n$ is the nth prime.
On average, by the prime number theorem, $p_{n+1} - p_n$ is around $\log X$. But the gap oscillates wildly.

\paragraph{Small gaps} An old conjecture (`twin prime problem') $\exists \infty$ many $n$ with $p_{n+1} = p_n + 2$.
Quite recently: there is a constant $C$ such that for infinitely many $n$, $p_{n+1} \leq p_n + C$.
The best known such constant is $C=246$, from the Polymath project.

\paragraph{Big gaps} By the PNT, at least $\log p_n$ infinitely often.

We will prove:
\begin{thm}[Bertrand's postulate]
    $p_{n+1} \leq 2 p_n$, there is always a prime between $N$ and $2N$.
\end{thm}

Analytic number theory in fact shows that for $n$ sufficiently large, $p_{n+1} - p_n \leq p_n^{0.525}$.

In the other direction, $\exists \infty$ many $n$ such that
\begin{equation*}
    p_{n+1} - p_n > c \frac{\log p_n \log \log p_n \log \log \log \log p_n}{\log \log \log p_n}
\end{equation*}
(and $(\log p_n)^2$ is conjectured).

\begin{nthm}\label{thm:5.2} \leavevmode
    \begin{enumerate}[label=(\roman*)]
        \item $\sum_{p \text{ prime}} \frac{1}{p}$ is divergent
        \item $\prod_{p \text{ prime}} \left(1 - \frac{1}{p}\right)^{-1}$ is divergent i.e. $\prod_{p \leq x} \left(1 - \frac{1}{p}\right)^{-1} \to \infty$ as $x \to \infty$.
    \end{enumerate}
\end{nthm}

\begin{proof}
    First prove (ii)
    \begin{equation*}
        \prod_{p \leq x} \left(1 - \frac{1}{p}\right)^{-1} = \prod{p \leq x} \left(1 + \frac{1}{p} + \frac{1}{p^2} + \dotsc\right) \geq \sum_{n \leq x} \frac{1}{n}.
    \end{equation*}
    If $n = p_1^{e_1} \dotsm p_k^{e_k}$, all $p_i \leq x$ then $\frac{1}{n} = \frac{1}{p_1^{e_1}} \dotsm \frac{1}{p_k^{e_k}}$ occurs in the product and all terms $>0$.
    So as $\sum \frac{1}{n} \to \infty$, the product $\to \infty$ as $x \to \infty$.

    For (i) take logarithms
    \begin{align*}
        \log \prod_{p \leq x} (1 - \frac{1}{p})^{-1} &= \sum_{p \leq x} -\log(1 - \frac{1}{p}) \\
                                                     &= \sum_{p \leq x} (\frac{1}{p} + \frac{1}{2p^2} + \frac{1}{3p^3} + \dotsb) \\
                                                     &= \sum_{p \leq x} \frac{1}{p} + R_x \\
        R_x = \sum_{p \leq x} (\frac{1}{2p^2} + \frac{1}{3p^3} + \dotsb) &\leq \sum_{p \leq x} (\frac{1}{p^2} + \frac{1}{p^3} + \dotsb) \\
                                                                         &= \sum_{p \leq x} \frac{1}{p(p-1)} \\
                                                                         &\leq \sum_{m \geq 2} \frac{1}{m(m-1)} = 1.
    \end{align*}
    As $\prod_{p \leq x} (1 - \frac{1}{p})^{-1} \to \infty$, so does $\log (\prod_{p \leq x} (1 - \frac{1}{p})^{-1})$ and so does $\sum_{p \leq x} \frac{1}{p}$.
\end{proof}

To take these ideas further, Riemann introduced the Riemann $\zeta$-function for complex variables
\begin{equation*}
    \zeta(s) = \sum_{n = 1}^\infty \frac{1}{n^s}
\end{equation*}
(previously considered by Euler for real $s > 1$).

\begin{nprop}\label{prop:5.3}
    The series converges absolutely iff $\Re(s) > 1$.
\end{nprop}

\begin{proof}
    Let $s = \sigma + i t$, $\sigma,t \in \R$.  Then
    \begin{equation*}
        \abs{\frac{1}{n^s}} = \abs{\frac{1}{e^{\log n (\sigma + i t)}}} = \frac{1}{n^\sigma}.
    \end{equation*}
    So the series is absolutely convergent $\iff \sum_{n \geq 1} \frac{1}{n^\sigma}$ converges $\iff \sigma > 1$.
\end{proof}

By complex analysis and uniform convergence $\implies \zeta(s)$ is an analytic function of $s$ for $\Re(s) > 1$.
What has $\zeta$ got to do with primes?

\begin{nthm}\label{thm:5.4}\leavevmode
    \begin{enumerate}[label=(\roman*)]
        \item $\zeta(s) = \prod_{p \text{ prime}} (1 - \frac{1}{p})^{-1}$ - the `Euler product' ($\Re(s) > 1$).
        \item $\zeta(s) \neq 0$ if $\Re(s) > 1$.
    \end{enumerate}
\end{nthm}
\end{document}
