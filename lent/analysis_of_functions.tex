\documentclass{article}

\def\npart {II}
\def\nyear {2017}
\def\nterm {Lent}
\def\nlecturer{Prof C.\ Mouhot}
\def\ncourse{Analysis of Functions}
\input{header}

% preamble
\usepackage{tikz}
\usepackage{mathrsfs}
\usepackage{bm}
\newcommand{\powerset}{\mathscr{P}}
\usetikzlibrary{backgrounds}
\DeclarePairedDelimiter{\ceil}{\lceil}{\rceil}
\DeclarePairedDelimiter{\floor}{\lfloor}{\rfloor}
%\setcounter{section}{-1}
% and here we go!

\begin{document}
% \iffalse
\maketitle
\tableofcontents

% Chapter 1: Integration of functions
% Chapter 2: Vector spaces of functions
% Chapter 3: Fourier decomposition of functions
% Chapter 4: Generalised derivatives of functions (and spaces using them)

% Chapter 1:
    % I. Lebesgue measure/integration
    % II. Integrability and convergence

% I)
\section{Lebesgue theory}
\begin{ex}
    Show pointwise limit of Riemann-integrable functions is not necessarily Riemann-integrable.
    (Hint: Dirichlet function).
\end{ex}

% 1)
\subsection{Recap of measure theory}
Consider a set $X$ and $\powerset(X)$ subsets of $X$.
\begin{defi}[Algebra]\hypertarget{def:algebra}
    $\mathscr{A} \subset \powerset(X)$ is an \textbf{algebra} if it is
    \begin{enumerate}[label=(\roman*)]
        \item stable under finite union
        \item stable under absolute difference
        \item $X \in \mathscr{A}$.
    \end{enumerate}
\end{defi}

\begin{defi}[$\sigma$-algebra]\hypertarget{def:sigAlg}
    $\mathscr{A} \subset \powerset(X)$ is a $\sigma$-\textbf{algebra} if it is
    \begin{enumerate}[label=(\roman*)]
        \item stable under countable union
        \item stable under absolute difference
        \item $X \in \mathscr{A}$.
    \end{enumerate}
\end{defi}

\begin{remark}
    Topologies $\mathscr{T} \subset \powerset(X)$ are (i) stable under \textit{any} union, (ii) finite intersection, (ii) include $X$ and $\emptyset$.
\end{remark}

\begin{remark}
    The property of being a \hyperlink{def:sigAlg}{$\sigma$-algebra} is stable under intersection.
    The smallest $\sigma$-algebra containing some topology $\mathscr{T}$ has elements called \hypertarget{def:borelSet}{\textbf{Borel} sets}, written $\mathcal{B}(X)$.
\end{remark}

\begin{defi}\hypertarget{def:measure}
    Consider $(X, \mathscr{A})$, where $\mathscr{A}$ is a \hyperlink{def:sigAlg}{$\sigma$-algebra}.
    A \textbf{measure} $\mu$ is a function $\mathscr{A} \to [0, +\infty]$ such that $\mu(\emptyset) = 0$.
    It is \textbf{$\sigma$-additive} \hypertarget{def:sigAdd} if
    \begin{equation*}
        \mu\left( \bigcup_{n=1}^\infty A_n\right) = \mu\left( \bigsqcup_{n=1}^\infty A_n\right) = \sum_{n=1}^\infty \mu(A_n).
    \end{equation*}

    Then $X, \mathscr{A}, \mu)$ is a \textbf{measure space}.
    It is called \textbf{complete} \hypertarget{def:completeMeasure} if $A \in \mathscr{A}$ with $B \subset A$ and $\mu(A) = 0$, then $B \in \mathscr{A}$ and $\mu(B)=0$.
\end{defi}

\begin{ex}
    Show \hyperlink{def:sigAdd}{$\sigma$-additivity} is implied by either of the following properties:
    \begin{itemize}
        \item finite additivity and continuity from below
        \item finite $\mu(X) < +\infty$ and finite additivity and continuity from above at $\emptyset$
    \end{itemize}
    where
    \begin{itemize}
        \item continuity from below:
            \begin{equation*}
                A_n \in \mathscr{A}, \mu\left(\bigcup_{k=1}^\infty A_k\right)  = \lim_{n \to +\infty} \mu\left(\bigcup_{k=1}^n A_k\right)
            \end{equation*}
        \item continuity from above
            \begin{equation*}
                A_n \in \mathscr{A}, \mu(A_1) < +\infty, \mu\left(\bigcap_{k=1}^\infty A_k\right)  = \lim_{\mathclap{n \to +\infty}} \mu\left(\bigcap_{k=1}^n A_k\right)
            \end{equation*}
    \end{itemize}
\end{ex}

\begin{ex}
    Find the cardinality of $\mathscr{T}(\R)$, $\mathcal{B}(\R)$, $\mathscr{L}(\R)$ where $\mathscr{L}(\R)$ are the Lebesgue sets, defined by adding all subsets of null sets to $\mathcal{B}(\R)$.
\end{ex}

\begin{thm}
    There is a unique \hyperlink{def:measure}{measure} on $(\R^n, \mathcal{B}(\R^n))$ such that
    \begin{equation*}
        \mu\left(\prod_{i=1}^n [a_i, b_i]\right) = \prod_{i=1}^n (b_i - a_i) \quad a_i \leq b_i \in \R
    \end{equation*}
    called the Lebesgue measure\hypertarget{def:lebMeas}.
\end{thm}
\begin{proof}
    See Probability and Measure.
\end{proof}

\begin{remark}
    \hyperlink{def:lebMeas}{Lebesgue measure} is \hypertarget{def:sigFinite}{$\sigma$-finite}: $\exists$ a countable increasing sequence of sets with finite measure covering $\R^n$.
\end{remark}

\begin{defi}[Measurable function]\hypertarget{def:measFunc}
    Take $(X, \mathscr{A})$, $(Y, \mathscr{B})$ two spaces with \hyperlink{def:sigAlg}{$\sigma$-algebras}.
    A function $f: X \to Y$ is said to be \textbf{measurable} if $\forall B \in \mathscr{B}$, $f^{-1}(B) \in \mathscr{A}$.
\end{defi}

\begin{prop}
    Take $(X, \mathscr{A}), (Y, \mathscr{B})$ two spaces with \hyperlink{def:sigAlg}{$\sigma$-algebras} where $Y$ is a metric space and $\mathscr{B}$ is the collection of \hyperlink{def:borelSet}{Borel sets}.
    Let $f_k: X \to Y$ be a sequence of \hyperlink{def:measFunc}{measurable functions} which converge pointwise to $f:X \to Y$.
    Then $f$ is measurable.
\end{prop}

\begin{proof}
    Since $B$ is formed from open sets through countable union/intersection and difference, it is enough to prove that $\forall U \in \mathscr{T}(Y)$, $f^{-1}(U) \in \mathscr{A}$. (Exercise: Check.)

    Let
    \begin{align*}
        U_n &= \Set{y \in Y | d(y, Y \setminus U) > \frac{1}{n}} \\
        F_n &= \Set{y \in Y | d(y, Y \setminus U) \geq \frac{1}{n}}
    \end{align*}
    so that
    \begin{equation*}
        U_n \subset F_n \subset U_{n+1} \subset \dotsb \subset U
    \end{equation*}
    and $F_n$ are closed.

    We can see $U = \bigcup_{n \geq 1} U_n = \bigcup_{n \geq 1} F_n$ because $U$ is open. % why U open matters? so that all points are indeed included
    Hence,
    \begin{equation*}
        f^{-1}(U) = f^{-1} \left(\bigcup_{n \geq 1} U_n\right) = \bigcup_{n \geq 1} f^{-1}(U_n) \subset \bigcup_{n \geq 1} \bigcup_{l \geq 1} \bigcap_{k \geq l} f^{-1}_k(U_n).
    \end{equation*}
    We used the fact that
    \begin{equation*}f^{-1}(U_n) \subset \bigcup_{l \geq 1} \bigcap_{k \geq l} f_k^{-1}(U_n)\end{equation*}
    To show this, take $x \in f^{-1}(U_n)$, so $f(x) = y \in U_n$.
    We know
    \begin{equation*}
        f_k(x) \xrightarrow{k \to \infty} f(x).
    \end{equation*}
    Since $U_n$ open, $\exists l_x \geq 1$ such that $\forall k \geq l_x, f_k(x) \in U_n$ giving $x \in \bigcap_{k \geq l} f_k^{-1}(U_n)$.

    Continuing,
    \begin{align*}
        f^{-1}(U) &\subset \bigcup_{n \geq 1} \bigcup_{l \geq 1} \bigcap_{k \geq l} f_k^{-1}(U_n). \\
        &\subset \bigcup_{n \geq 1} \bigcup_{l \geq 1} \bigcap_{k \geq l} f_k^{-1}(F_n).
    \end{align*}
    $F_n$ closed, so
    \begin{equation*}
        \bigcup_{l \geq 1} \bigcap_{k \geq l} f_k^{-1} (F_n) \subset f^{-1}(F_n).
    \end{equation*}
    In particular, if $x \in$ LHS, $\exists l \geq 1$ such that $\forall k \geq l$, $f_k(x) \in F_n$.
    Pass to the limit, and $f_n$ closed gives $f(x) \in F_n$, $x \in f^{-1}(F_n)$.

    In conclusion,
    \begin{align*}
        f^{-1}(U) &\subset \bigcup_{n \geq 1} \bigcup_{l \geq 1} \bigcap_{k \geq l} f_k^{-1}(U_n) \subset \bigcup_{n \geq 1} \bigcup_{l \geq 1} \bigcap_{k \geq l} f_k^{-1}(F_n) \\
                  & \subset \bigcup_{n \geq 1} f^{-1}(F_n) = f^{-1}\left(\bigcup_{n \geq 1} F_n\right) = f^{-1}(U).
    \end{align*}
    So, all inclusions are equality: $f^{-1}(U)$ is formed of countable intersections and unions of preimages of sets in $\mathscr{B}$, hence $f^{-1}(U) \in \mathscr{A}$.
\end{proof}

\subsection{Lebesgue integration}
The important result from measures is the existence of Lebesgue measure, and that the `theory' is closed for pointwise convergence.

We move now from Riemann integration to Lebesgue integration.
In Riemann's theory of integration, we approximate the integral with Darboux sums, by dividing the domain. We require the domain to have a total order, while the codomain must be a Banach space.
Conversely, in Lebesgue integration we divide the codomain (again, needing a total order) while the domain must have a \hyperlink{def:measure}{measure} defined on it.
\begin{defi}[Simple]\hypertarget{def:simple}
    $f: (X, \mathscr{A}) \to (\R, \mathcal{B}(R))$ is \textbf{simple} if it is \hyperlink{def:measure}{measurable} and takes a finite number of values in $[0, +\infty)$.
\end{defi}
From here on in, when working on the real line, subsets thereof, or the extended real line the \hyperlink{def:sigAlg}{$\sigma$-algebra} will be the \hyperlink{def:borelSet}{Borel sets}.
\begin{remark}
    $A \subset X$, $\chi_A$ is \hyperlink{def:measFunc}{measurable} iff $A \in \mathscr{A}$ is \hyperlink{def:simple}{simple}.
    The general form of a simple function is $s = \sum \alpha_i \chi_{A_i}$.
\end{remark}
\begin{notation}
    $[0, +\infty] = [0, +\infty) \cup \{+\infty\}$, so the neighbourhoods of $\infty$ are $(a, +\infty]$, and we can have a metric $d(x,y) = \abs{\arctan x - \arctan y}$.
\end{notation}
\begin{prop}
    Let $f: (X, \mathscr{A}) \to [0, +\infty]$ \hyperlink{def:measFunc}{measurable}.
    There is $(s_k)$, a sequence of \hyperlink{def:simple}{simple} functions $s_{k+1} \geq s_k$ converging pointwise to $f$.
\end{prop}
\begin{proof}
    For $n \geq 1$, define
    \begin{align*}
        B_n &= \set{x | f(x) \geq n}  \\
        A_n^i &= \Set{x | f(x) \in \left[\frac{i-1}{2^n}, \frac{i}{2^n}\right]} \quad i=0, \dotsc, n 2^n
    \end{align*}
    Also, set
    \begin{equation*}
    s_n = \begin{cases*}\frac{i-1}{2^n} & on $A_n^i$ \\ n & on $B_n$\end{cases*}
    \end{equation*}
    Check
    \begin{itemize}
        \item $s_{n+1} \geq s_n$ $[A_n^i = A_{n+1}^{2i} \cup A_{n+1}^{2i+1}]$
        \item on $B_n$, $\abs{s_n - f} \leq \frac{1}{2^n}$
        \item on $x \in \bigcap_{k \geq 1} B_n$, $s_n(x) \to +\infty$.\qedhere
    \end{itemize}
\end{proof}
Observe this construction is simply
\begin{equation*}
    s_n = \max\left(n, 2^{-n} \floor*{\frac{x}{2^{n}}}\right)
\end{equation*}
as used in Probability and Measure.

\begin{defi}[Integral of simple function]
    Take  $(X, \mathscr{A}, \mu)$ and $s$ a \hyperlink{def:simple}{simple} function on it given by $s=\sum_{i=1}^n \alpha_i \chi_{A_i}$, $\alpha_i \in [0, \infty)$.
    For $E \in \mathscr{A}$, define
    \begin{equation*}
        \int_E s \, d\mu = \sum_{i=1}^n \alpha_i \mu(A_i \cap E).
    \end{equation*}
\end{defi}
\begin{remark}
    This induces a new \hyperlink{def:measure}{measure} on $\mathscr{A}$, sending $E \mapsto \int_E s \, d\mu$.
\end{remark}

\begin{defi}[Integral]\hypertarget{def:integral}
    Take $f:(X, \mathscr{A}, \mu) \to [0, \infty]$ \hyperlink{measFunc}{measurable} and $E \in \mathscr{A}$.
    Then define
    \begin{equation*}
        \int_E f \, d \mu \coloneqq \sup\Set{\int_E s \, d\mu | s \leq f} \in [0, +\infty]
    \end{equation*}
\end{defi}
\begin{remark}
    This \hyperlink{def:integral}{integral} always makes sense. Also, $\int_E f \, d\mu = 0$ if $\mu(E) = 0$.
\end{remark}
\begin{ex}
    Check linearity of the \hyperlink{def:integral}{integral}. Show \hypertarget{def:chebyshev}{Chebyshev's inequality:}
    \begin{equation*}
        \mu(\set{x | f(x) \geq \alpha}) \leq \alpha^{-1} \int_X f \, d\mu \quad \forall \alpha > 0.
    \end{equation*}
    Also show that for $f$ \hyperlink{def:measFunc}{measurable}, $X \to [0, \infty]$
    \begin{equation*}\int_X f \, d\mu < \infty \implies \mu(\set{x | f(x) = \infty}) = 0.\end{equation*}
\end{ex}

\begin{thm}[Beppo-Levi monotone convergence]\hypertarget{thm:Beppo}
    Take $f_k: (X, \mathscr{A}, \mu) \to [0, \infty]$ \hyperlink{def:measFunc}{measurable}, converging pointwise to $f$ with $f_k \leq f_{k+1}$.
    Then $\forall E \in \mathscr{A}$,
    \begin{equation*}\int_E f_k \, d\mu \xrightarrow{k \to \infty} \int_E f \, d\mu.\end{equation*}
\end{thm}
\begin{proof}
    Reduce to $E = X$ by consdering $f_k \chi_E, f \chi_E$.
    Then $\left(\int_X f_k \, d\mu\right)_{k \geq 1}$ is a sequence in $[0, \infty]$, non-decreasing.

    By monotonicity, $f_k \nearrow f$, so $\int_X f_k \, d\mu \leq \int_X f \, d\mu$.
    Let
    \begin{equation*}
        \alpha \coloneqq \lim_{k \to +\infty} \int_X f_k \, d\mu \leq \int_X f \, d\mu.
    \end{equation*}
    Consider a \hyperlink{def:simple}{simple} function $s \leq f$ and $c \in (0, 1)$.
    \begin{gather*}
        E_k = \set{x\in X | f_k(x) \geq c s(x)} \in \mathscr{A} \text{ (using that $f_k$, $s$ are measurable)}\\
        E_k \subset E_{k+1}, \bigcup_{k \geq 1} E_k = X \text{ (by pointwise convergence)}
    \end{gather*}
    Thus $\int_X s \, d\mu = \lim_{k \to \infty} \int_{E_k} s \, d\mu$ (by continuity from below of $\mu$).
    \begin{equation*}
        \int_X f_k \, d\mu \geq \int_{E_k} f_k \, d \mu \geq c \int_{E_k} s \, d \mu
    \end{equation*}
    Take $k \to +\infty$. $\alpha \geq c \int_X s \, d\mu$, and let $c \nearrow 1$, giving $\int_X s \, d\mu$.
    Taking the supremum over $s \leq f$ for $s$ simple,
    \begin{equation*}
        \alpha \geq \int_X f \, d\mu.\qedhere
    \end{equation*}
\end{proof}

\begin{ex}
    Taking $f_k$ as above, show
    \begin{equation*}
        \int_X \left(\sum_{k \geq 1} f_k\right) \, d\mu = \sum_{k \geq 1} \int_X f_k \, d\mu.
    \end{equation*}
    Let $\nu: A \in \mathscr{A} \mapsto \int_A f \, d\mu$ (for $f: X \to [0, +\infty]$ \hyperlink{def:measFunc}{measurable}).
    Show that for any \hyperlink{def:measure}{measure} $g: (X, \mathscr{A}, \mu) \to [0, +\infty]$, $\int_X g \, d\mu = \int_X fg \, d\mu$.
\end{ex}
\begin{thm}[Fatou's lemma]\hypertarget{thm:fatou}
    Take $f_k$ as above, then
    \begin{equation*}
        \int_X (\liminf f_k) \, d\mu \leq \liminf \left(\int_X f_k \, d\mu\right)
    \end{equation*}
\end{thm}

\begin{proof}
    Let $F_k = \inf\set{f_l | l \geq k}$, non-decreasing, valued in $[0, +\infty]$.
    These are measurable: $\{F_k \geq a\} = \bigcap_{l \geq k} \{f_l \geq a\}$.
    Observe that $\int \min(f, g) \, d\mu \leq \min(\int f \, d\mu, \int g \, d\mu)$.
    Now, by \hyperlink{thm:Beppo},
    \begin{align*}
        \int_X (\liminf f_k) \, d\mu &= \int_X (\lim F_k) \, d\mu = \lim_{k \to +\infty} \left(\int_X F_k \, d\mu\right) \\
                                     &= \lim_{k \to \infty} \left(\int_X \left( \inf_{l \geq k} f_l\right) \, d\mu\right) \\
                                     &\leq \lim_{k \to \infty} \inf_{l \geq k} \left(\int_X f_l \, d\mu\right)\\
                                     &\leq \liminf_{k \to \infty} \int f_k \, d\mu.\qedhere
    \end{align*}
\end{proof}
\begin{defi}[Integrable]
    $f: (X, \mathscr{A}, \mu) \to \C$ measurable is integrable if $\abs{f}: X \to [0, +\infty)$ satisfies $\int_X \abs{f} \, d\mu < +\infty$.
\end{defi}
Compute by splitting $f$ into real and imaginary parts, and each into nonnegative and nonpositive parts.

\begin{thm}[Lebesgue's Dominated Convergence]
    Take $f_k: (X, \mathscr{A}, \mu) \to \C$ where
    \begin{itemize}
        \item convergence: $f_k$ converges pointwise to $f$
        \item domination: $\exists g$ integrable such that $\abs{f_k} \leq g$ $\forall k \geq 1$.
    \end{itemize}
    Then $f_k, f$ integrable and $\int_X \abs{f_k - f} d \mu \to 0$.
\end{thm}

\begin{proof}
    Let $h_k = 2g - \abs{f - f_k}$, taking values in $[0, +\infty)$.
    Then $h_k \to 2g$ pointwise.
    \begin{gather*}
        \int_X 2g \, d\mu = \int_X (\lim h_k) \, d\mu \hyperlink{thm:fatou}{\leq} \liminf_{k \to \infty} \underbrace{\left(\int_X h_k \, d\mu\right)}_{\mathclap{ = \int_X 2g \, d\mu - \int_X \abs{f_k-f} \, d\mu}}. \\
        \implies \int_X 2g \, d\mu \leq \int_X 2g \, d\mu - \limsup_{k \to \infty} \int_X \abs{f_k - f} \, d\mu.\qedhere
    \end{gather*}
\end{proof}

% lecture 3
% III)
\subsection{Lebesgue spaces}
\begin{defi}[$L^p$ space]\hypertarget{def:lpspace}
    Let $p \in [1, +\infty]$, and $(X, \mathscr{A}, \mu)$ a measure space.
    $\bm{L^p(X)}$ is the set of equivalence classes for almost everywhere equality of functions $f: X \to  \R$ (or $\C$) such that $\abs{f}^p$ is integrable (for $p \in [1, +\infty)$, or $f$ essentially bounded i.e. bounded outside null sets for $p=\infty$).
\end{defi}

\begin{thm}[Riesz-Fischer]\hypertarget{thm:rieszFischer}
    $(\hyperlink{def:lpspace}{L^p(X)}, \norm{\cdot}_{L^p})$ is a Banach space for $p \in [1, +\infty]$, where
    \hypertarget{def:lpnorm}{
    \begin{equation*}
        \norm{f}_{L^p} \coloneqq \left(\int_X \abs{f}^p\right)^{\frac{1}{p}}, \quad \norm{f}_{L^\infty} \coloneqq \inf\set{M \geq 0 | \mu\{\abs{f(x)} \geq M\} = 0}.
    \end{equation*}}
\end{thm}
\begin{ex}
    Take $\mu(X) < \infty$, so the domain of $f$ is a finite \hyperlink{def:measure}{measure} space. Take $f \in \hyperlink{def:lpspace}{L^\infty(X)}$, then show $f \in L^p(X)$ for any $p \in [1, \infty)$ and
    \begin{equation*}
        \lim_{p \to \infty} \norm{f}_{L^p(X)} = \norm{f}_{L^\infty(X)}.
    \end{equation*}
\end{ex}

\begin{proof}
    Vector space axioms and triangular inequality (here called Minkowski) left as an exercise - see Linear Analysis.
    Instead, we focus on completeness. Start with $p \in [1, +\infty)$.

    Initially, prove this auxiliary result.
    \textbf{Claim}: Take $p \in [1, +\infty)$, and consider a sequence $(g_k) \in L^p(X)$ such that $\sum_{k \geq 1} \norm{g_k}_{L^p(X)} = M < \infty$, then there exists $G \in L^p(X)$ such that $\sum_{k=1}^n g_k$ converges to $G$ in $L^p(X)$ and almost everywhere.

    \textbf{Proof of the claim}: Let
    \begin{equation*}
        h_n \coloneqq \sum_{k=1}^n \abs{g_k}, \quad h \coloneqq \sum_{k=1}^\infty \abs{g_k} \in [0, +\infty].
    \end{equation*}
    $(h_n)$ is a non-decreasing sequence since $h_n \leq h_{n+1}$, and $h_n \to h$ pointwise.
    Hence, \hyperlink{thm:Beppo}{Beppo-Levi} gives that
    \begin{equation*}
        \int_X h_n^p \, d\mu \to \int_X h^p  \, d\mu \in [0, +\infty].
    \end{equation*}
    By the assumption on $(g_k)$,
    \begin{align*}
        &\implies \norm{h_n}_{L^p(X)} \leq \sum_{k=1}^n \norm{g_k}_{L^p(X)} \leq M < +\infty \\
        &\implies \norm{h}_{L^p(X)} \text{ is finite and less than } M.
    \end{align*}
    Hence $h$ finite almost everywhere, and $\sum g_k$ is absolutely convergent almost everywhere, so convergent almost everywhere.

    Let us call $G = \lim_{k \to \infty} \sum_{k=1}^n g_k$ (almost everywhere).
    \begin{equation*}
        \abs{G(x)} \leq \abs{\sum_{k=1}^n g_k} \leq \sum_{k=1}^\infty \abs{g_k} = h(x)
    \end{equation*}
    so $G \in L^p(X)$.

    Using the Dominated Convergence Theorem,
    \begin{equation*}
        \int_X \abs{G(x) - \sum_{k=1}^n g_k}^p \, d\mu \to 0
    \end{equation*}
    since the integrand converges pointwise to 0, and the domination is given by
    \begin{equation*}\abs{G(x) - \sum_{k=1}^n g_k}^p \leq 2^p h(x)^p,\end{equation*} where $h^p$ integrable since $G \in L^p(X)$ and $\sum_{k=1}^m g_k \to G$ in $L^p(X)$ and almost everywhere.
    This proves the claim, so we go back to the main proof.

    Let $(f_k)$ be a Cauchy sequence in $L^p(X)$.
    Build a subsequence $(f_{\phi(k)})$ such that $g_k \coloneqq f_{\phi(k+1)} - f_{\phi(k)}$ satisfies $\norm{g_k}_{L^p(X)} \leq \frac{1}{2^k}$, so $g_k$ satisfies the assumptions of the claim.
    Hence, $\exists G \in L^p(X)$ such that $\sum_{k=1}^n g_k \to G$ almost everywhere and in $L^p(X)$. But $g_k = f_{\phi(n+1)} - f_{\phi(n)}$.
    So,
    \begin{equation*}
        f_{\phi(n)} \longrightarrow f_{\phi(1)} + G \eqqcolon F
    \end{equation*}
    where the convergence is in $L^p(X)$ and almost everywhere.
    But $(f_n)$ Cauchy in $L^p(X)$, so $f_n \to F$ in $L^p(X)$.
\end{proof}

\begin{remark}
    Take $(f_n)$ convergent in $L^p(X)$, $f_n \to F$ in $L^p(X)$. Then (we proved) $\exists$ subsequence $f_{\phi(n)} \to F$ converging almost everywhere.
\end{remark}
\begin{ex}
    \leavevmode
    \begin{enumerate}[label=\arabic*)]
        \item Find a sequence $(f_n)$ converging in $\hyperlink{def:lpspace}{L^p}(\R)$ and not converging almost everywhere to its $L^p$ limit (for $p \in [1, \infty)$). This shows passing to a subsequence was necessary, and not a defect of the argument.
        \item Complete the proof of \hyperlink{thm:rieszFischer}{Riesz-Fischer} theorem in the $p=\infty$ case.
    \end{enumerate}
\end{ex}

\begin{thm}[Abstract density result]
    Take a measure space $(X, \mathscr{A}, \mu)$ and $p \in [1, \infty]$. Then \hyperlink{def:simple}{simple functions} that belong to \hyperlink{def:lpspace}{$L^p(X)$} are dense in $L^p(X)$.
\end{thm}
\begin{proof}
    For $f$ real or complex, split into real/imaginary parts and positive/negative parts to reduce to approximating $f \geq 0$ by \hyperlink{def:simple}{simple} functions.
    Define
    \begin{equation*}
        S_n =
        \begin{cases}
            n & \text{on } B_n = \set{f \geq n} \\
            \frac{i-1}{2^n} & \text{on } A_n^i = \{f \in [\frac{i-1}{2^n}, \frac{i}{2^n})\}, 1 \leq i \leq n 2^n
        \end{cases}
    \end{equation*}
    our usual approximation.
    In the case $p=\infty$, $\norm{f}_{L^\infty(X)} < \infty$, thus for $n > \norm{f}_{L^\infty(X)}$, $\abs{S_n-f} \leq \frac{1}{2^n}$ almost everywhere. Then $\norm{S_n-f}_{L^\infty(X)} \leq \frac{1}{2^n} \to 0$.
    In the case $p \in [1, \infty)$, $0 \leq S_n \leq f$ and $S_{n+1} \geq S_n$, with $S_n \to f$ pointwise. By \hyperlink{thm:Beppo}{Beppo-Levi monotone convergence}, $\norm{S_n - f}_{L^p(X)} \to 0$.
\end{proof}

\begin{thm}[Density-separability of $L^p(\R^n)$, $p \in [1, +\infty)$]
    \leavevmode
    \begin{enumerate}[label=(\arabic*)]
        \item For $\mathcal{O}$ an open set in $\R^n$, $L^p(\mathcal{O})$ is separable (has a countable dense subset).
        \item Smooth functions compactly supported in $\mathcal{O}$ are dense in $L^p(\mathcal{O})$.
    \end{enumerate}
\end{thm}

We need and admit a theorem from Probability and Measure (this statement is non-examinable).
\begin{defi}[Regular measure]\hypertarget{def:regularMeasure}
    A regular \hyperlink{def:measure}{measure} on a topological space $X$ with \hyperlink{def:sigAlg}{$\sigma$-algebra} $\mathscr{A}$ of \hyperlink{def:measFunc}{measurable} sets is a measure such that every measurable set can be approximated from above by open measurable sets and from below by compact measurable sets.
\end{defi}
\begin{thm}[Regularity of the Lebesgue measure]
    The \hyperlink{def:lebMeas}{Lebesgue measure} on $\R^n$ is regular for the Lebesgue sets.
\end{thm}
Observe this implies that any Lebesgue set of finite \hyperlink{def:measure}{measure} in $\R^n$ is squeezed between two \hyperlink{def:borelSet}{Borel sets} with the same measure.
\begin{proof}
    \leavevmode
    \begin{enumerate}[label=(\arabic*)]
        \item Let $\mathcal{C} = \{\text{open sets of the form } \prod_{i=1}^n (a_i, b_i), a_i, b_i \in \Q\}$, a countable set.

            Claim: Any open set $\mathcal{U} \subset \R^n$ can be covered with a countable union of elements of $\mathcal{C}$ with disjoint interiors.

            Use an inductive procedure: Split into $\Z^n$.
            \begin{enumerate}[label=\arabic*.]
                \item Keep cubes that are fully inside, discard ones that are fully outside.
                \item For borderline cubes, divide into $2^n$ cubes evenly and go back to step 1.
            \end{enumerate}
            Check that $\mathcal{U} = \bigcup_{n, k} C_{n, k}$, and note that the hypercubes have dyadic, hence rational coordinates.
            The figure shows a few steps for an example in $\R^2$.
            \begin{center}
                \begin{tikzpicture}[scale=1.4]
                    \begin{scope}[every path/.append style={gray, ultra thin}]
                        \fill [orange!10] (2, 1) rectangle (6, 2);
                        \fill [orange!10] (3, 2) rectangle (6, 3);

                        \begin{scope}[xshift=4cm, yshift=3cm, scale=1/2]
                            \fill [orange!20] (1, 0) rectangle (2, 1);
                            \begin{scope}[every path/.append style={fill=orange!28, line width=0.06pt}, scale=1/2]
                                \foreach \y/\b/\e in {0/0/1,0/1/2,1/1/2}
                                \fill (\b,\y) rectangle (\e,\y+1);
                                \begin{scope}[every path/.append style={fill=orange!35}, scale=1/2]
                                    \fill (0, 2) rectangle (2, 3);
                                    \fill (4, 4) rectangle (8, 5);
                                    \fill (7, 5) rectangle (8, 6);
                                    \begin{scope}[every path/.append style={fill=orange!43, line width=0.03pt}, scale=1/2]
                                        \foreach \y/\b/\e in {6/1/4,7/3/4,8/5/8,10/10/14,11/13/14}
                                        \fill (\b,\y) rectangle (\e,\y+1);
                                        \begin{scope}[every path/.append style={fill=orange!50}, scale=1/2]
                                            \foreach \y/\b/\e in {12/0/2,13/1/2,14/4/6,16/8/10,18/13/16,19/15/16,20/18/20,22/23/26,24/29/32}
                                            \fill (\b,\y) rectangle (\e,\y+1);
                                            \foreach \y/\b/\e in {13/0/1, 14/0/4, 15/3/6, 16/5/8, 17/7/10, 18/9/13, 19/12/15,
                                                                  20/14/18, 21/17/20, 22/19/23, 23/22/26, 24/25/29, 25/28/32, 26/31/32}
                                            \draw [step=0.5] (\b,\y) grid (\e,\y+1);
                                        \end{scope}
                                        \foreach \x/\y/\z in {6/0/1, 7/0/3, 8/2/5, 9/4/8, 10/7/10, 11/9/13, 12/12/16, 13/15/16}
                                        \draw [step=0.5] (\y,\x) grid (\z,\x+1);
                                    \end{scope}
                                    \foreach \x/\y/\z in {3/0/2, 4/1/4, 5/3/7, 6/6/8}
                                    \draw [step=0.5] (\y,\x) grid (\z,\x+1);
                                \end{scope}
                                \draw [step=0.5] (0,1) grid (1,2);
                                \draw [step=0.5] (0,2) grid (4,3);
                                \draw [step=0.5] (3,3) grid (4,4);
                            \end{scope}
                            \draw [step=1] (0, 0) grid (2, 2);
                            \draw [step=0.5] (0, 0) grid (1, 1);
                            \draw [step=0.5] (0, 1) grid (1, 2);
                            \draw [step=0.5] (1, 1) grid (2, 2);
                            \begin{scope}[every path/.append style={line width=0.02pt}, scale=1/32]
                                \foreach \y/\b/\e in {27/0/2,28/1/4,29/3/7,30/6/9,31/8/11,32/10/13,33/12/16,34/15/18,
                                                      35/17/20,36/19/23,37/22/25,38/24/27,39/26/30,40/29/32,41/31/35,
                                                      42/34/37,43/36/40,44/39/43,45/42/45,46/44/48,47/47/51,48/50/54,
                                                      49/53/57,50/56/60,51/59/63,52/62/64}
                                \draw [step=0.5] (\b,\y) grid (\e,\y+1);
                            \end{scope}
                            \begin{pgfonlayer}{background}
                                \begin{scope}[every path/.append style={fill=orange!58}, scale=1/32]
                                    \foreach \y/\b/\e in {26/0/2,28/4/8,29/7/8,30/9/12,31/11/12,32/13/16,34/18/20,36/23/26,
                                                          37/25/26,38/27/30,40/32/36,41/35/36,42/37/40,44/43/46,45/45/46,
                                                          46/48/52,47/51/52,48/54/58,49/57/58,50/60/64,51/63/64}
                                    \fill (\b,\y) rectangle (\e,\y+1);
                                \end{scope}
                                \begin{scope}[every path/.append style={fill=orange!65}, scale=1/64,yshift=1pt,xshift=1pt]
                                    \foreach \y/\b/\e in {54/1/4,56/6/8,58/10/14,59/13/14,60/15/18,61/17/18,62/19/22,
                                                          64/24/26,66/29/32,67/31/32,68/33/36,70/38/40,72/43/46,73/45/46,
                                                          74/47/50,76/52/54,78/57/60,79/59/60,80/62/64,82/67/70,83/69/70,
                                                          84/72/74,86/77/80,87/79/80,88/82/86,89/85/86,90/87/90,92/93/96,
                                                          93/95/96,94/98/102,95/101/102,96/104/108,97/107/108,98/110/114,
                                                          99/113/114,100/116/120,101/119/120,102/122/126,103/125/126}
                                    \fill (\b,\y) rectangle (\e,\y+1);
                                \end{scope}
                            \end{pgfonlayer}
                        \end{scope}
                        %\begin{scope}[xshift=3cm, yshift=3cm, scale=1/2]
                        %    \begin{scope}[every path/.append style={fill=orange!30, line width=0.06pt}, scale=1/2]
                        %        \fill (3,0) rectangle (4,1);
                        %        \begin{scope}[every path/.append style={fill=orange!40}, scale=1/2]
                        %        \foreach \y/\b/\e in {0/3/6,1/5/6}
                        %        \fill (\b,\y) rectangle (\e,\y+1);
                        %        \begin{scope}[every path/.append style={fill=orange!50, line width=0.03pt}, scale=1/2]
                        %        \foreach \y/\b/\e in {0/3/6,2/8/10,4/12/16,5/15/16}
                        %        \fill (\b,\y) rectangle (\e,\y+1);
                        %            \begin{scope}[every path/.append style={fill=orange!60}, scale=1/2]
                        %            \foreach \y/\b/\e in {0/3/6,2/8/12,3/11/12,4/13/16,5/15/16,6/18/20,8/22/24,10/27/30,11/29/30,
                        %                                  12/31/32}
                        %            \fill (\b,\y) rectangle (\e,\y+1);
                        %            \begin{scope}[every path/.append style={fill=orange!80}, scale=1/2]
                        %            \foreach \y/\b/\e in {0/3/6,2/8/12,3/11/12,4/14/16,6/18/22,7/21/22,8/23/26,
                        %                                  10/28/30,12/33/36,13/35/36,14/37/40,15/39/40,16/41/44,
                        %                                  18/46/48,20/50/54,21/53/54,22/55/58,23/57/58,24/59/62}
                        %            \fill (\b,\y) rectangle (\e,\y+1);
                        %            \end{scope}
                        %            \foreach \y/\b/\e in {0/0/3,1/2/6,2/5/8,3/7/11,4/10/13,5/12/15,6/14/18,7/17/20,
                        %                                  8/19/22,9/21/24,10/23/27,11/26/29,12/28/31,13/30/32}
                        %            \draw [step=0.5] (\b,\y) grid (\e,\y+1);
                        %            \end{scope}
                        %        \foreach \x/\y/\z in {0/0/3, 1/2/6, 2/5/8, 3/7/10, 4/9/12, 5/11/15, 6/14/16}
                        %        \draw [step=0.5] (\y,\x) grid (\z,\x+1);
                        %        \end{scope}
                        %        \foreach \y/\b/\e in {0/0/3,1/2/5,2/4/8,3/7/8}
                        %        \draw [step=0.5] (\b,\y) grid (\e,\y+1);
                        %        \end{scope}
                        %        \foreach \y/\b/\e in {0/0/3,1/2/4}
                        %        \draw [step=0.5] (\b,\y) grid (\e,\y+1);
                        %    \end{scope}
                        %    \draw [step=1] (0, 0) grid (2, 2);

                        %    \draw [step=0.5] (0, 0) grid (1, 1);
                        %    \draw [step=0.5] (1, 0) grid (2, 1);
                        %\end{scope}
                        \node (A) at (1.0, 2.0) {};
                        \node (B) at (2.0, 1.0) {};
                        \node (C) at (6.0, 0.7) {};
                        \node (D) at (6.0, 3.8) {};
                        \node (E) at (3.0, 3.0) {};
                        \draw [bblue] plot [smooth cycle, tension=0.7] coordinates {(A) (B) (C) (D) (E)};
                    \end{scope}
                    \draw [gray, very thin, step=1] (-0.7,-0.7) grid (7.7,4.7);
                    \draw [->] (-0.8, 0) -- (7.9, 0);
                    \draw [->] (0, -0.8) -- (0, 4.9);
                \end{tikzpicture}
            \end{center}

            % This gives
            % \begin{equation*}
            %     s = \sum_{i=1}^k \alpha_i \chi_{c_i} \quad c_i \in \mathcal{C}, \, \alpha_i \in \Q.
            % \end{equation*}

            Take $f \in L^p(\mathcal{O})$, $s_k = \sum_{i=1}^k \alpha \chi_{A_i}$ simple functions such that $s_k \nearrow f$.

            Each $A_i$ (measurable) can be approximated by $U_i$ open sets with $\frac{\epsilon}{k}$ error in measure (outer regularity).
            Each $U_i$ is covered by rational cubes $C_{l, i}$ by the claim:
            \begin{equation*}
                (\infty < \mu(A_i) + \epsilon >) \mu(U_i) = \sum_{e \geq 1} \mu(C_{l, i}).
            \end{equation*}
            Pick up enough (finitely many) $(C_{l, i})_{l=1}^{m_i}$ such that
            \begin{equation*}
                \abs{\mu(U_i) - \sum_{i=1}^{m_i} \mu(C_{l, i})} \leq \frac{\epsilon}{k}.
            \end{equation*}
            Putting together all cubes $(C_{l, i})^k_{i=1, l=1, \dotsc, m_i}$ with error in measure less than $2\epsilon$,
            \begin{align*}
                \tilde{s_k} &= \sum_{i=1}^k \alpha_i \left(\sum_{l=1}^{m_i} \chi_{C_{l, i}}\right)\\
                \tilde{\tilde{s_k}} &= \sum_{i=1}^k \tilde{\alpha_i} \left(\sum_{l=1}^{m_i} \chi_{C_{l, i}}\right)
            \end{align*}
            where $\abs{\alpha_i  -\tilde{\alpha_i}} \leq \frac{\epsilon}{k}$, and $\tilde{\alpha_i} \in \Q$, so $\tilde{\tilde{s_k}}$ belongs to the target set.

            One more approximation step: $L^\infty$ bound on coefficients.
        \item On each $C_{l, i}$ approximate $\chi_{C_{l, i}}$.
            In $C^0$ we can do this easily with affine functions. To approximate with $C^\infty$ functions, we can use translations and copies from a smooth compactly supported functions, for instance $e^{-\frac{1}{x^2}}$.
            % pic of affine functions and the exp thing
            This requires on the continuity of the translation operator in $L^p$. In particular, with the translation operator $\tau_h f = f(\cdot + h_n)$, we need
            \begin{equation*}
                \norm{\tau_h f - f}_{L^p} \xrightarrow{h \to 0} 0.
            \end{equation*}
            We can show this by proving for simple functions, then approximate.
    \end{enumerate}
\end{proof}
\begin{ex}
    Prove $L^\infty(\R^n)$ is not separable. (Hint: consider $(\chi_{B(0, r)})_{r > 0}$).
\end{ex}

\subsection{How regular are integrable/measurable functions}
Take $f \in L^1(\R)$, and let
\begin{equation*}
    \int_0^x f(y) \, dy \eqqcolon F(x).
\end{equation*}
Is $F$ differentiable?
\begin{defi}[Lebesgue point]\hypertarget{def:lebPoint}
    Let $f: \R^n \to \C$ be \hyperlink{def:measFunc}{measurable}. $x \in \R^n$ is a \textbf{Lebesgue point} if
    \begin{equation*}
        \frac{1}{\mu(B(x, r))} \int_{B(x, r)} \abs{f(y) - f(x)} \, dy \xrightarrow{r \to 0} 0.
    \end{equation*}
\end{defi}
\begin{remark}
    \begin{equation*}
        \frac{1}{r} \left(\int_0^{x+r} f - \int_0^x f\right) = \frac{1}{r} \int_x^{x+r} f \xrightarrow{?} f(x) = F'(x).
    \end{equation*}
\end{remark}
\begin{ex}[Worked example]
    Prove that points of continuity are \hyperlink{def:lebPoint}{Lebesgue points}:
    \begin{equation*}
        x \text{ a point of continuity} \implies \forall \epsilon > 0, \, \exists r_0 > 0 \text{ s.t. } \forall y \in B(x, r_0) \, \abs{f(x) - f(y)} < \epsilon.
    \end{equation*}
    Hence for $r < r_0$,
    \begin{equation*}
        \frac{1}{\mu(B(x, r))} \int_{B(x,r)} \abs{f(y) - f(x)} \, d\mu < \epsilon.
    \end{equation*}
    True for any $\epsilon>0$, so we have a Lebesgue point.
\end{ex}
\begin{thm}
    For $f \in L^1(\R^n)$:
    \begin{enumerate}[label=(\arabic*)]
        \item Differentiation: almost every $x \in \R^n$ is a Lebesgue point.
        \item For any $E$ a \hyperlink{def:borelSet}{Borel set} of $\R^n$, for almost every $x \in \R^n$,
            \begin{equation*}
                \frac{\mu(E \cap B(x, r))}{\mu(B(x, r))} \xrightarrow{r \to 0} \chi_E(x).
            \end{equation*}
    \end{enumerate}
\end{thm}
\begin{proof}[Proof (1) $\Rightarrow$ (2)]
    Consider $\abs{x} \leq M$, $r < 1$.
    \begin{equation*}
        \frac{\mu(E \cap B(x, r))}{\mu(B(x, r))} = \frac{\mu(E \cap B(0, M+1) \cap B(x, r))}{\mu(B(x, r))}.
    \end{equation*}
    Apply (1) to $f \coloneqq \chi_{E \cap B(0, M+1)} \in L^1(\R^n)$.
    Do that for any $M \in \N_{\geq 0}$, (2) true for almost every $x \in B(0, M)$, $\forall M \in N_{\geq 0}$, i.e. outside $N_M$.
    $N_0 = \bigcup_{M \geq 1} N_M$ is a null set, (2) true on $\R^n \setminus N_0$.
    %  check phone for pictures of this - grammar is unclear.
\end{proof}
\begin{proof}[Proof of (1)]
    \newcommand{\mf}{m \! f}
    \newcommand{\Mf}{M \! f}
    Note that this is immediately true if $f$ is continuous, from the exercise earlier. So, aim to write $f = g+h$ where $g$ continuous and $\norm{h}_{L^1(\R^n)}$ is as small as is needed.

    \textbf{Step 1}. Define the Hardy-Littlewood operator
    \begin{align*}
        \Mf(x) &\coloneqq \sup_{r \geq 0}  \mf (x, r), \quad \mf(x, r) \coloneqq \frac{1}{\mu(B(x, r))} \int_{B(x,r)} \abs{f} \, d\mu\\
        \shortintertext{and} \\
        \quad E_a &\coloneqq \set{x \in \R^n | \Mf(x) > a} \quad \text{for } a > 0
    \end{align*}
    Claim: $E_a$ is an open set, hence measurable.
    Take $x \in E_a$. $\Mf(x) > a$, so $\exists r >0$ such that $\mf(x) > a$ and $\frac{a}{\mf(x)} < 1$.
    Pick $\epsilon > 0$ small enough such that $(\frac{r}{r+\epsilon}) > \frac{a}{\mf(x, r)}$. Consider $y \in B(x, \epsilon)$, so $B(x, r) \subset B(y, r + \epsilon)$ by triangle inequality.
    \begin{align*}
        \mf(y, r+\epsilon) &= \frac{1}{\mu(B(y, r+\epsilon))} \int_{B(y, r+\epsilon)} \abs{f} \, d\mu \\
                          &\geq \left(\frac{r}{r+\epsilon}\right)^n \frac{1}{\mu(B(x,r))} \int_{B(x, r)} \abs{f} \, d\mu \\
                          &\geq \left(\frac{r}{r+\epsilon}\right)^n \mf(x, r) > a
    \end{align*}
    Conclude that $B(x, \epsilon) \subset E_a$, hence open.

    Now take $x \in E_a$. Relate the volume of a local ball to $\int \abs{f}$:

    \textbf{Step 2}. Vitali's covering lemma.
    Take $X \subset \R^n$, and $X \subset \bigcup_{i=1}^N B(x_i, r_i)$.  Then $\exists J \subset \{1, \dotsc, N\}$ subset of indices such that
    \begin{enumerate}[label=(\alph*)]
        \item $(B(x_i, r_i))_{i \in J}$ are pairwise disjoint
        \item
            \begin{equation*}
                X \subset \bigcup_{i \in J} B(x_i, 3 r_i)
            \end{equation*}
    \end{enumerate}
    Proof: WLOG, take $r_1 \geq r_2 \geq \dotsb \geq r_N$. Consider $B(x_1, r_1)$. All balls that intersect it are entirely included in $B(x_1, 3 r_1)$. % pic to demonstrate
    Remove these intersecting balls, to give a set of indices $J_1$. By induction, start the argument again on the second largest radius.
    The induction preserves the covering property, so we are done.

    % lecture 5
    \textbf{Step 3}. Claim: $\mu(E_a) \leq \frac{3^n}{a} \norm{f}_{L^1(\R^n)}$.

    Let $K \subset E_a$ be compact.
    For each $x \in K$ $\exists r_x$ with $\mf(x, r_x) > a$.
    \begin{align*}
        K &\subset \bigcup_{x \in K} B(x, r_x) \\
          &\subset \bigcup_{i=1}^N B(x_i, r_i) \\
          &\subset \bigcup_{i \in J} B(x_i, 3 r_i)
    \end{align*}
    using compactness to get to the second line, and Vitali's covering lemma for the third. Now,
    \begin{align*}
        \mu(K) &\leq \sum_J \mu(B(x_i, 3 r_i)) \\
               &= 3^n \sum_J \mu(B(x_i, r_i)) \\
               &\leq \frac{3^n}{a} \left(\sum_J \int_{B(x_i, r_i)} \abs{f} \, d\mu\right) \\
               &\leq \frac{3^n}{a} \int_{\bigcup_J B(x_i, r_i)} \abs{f} \, d\mu \\
               &\leq \frac{3^n}{a} \int_{\R^n} \abs{f} \, d\mu.
    \end{align*}
    This bound is independent of $K$, and by inner regularity \begin{equation*}\mu(E_a) = \sup\set{\mu(K) | K \subset E_a \text{ compact}},\end{equation*} giving the required result:
    \begin{equation*}
        \mu(E_a) \leq \frac{3^n}{a} \int \abs{f} \, d\mu = \frac{3^n}{a} \norm{f}_{L^1}.
    \end{equation*}

    \textbf{Step 4}.
    Say $f = g+h$ for $g \in L^1(\R^n)$ continuous, and $h \in L^1(\R^n)$, $\norm{h}_{L^1} < \epsilon$.
    Define
    \begin{equation*}
        t\!f(x, r) = \frac{1}{\mu(B(x, r)))} \int_{B(x, r)} \abs{f(y) - f(x)} \, d \mu(y).
    \end{equation*}
    So,
    \begin{equation*}
        t\!f(x, r) \leq t \! g(x, r) + \frac{1}{\mu(B(x, r))} \int_{B(x, r)} \abs{h(y)} \, dy + \abs{h(x)}.
    \end{equation*}
    Define $T \! f (x) = \limsup_{r \to 0} t \! f(x, r)$, so $T\! f(x) \leq T \! g(x) + M \! h(x) + \abs{h(x)}$, and $T\!g(x)  = 0$ as $g$ is continuous.
    Take $k \in \N$, then
    \begin{align*}
        \mu\left(\Set{x | T \! f > \frac{1}{k}}\right) &\leq \mu\left(\Set{x | M \! h > \frac{1}{k}}\right) + \mu\left(\Set{x | \abs{h} > \frac{1}{2k}}\right) \\
                                            &\leq 2k 3^n \norm{h}_{L^1} + 2k \norm{h}_{L^1} \\
                                            &\leq 2k (3^n+1) \epsilon
    \end{align*}
    using \hyperlink{def:chebyshev}{Chebyshev's inequality} and Step 3.
    This holds $\epsilon > 0$, since continuous functions are dense in $L^1$ so $\mu\left(\Set{x | T \! f > \frac{1}{k}}\right) = 0$.
    Take the (countable) union for all $k\geq 1$, giving $\mu\left(\Set{x | T\! f > 0}\right) = 0$.
    So, almost every $x$ is a \hyperlink{def:lebPoint}{Lebesgue point}.
\end{proof}
Pointwise convergence is `almost' uniform convergence.
\begin{thm}[Egorov's Theorem]\label{thm:egorov}
    Take $f_n: \R^d \to \C$ a sequence of measurable functions, and $A \subset \R^d$ a \hyperlink{def:borelSet}{Borel set} of finite measure, $f_n \to f$ pointwise on $A$.
    Then $\forall \epsilon > 0, \ \exists A_\epsilon \subset A$, $A_\epsilon$ a Borel set with $\mu(A \setminus A_\epsilon) \leq \epsilon$, and $f_n$ converges uniformly to $f$ on $A_\epsilon$.
\end{thm}
\begin{proof}
    Define for $k, n \geq 1$,
    \begin{equation*}
        E_n^{(k)} = \bigcap_{p \geq n} \set{x \in A | \abs{f_p(x) - f(x)} \leq \frac{1}{k}}.
    \end{equation*}
    Check $E_n^{(k)} \subset E_{n+1}^{(k)}$, $E_n^{(k+1)} \subset E_n^{(k)}$ and for fixed $k \geq 1$ $A = \bigcup_{n \geq 1} E_n^{(k)}$ (pointwise convergence).
    Using continuity from below, $\mu(A) = \lim_n \mu(E_n^{(k)})$, so $\exists {n_k \geq 1}$ such that $\Delta_k = A \setminus E_{n_k}^{(k)}$ has measure $\mu(\Delta_k) \leq \frac{\epsilon}{2^k}$.
    Then $\Delta \coloneqq \bigcup_{k \geq 1} \Delta_k$ has measure $\mu(\Delta) \leq \sum \mu(\Delta_k) \leq \epsilon$, and let $A_\epsilon = A \setminus \Delta$.

    Observe there is uniform convergence on $A_\epsilon$: $\forall k \geq 1$, $\exists n_k \geq 1$ such that $A_\epsilon \subset E_{n_k}^{(k)}$.
    This means: $\sup_{x \in A_\epsilon} \abs{f_p(x) - f(x)} \leq \frac{1}{k} \ \forall p \geq n_k$.
\end{proof}

\begin{thm}[Lusin version 1]
    Take $f: \R \to \C$ measurable. Given any $\epsilon > 0$, $\exists E \subset \R$ measurable and $\mu(E) < \epsilon$ such that $f|_{\R \setminus E}$ is continuous.
\end{thm}
\begin{remark}
    Notice this is different from `$f$ continuous at all points in $\R \setminus E$'.
\end{remark}
\begin{proof}[Sketch of long proof]
    Build a sequence $s_n$ of step functions converging to $f$, use \nameref{thm:egorov} and conclude... See full details in \href{https://cmouhot.files.wordpress.com/2017/01/notes-af-v21.pdf}{official notes} (Theorem 1.34).
\end{proof}
\begin{proof}[Short proof]
    It is enough to do it for $f: F \to \C$ (where $F = [l, l+1)$) for any $l \in \Z$, and $E = \bigcup_{l \in \Z} E_l$, $\mu(E_l) \leq \frac{\epsilon}{2^{l+1}}$.
    Take $(V_n)_{n \geq 1}$ an enumeration of open intervals with rational endpoints (intersected with $F$).
    By inner regularity, with $f^{-1}(V_n)$ measurable and $F \setminus f^{-1}(V_n)$ measurable, choose $K_n, K_n'$ compact sets such that $K_n \subset f^{-1}(V_n)$ and $K_n' \subset F\setminus f^{-1}(V_n)$ and $\mu(F \setminus (K_n \cup K_n')) < \frac{\epsilon}{2^n}$.
    Fix open sets $U_n$ such that $K_n \subset U_n$, $U_n \cap K_n' = \emptyset$ (using compactness).
    Now, $K \coloneqq \bigcap_{n \geq } (K_n \cup K_n')$ satisfies
    \begin{equation*}
        \mu(F \setminus K) \leq \sum_{n \geq 1} \mu(F \setminus (K_n \cup K_n')) \leq \epsilon.
    \end{equation*}
    Given $x \in K$, for any $n \geq 1$ such that $f(x) \in V_n$, $\Rightarrow x \in K_n$. Moreover, $K_n \subset U_n$, $U_n$ open hence $f(U_n \cap K) \subset V_n$.
\end{proof}
\begin{thm}[Lusin version 2]
    Take $f: \R \to \C$ measurable. Given any $\epsilon > 0$, $\exists G \subset \R$ with $\mu(G) < \epsilon$ and $g: \R \to \C$ such that $f = g$ on $\R \setminus G$, $g$ continuous.
\end{thm}
\begin{proof}
    The previous theorem implies that $\exists E$ measurable such that $\mu(E) < \frac{\epsilon}{2}$ where $f|_{R \setminus E}$ is continuous.
    Outer regularity gives $\exists G$ open, $G \supset E$, $\mu(G) < \epsilon$ where $G = \bigsqcup_{n \geq 1} I_n$, for $I_n$ open intervals.
    Define
    \begin{equation*}
        g(x) =
        \begin{cases}
            f(x) & x \in \R \setminus G \\
            f(a_n) + \frac{(x-a_n)}{b_n - a_n} (f(b_n) - f(a_n)) & x \in (a_n, b_n)=I_n.
        \end{cases}\qedhere
    \end{equation*}
\end{proof}
\begin{ex}
    Reprove from this that continuous functions are dense in $L^1(\R)$.
\end{ex}

\section{Vector spaces of functions}
% I. Recalls on vector spaces
% II. Separating points and Hahn-Banach theorem
\begin{thm}[Hahn-Banach]
    Take a normed vector space $E$.
    \begin{enumerate}[label=(\roman*)]
        \item Given $E_0$ subspace of $E$, $F:E_0 \to \R$ linear continuous. Then, $\exists \tilde{F}:E \to \R$ continuous linear which extends $F$, and
            \begin{equation*}
                \norm{F}_{E_0'} \coloneqq \sup\set{F(f) | f \in E_0, \norm{f} \leq 1} = \norm{\tilde{F}}_E' = \sup\set{\tilde{F}(f)| f \in E, \norm{f} \leq 1}.
            \end{equation*}
            The letter $f$ is used to encourage thinking about function spaces.
        \item $A$ an open convex non-empty in $E$ and $B$ convex non-empty in $E$ with $A \cap B = \emptyset$.
            Then $\exists F: E \to \R$ continuous linearsuch that
            \begin{align*}
                F &\le \alpha \text{ on } A \\
                F &\geq \alpha \text{ on } B \\
            \end{align*}
            for some $\alpha \in \R$.
        \item A closed convex non-empty $\subset E$, $B$ a compact convex non-empty $\subset E$.$A\cap B= \emptyset$.
            Then $\exists F: E \to \R$ linear continuous such that
            \begin{align*}
                F &\leq \alpha - \epsilon \text{ on } A \\
                F &\geq \alpha + \epsilon \text{ on } B \\
            \end{align*}
            for some $\alpha \in \R$, $\epsilon> 0$.
            % pictures for both
    \end{enumerate}
\end{thm}

% III. Duality and weak topologies
We know that the Bolzano-Weierstrass theorem holds for $\R$, and for $\R^n$ and more generally for $\C^n$.
But, the theorem fails in infinite dimension. For example, take the basis vectors of $\ell^2$.
How can we restore this? In order to get \emph{more} compact sets, we should try taking \emph{fewer} open sets, so weaken the topologies.
\begin{defi}[Initial topologies]
    Take $X$, $(Y_i)_{i \in I}$ topological spaces and a family of functions $\phi_i: X \to Y_i$, then the \textbf{initial topology} is the weakest topology on $X$ that makes all $(\phi_i)_{i \in I}$ continuous.
\end{defi}
\begin{remark}
    There is also a notion of final topology, with $\phi_i: Y_i \to X$ and take the finest topology such that they are all continuous.
\end{remark}
\begin{ex}
    \begin{enumerate}[label=(\arabic*)]
        \item Construct the smallest topology $\mathscr{T}$ (subsets of $X$) that is stable by finite intersection and general union, and contains a given family of subsets $\mathcal{F}$.
        \item Check that $\mathscr{T}$ above is realised by first taking finite intersections of elements of $\mathcal{F}$ and second any union of what you have obtained. (Hint: Prove the resulting $\mathscr{T}$ is stable by finite intersection).
        \item Check that if you reverse these 2 operations, you need to do a third union again.
    \end{enumerate}
\end{ex}
\begin{defi}
    Take $X$ a topological space. A \textbf{neighbourhood} $V$ of $x \in X$ is a subset of $X$ that contains $U \in \mathscr{T}_X$, such that $x \in U \subset V$.
    Call $\mathcal{V}(x)$ the \textbf{neighbourhood system} of all such subsets.
    $\mathcal{B}(x)$ is a \textbf{neighbourhood basis} if any $V \in \mathcal{V}(x)$ contains a $B \in \mathcal{B}(x)$.
\end{defi}
\begin{prop}
    Consider $X$, $(Y_i)_{i \in i}$ topological spaces, and $\phi_i:X \to Y_i$ functions.
    Take $\mathscr{T}$ the \hyperlink{def:initTop}{initial topology} on $X$ as above, $x \in X$, then a possible neighbourhood basis is
    \begin{equation*}
        \mathcal{B}(x) \coloneqq \Set{\bigcap_{\text{finite}} \phi_i^{-1}(\omega_i) | \omega_i \text{open set of } Y_i \text{ containing }\phi_i(x)}
    \end{equation*}
\end{prop}
\begin{proof}
    Use the 2 steps from the exercise. Consider any $V \in \mathcal{V}(x)$, $x \in U \subset V$ for $U$ open.
    \begin{equation*}
        U = \bigcup_{j \in J} \left(\bigcap_{n =1}^{N_j} \phi_{i_n^j}^{-1} (\omega_{j, i_n})\right)
    \end{equation*}
    Hence $\exists j_0 \in J$ such that
    \begin{equation*}
        x \in \bigcap_{n=1}^{N_{j_0}} \phi_{i_n^{j_0}}^{-1} (\omega_{j_0, i_n}) \text{ open}.
    \end{equation*}
\end{proof}
\begin{ex}
    \begin{itemize}
        \item Prove that $x_n \to x$ in $(X, \mathscr{T}_{\text{initial}})$ iff
            \begin{equation*}
                \phi_i(x_n) \to \phi_i(x) \text{ in } Y_i, \text{ for all } i \in I
            \end{equation*}
        \item $Z$ another topological space, $\phi: Z \to X$ is continuous ($X$ has the initial topology) iff $\phi_i \circ \phi: Z \to Y_i$ is continuous for all $i \in I$.
    \end{itemize}
\end{ex}
\begin{remark}
    The product topology on $(\bigotimes_{i \in I} X_i)$ where each $(X_i, \mathscr{T}_i)$ a topological space, is the initial topology with $Y_i = X_i$ with topology $\mathcal{T}_i$ and $\phi_i$ as the canonical projection
    \begin{equation}
        \phi_i: (x_j)_{j \in I} \in \bigotimes_{j \in I} X_j \to x_i
    \end{equation}
    Describe the $B((x_i)_{i \in I}$ as above.
    The induced (subspace) topology is the initial topology for the canonical embedding, and $Y_1$ the whole space.
    The quotient topology can be seen as a final topology.
\end{remark}
\begin{defi}\hypertarget{def:dualSpace}
    Take $E$ a normed vector space. Then $E'$ is the space of linear continuous forms to $\R$:
    \begin{equation*}
        F: E \to \R
    \end{equation*}
    The weak topology on $E'$, denoted $\sigma(E, E')$ is the initial topology for the family of functions $E'$.
\end{defi}
It is the coarsest topology that makes all dual forms continuous.
\begin{prop}
    The topology $\sigma(E, E')$ on $E$ is Hausdorff: distinct points can be separated by disjoint open sets.
\end{prop}
\begin{proof}
    Take the third formulation of the Hahn-Banach theorem:
    Let $f \neq g$ in $E$, set $A = \{f\}$ which is closed convex non-empty and $B=\{g\}$ compact convex. Clearly $A \cap B = \emptyset$.
    Hence $\exists F \in E$, $\alpha \in \R$ such that $f \in U_1 \coloneqq \{F < \alpha\}$ and $g \in U_2 \coloneqq \{F > \alpha\}$, $U_1 \cap U_2$ by definition.
\end{proof}
\begin{remark}
    \begin{itemize}
        \item Prove $\sigma(E, E')$ is not more refined than the strong (original) topology.
        \item In finite dimension, prove $\sigma(E, E') = $ strong topology. Give a counter-example in infinite dimensions
        \item Show strong/weak convergences can still agree, e.g.\ on $C^1(\R)$.
    \end{itemize}

\end{remark}
% Chapter 2
% I) Recalls on normed vector spaces (LA)
% II) Hahn-Banach (LA)
% III) Duality and weak topologies
% IV) Reflexivity
% V) Separability
% VI) L^p spaces
% VII) Recalls on Baire's category theorem and consequences
\end{document}
