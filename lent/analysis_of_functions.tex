\documentclass{article}

\def\npart {II}
\def\nyear {2017}
\def\nterm {Lent}
\def\nlecturer{Prof C.\ Mouhot}
\def\ncourse{Analysis of Functions}
\input{header}

% preamble
\usepackage{tikz}
\usepackage{mathrsfs}
% \newcommand{\powerset}{\raisebox{.15\baselineskip}{\Large\ensuremath{\wp}}}
\newcommand{\powerset}{\mathscr{P}}
%\setcounter{section}{-1}
% and here we go!

\begin{document}
\maketitle
\tableofcontents

% Chapter 1: Integration of functions
% Chapter 2: Vector spaces of functions
% Chapter 3: Fourier decomposition of functions
% Chapter 4: Generalised derivatives of functions (and spaces using them)

% Chapter 1:
    % I. Lebesgue measure/integration
    % II. Integrability and convergence

% I)
\section{Lebesgue theory}
\begin{ex}
    Show pointwise limit of Riemann-integrable functions is not necessarily Riemann-integrable.
\end{ex}
(Hint: Dirichlet function).

% 1)
\subsection{Recap of measure theory}
Consider a set $X$ and $\powerset(X)$ subsets of $X$.
\begin{defi}[Algebra]\hypertarget{def:algebra}
    $\mathscr{A} \subset \powerset(X)$ is an \textbf{algebra} if it is
    \begin{enumerate}[label=(\roman*)]
        \item stable under finite union
        \item stable under absolute difference
        \item $X \in \mathscr{A}$.
    \end{enumerate}
\end{defi}

\begin{defi}[$\sigma$-algebra]\hypertarget{def:sigAlg}
    $\mathscr{A} \subset \powerset(X)$ is a $\sigma$-\textbf{algebra} if it is
    \begin{enumerate}[label=(\roman*)]
        \item stable under countable union
        \item stable under absolute difference
        \item $X \in \mathscr{A}$.
    \end{enumerate}
\end{defi}

\begin{remark}
    Topologies $\mathscr{T} \subset \powerset(X)$ are (i) stable under \textit{any} union, (ii) finite intersection, (ii) include $X$ and $\emptyset$.
\end{remark}

\begin{remark}
    The property of being a \hyperlink{def:sigAlg}{$\sigma$-algebra} is stable under intersection.\hypertarget{def:borelSet}
    The notion of smaller $\sigma$-algebra containing some topology $\mathscr{T}$ are called \textbf{Borel} sets, written $\mathcal{B}(X)$.
\end{remark}

\begin{defi}\hypertarget{def:measure}
    Consider $(X, \mathscr{A})$, where $\mathscr{A}$ is a \hyperlink{def:sigAlg}{$\sigma$-algebra}.
    A \textbf{measure} $\mu$ is a function $\mathscr{A} \to [0, +\infty]$ such that $\mu(\emptyset) = 0$.
    It is \textbf{$\sigma$-additive} \hypertarget{def:sigAdd} if
    \begin{equation*}
        \mu\left( \bigcup_{n=1}^\infty A_n\right) = \mu\left( \bigsqcup_{n=1}^\infty A_n\right) = \sum_{n=1}^\infty \mu(A_n).
    \end{equation*}

    Then $X, \mathscr{A}, \mu)$ is a \textbf{measure space}.
    It is called \textbf{complete} \hypertarget{def:completeMeasure} if $A \in \mathscr{A}$ with $B \subset A$ and $\mu(A) = 0$, then $B \in \mathscr{A}$ and $\mu(B)=0$.
\end{defi}

\begin{ex}
    Show \hyperlink{def:sigAdd}{$\sigma$-additivity} is implied by either of the following properties:
    \begin{itemize}
        \item finite additivity and continuity from below
        \item finite $\mu(X) < +\infty$ and finite additivity and continuity from above at $\emptyset$
    \end{itemize}
    where
    \begin{itemize}
        \item continuity from below:
            \begin{equation*}
                A_n \in \mathscr{A}, \mu\left(\bigcup_{k=1}^\infty A_k\right)  = \lim_{n \to +\infty} \mu\left(\bigcup_{k=1}^n A_k\right)
            \end{equation*}
        \item continuity from above
            \begin{equation*}
                A_n \in \mathscr{A}, \mu(A_1) < +\infty, \mu\left(\bigcap_{k=1}^\infty A_k\right)  = \lim_{\mathclap{n \to +\infty}} \mu\left(\bigcap_{k=1}^n A_k\right)
            \end{equation*}
    \end{itemize}
\end{ex}

\begin{ex}
    Find the cardinality of $\mathscr{T}(\R)$, $\mathcal{B}(\R)$, $\mathscr{L}(\R)$ where $\mathscr{L}(\R)$ are the Lebesgue sets, defined by adding all subsets of null sets to $\mathcal{B}(\R)$.
\end{ex}

\begin{thm}
    There is a unique \hyperlink{def:measure}{measure} on $(\R^n, \mathcal{B}(\R^n))$ such that
    \begin{equation*}
        \mu\left(\prod_{i=1}^n [a_i, b_i]\right) = \prod_{i=1}^n (b_i - a_i) \quad a_i \leq b_i \in \R
    \end{equation*}
    called the Lebesgue measure\hypertarget{def:lebMeas}.
\end{thm}
\begin{proof}
    See Probability and Measure.
\end{proof}

\begin{remark}
    \hyperlink{def:lebMeas}{Lebesgue measure} is \hypertarget{def:sigFinite}{$\sigma$-finite}: $\exists$ a countable increasing sequence of sets with finite measure covering $\R^n$.
\end{remark}

\begin{defi}[Measurable function]\hypertarget{def:measFunc}
    Take $(X, \mathscr{A})$, $(Y, \mathscr{B})$ two spaces with \hyperlink{def:sigAlg}{$\sigma$-algebras}.
    A function $f: X \to Y$ is said to be \textbf{measurable} if $\forall B \in \mathscr{B}$, $f^{-1}(B) \in \mathscr{A}$.
\end{defi}

\begin{prop}
    Take $(X, \mathscr{A}), (Y, \mathscr{B})$ two spaces with \hyperlink{def:sigAlg}{$\sigma$-algebras} where $Y$ is a metric space and $\mathscr{B}$ is the collection of \hyperlink{def:borelSet}{Borel sets}.
    Let $f_k: X \to Y$ be a sequence of \hyperlink{def:measFunc}{measurable functions} which converge pointwise to $f:X \to Y$.
    Then $f$ is measurable.
\end{prop}

\begin{proof}
    Since $B$ is formed from open sets through countable union/intersection and difference, it is enough to prove $\forall U \in \mathscr{T}(Y)$, $f^{-1}(U) \in \mathscr{A}$. (Exercise: Check.)

    Let
    \begin{align*}
        U_n &= \Set{y \in Y | d(y, Y \setminus U) > \frac{1}{n}} \\
        F_n &= \Set{y \in Y | d(y, Y \setminus U) \geq \frac{1}{n}}
    \end{align*}
    so that
    \begin{equation*}
        U_n \subset F_n \subset U_{n+1} \subset \dotsb \subset U
    \end{equation*}
    and $F_n$ are closed.

    We can see $U = \bigcup_{n \geq 1} U_n = \bigcup_{n \geq 1} F_n$ ($U$ open). % why U open matters?
    Hence,
    \begin{equation*}
        f^{-1}(U) = f^{-1} \left(\bigcup_{n \geq 1} U_n\right) = \bigcup_{n \geq 1} f^{-1}(U_n) \subset \bigcup_{n \geq 1} \bigcup_{l \geq 1} \bigcap_{k \geq l} f^{-1}_k(U_n).
    \end{equation*}
    We used the fact that
    \begin{equation*}f^{-1}(U_n) \subset \bigcup_{l \geq 1} \bigcap_{k \geq l} f_k^{-1}(U_n)\end{equation*}
    To show this, take $x \in f^{-1}(U_n)$, so $f(x) = y \in U_n$.
    We know
    \begin{equation*}
        f_k(x) \xrightarrow{k \to \infty} f(x).
    \end{equation*}
    Since $U_n$ open, $\exists l_x \geq 1$ such that $\forall k \geq l_x, f_k(x) \in U_n$ giving $x \in \bigcap_{k \geq l} f_k^{-1}(U_n)$.

    Continuing,
    \begin{align*}
        f^{-1}(U) &\subset \bigcup_{n \geq 1} \bigcup_{l \geq 1} \bigcap_{k \geq l} f_k^{-1}(U_n). \\
        &\subset \bigcup_{n \geq 1} \bigcup_{l \geq 1} \bigcap_{k \geq l} f_k^{-1}(F_n).
    \end{align*}
    $F_n$ closed, so
    \begin{equation*}
        \bigcup_{l \geq 1} \bigcap_{k \geq l} f_k^{-1} (F_n) \subset f^{-1}(F_n).
    \end{equation*}
    In particular, if $x \in$ LHS, $\exists l \geq 1$ such that $\forall k \geq l$, $f_k(x) \in F_n$.
    Pass to the limit, and $f_n$ closed gives $f(x) \in F_n$, $x \in f^{-1}(F_n)$.

    In conclusion,
    \begin{align*}
        f^{-1}(U) &\subset \bigcup_{n \geq 1} \bigcup_{l \geq 1} \bigcap_{k \geq l} f_k^{-1}(U_n) \subset \bigcup_{n \geq 1} \bigcup_{l \geq 1} \bigcap_{k \geq l} f_k^{-1}(F_n) \\
                  & \subset \bigcup_{n \geq 1} f^{-1}(F_n) = f^{-1}\left(\bigcup_{n \geq 1} F_n\right) = f^{-1}(U).
    \end{align*}
    So, all inclusions are equality: $f^{-1}(U)$ is formed of countable intersections and unions of preimages of sets in $\mathscr{B}$, hence $f^{-1}(U) \in \mathscr{A}$.
\end{proof}

\subsection{Lebesgue integration}
The important result from measures is the existence of Lebesgue measure, and that the `theory' is closed for pointwise convergence.

We move now from Riemann integration to Lebesgue integration.
In Riemann's theory of integration, we approximate the integral with Darboux sums, by dividing the domain. We require the domain to have a total order, while the codomain must be a Banach space.
Conversely, in Lebesgue integration we divide the codomain (again, needing a total order) while the domain must simply be a measure space.

\begin{defi}[Simple]\hypertarget{def:simple}
    $f: (X, \mathscr{A}) \to (\R, \mathcal{B}(R))$ is \textbf{simple} if it is measurable and takes a finite number of values in $[0, +\infty)$.
\end{defi}
From here on in, when working on the real line, subsets thereof, or the extended real line the \hyperlink{def:sigAlg}{$\sigma$-algebra} will be the \hyperlink{def:borelSet}{Borel sets}.
\begin{remark}
    $A \subset X$, $\chi_A$ is \hyperlink{def:measFunc}{measurable} iff $A \in \mathscr{A}$ is simple.
    The general form of a simple function is $s = \sum \alpha_i \chi_{A_i}$.
\end{remark}
\begin{prop}
    Let $f: (X, \mathscr{A}) \to [0, +\infty]$ measurable.
    Here $[0, +\infty] = [0, +\infty) \cup \{+\infty\}$, so the neighbourhoods of $\infty$ are $(a, +\infty])$, and we can have a metric $d(x,y) = \abs{\arctan x - \arctan y}$
    There is $(s_k)$, a sequence of simple functions $s_{k+1} \geq s_k$ converging pointwise to $f$.
\end{prop}
\begin{proof}
    For $n \geq 1$, define
    \begin{align*}
        B_n &= \set{x | f(x) \geq n}  \\
        A_n^i &= \Set{x | f(x) \in \left[\frac{i-1}{2^n}, \frac{i}{2^n}\right]} \quad i=0, \dotsc, n 2^n
    \end{align*}
    Also, set

    \begin{equation*}
    s_n = \begin{cases*}\frac{i-1}{2^n} & on $A_n^i$ \\ n & on $B_n$\end{cases*}
    \end{equation*}
    Check
    \begin{itemize}
        \item $s_{n+1} \geq s_n$ $[A_n^i = A_{n+1}^{2i} \cup A_{n+1}^{2i+1}]$
        \item on $B_n$, $\abs{s_n - f} \leq \frac{1}{2^n}$
        \item on $x \in \bigcap_{k \geq 1} B_n$, $s_n(x) \to +\infty$.
    \end{itemize}
\end{proof}

\begin{defi}
    Take  $(X, \mathscr{A}, \mu)$ and $s$ a simple function on it given by $s=\sum_{i=1}^n \alpha_i \chi_{A_i}$, $\alpha_i \in [0, \infty)$.
    For $E \in \mathscr{A}$, define
    \begin{equation*}
        \int_E s \, d\mu = \sum_{i=1}^n \alpha_i \mu(A_i \cap E).
    \end{equation*}
\end{defi}
\begin{remark}
    This induces a new measure on $\mathscr{A}$, with $E \mapsto \int_E s \, d\mu$.
\end{remark}

\begin{defi}
    Take $f:(X, \mathscr{A}, \mu) \to [0, \infty]$ measurable and $E \in \mathscr{A}$.
    Then define
    \begin{equation*}
        \int_E f \, d \mu \coloneqq \sup\Set{\int_E s \, d\mu | s \leq f} \in [0, +\infty]
    \end{equation*}
\end{defi}
\begin{remark}
    This integral always makes sense. Also, $\int_E f \, d\mu = 0$ if $\mu(E) = 0$
\end{remark}
\begin{ex}
    Check linearity of the integral. Show Chebyshev's inequality:
    \begin{equation*}
        \mu(\set{x | f(x) \geq \alpha}) \leq \alpha^{-1} \int_X f \, d\mu
    \end{equation*}
    for $\alpha>0$.
    If $f$ is measurable, $X \to [0, +\infty]$ satisfies $\int_X f \, d\mu < +\infty$, then $\mu(\set{x | f(x) = +\infty})$
\end{ex}

\begin{thm}[Beppo-Levi monotone convergence]\hypertarget{thm:Beppo}
    Take $f_k: (X, \mathscr{A}, \mu) \to [0, +\infty]$ measurable, converging pointwise to $f$ with $f_k \leq f_{k+1}$.
    Then $\forall E \in \mathscr{A}$, $\int_E f_k \, d\mu \xrightarrow{k \to +\infty} \int_E f \, d\mu$.
\end{thm}
\begin{proof}
    Reduce to $E = X$ by consdering $f_k \chi_E, f \chi_E, \dotsc$.
    Then $\left(\int_X f_k \, d\mu\right)_{k \geq 1}$ is a sequence in $[0, +\infty]$, non-decreasing.

    By monotonicity, $f_k \nearrow f$, so $\int_X f_k \, d\mu \leq \int_X f \, d\mu$.
    Let
    \begin{equation*}
        \alpha \coloneqq \lim_{k \to +\infty} \int_X f_k \, d\mu \leq \int_X f \, d\mu.
    \end{equation*}
    Consider a simple function $s \leq f$ and $c \in (0, 1)$.
    \begin{gather*}
        E_k = \set{x\in X | f_k(x) \geq c s(x)} \in \mathscr{A} \text{ (using that $f_k$, $s$ are measurable)}\\
        E_k \subset E_{k+1}, \bigcup_{k \geq 1} E_k = X \text{ (by pointwise convergence)}
    \end{gather*}
    Thus $\int_X s \, d\mu = \lim_{k \to +\infty} \int_{E_k} s \, d\mu$ (by continuity from below of $\mu$).
    \begin{equation*}
        \int_X f_k \, d\mu \geq \int_{E_k} f_k \, d \mu \geq c \int_{E_k} s \, d \mu
    \end{equation*}
    Take $k \to +\infty$. $\alpha \geq c \int_X s \, \mu$, and let $c \nearrow 1$, giving $\int_X s \, d\mu$.
    Taking the supremum over $s \leq f$ for $s$ simple,
    \begin{equation*}
        \alpha \geq \int_X f `, d\mu.\qedhere
    \end{equation*}
\end{proof}

\begin{ex}
    Taking $f_k$ as above, show
    \begin{equation*}
        \int_X \left(\sum_{k \geq 1} f_k\right) \, d\mu = \sum_{k \geq 1} \int_X f_k \, d\mu
    \end{equation*}
    Let $\nu: A \in \mathscr{A} \mapsto \int_A f \, d\mu$ (for $f$ a measure $X \to [0, +\infty]$).
    Show that for any measure $g: (X, \mathscr{A}, \mu) \to [0, +\infty]$, $\int_X g \, d\mu = \int_X fg \, d\mu$.
\end{ex}
\begin{thm}[Fatou's lemma]
    Take $f_k$ as above, then
    \begin{equation*}
        \int_X (\liminf f_k) \, d\mu \leq \liminf \left(\int_X f_k \, d\mu\right)
    \end{equation*}
\end{thm}

\begin{proof}
    Let $F_k = \inf\set{f_l | l \geq k}$, non-decreasing, valued in $[0, +\infty]$.
    These are measurable: $\{F_k \geq a\} = \bigcap_{l \geq k} \{f_l \geq a\}$.
    Observe that $\int \min(f, g) \, d\mu \leq \min(\int f \, d\mu, \int g \, d\mu)$.
    Now, by \hyperlink{thm:Beppo-Levi},
    \begin{align*}
        \int_X (\liminf f_k) \, d\mu &= \int_X (\lim F_k) \, d\mu = \lim_{k \to +\infty} \left(\int_X F_k \, d\mu\right) \\
                                     &= \lim_{k \to \infty} \left(\int_X \left( \inf_{l \geq k} f_l\right) \, d\mu\right) \\
                                     &\leq \lim_{k \to \infty} \inf_{l \geq k} \left(\int_X f_l \, d\mu\right)\\
                                     &\leq \liminf_{k \to \infty} \int f_k \, d\mu.\qedhere
    \end{align*}
\end{proof}
\begin{defi}[Integrable]
    $f: (X, \mathscr{A}, \mu) \to \C$ measurable is integrable if $\abs{f}: X \to [0, +\infty)$ satisfies $\int_X \abs{f} \, d\mu < +\infty$.
\end{defi}
Compute by splitting $f$ into real and imaginary parts, and each into nonnegative and nonpositive parts.

\begin{thm}[Lebesgue's Dominated Convergence]
    Take $f_k: (X, \mathscr{A}, \mu) \to \C$ where
    \begin{itemize}
        \item convergence: $f_k$ converges pointwise to $f$
        \item domination: $\exists g$ integrable
    \end{itemize}
\end{thm}

\begin{proof}
    Let $h_k = 2g - \abs{f - f_k}$, taking values in $[0, +\infty]$.
    Then $h_k \to 2g$ pointwise.
    \begin{gather*}
        \int_X 2g \, \mu = \int_X (\lim h_k) \, d\mu \leq \liminf_{k \to \infty} \left(\int_X h_k \, d\mu\right).
        \text{Recall }\int_X h_k \, d\mu = \int_X 2g \, d\mu - \int_X \abs{f_k-f} \, d\mu
        \int_X 2g \, d\mu \leq \int_X 2g \, d\mu - \limsup_{k \to \infty} \int \abs{f_k - f} \, d\mu.
    \end{gather*}
\end{proof}

% lecture 3
% III)
\subsection{Lebesgue spaces}
\begin{defi}
    Let $p \in [1, +\infty]$, and $(X, \mathscr{A}, \mu)$ a measure space.
    $L^p(X)$ is the set of equivalence classes for almost everywhere equality of functions $f: X \to  \R$ (or $\C$) such that $\abs{f}^p$ is integrable (for $p \in [1, +\infty)$, or $f$ essentially bounded i.e. bounded outside null sets for $p=\infty$).
\end{defi}

\begin{thm}[Riesz-Fischer]
    $(L^p(X), \norm{\cdot}_{L^p})$ is a Banach space for $p \in [1, +\infty]$, where
    \begin{equation*}
        \norm{f}_{L^p} \coloneqq \left(\int_X \abs{f}^p\right)^{\frac{1}{p}} \quad \norm{f}_{L^\infty} \coloneqq \inf\set{M \geq 0 | \mu\{\abs{f(x)} \geq M\} = 0}
    \end{equation*}
\end{thm}
\begin{ex}
    Take $\mu(X) < +\infty$, so $f$ supported on a finite measure space. For $f \in L^\infty(X)$,then $f \in L^p(X)$ for any $p \in [1, +\infty)$ and
    \begin{equation*}
        \lim_{p \to +\infty} \norm{f}_{L^p(X)} = \norm{f}_{L^\infty(X)}
    \end{equation*}
\end{ex}

\begin{proof}
    Vector space axioms and triangular inequality (here called Minkowski) left as an exercise - see Linear Analysis.
    Instead, we focus on completeness. Start with $p \in [1, +\infty)$.

    Initially, prove this auxiliary result.
    \textbf{Claim}: Take $p \in [1, +\infty)$, consider a sequence $(g_k)$ in $L^p(X)$ such that $\sum_{k \geq 1} \norm{g_k}_{L^p(X)} = M < +\infty$, then there exists $G \in L^p(X)$ such that $\sum_{k=1}^n g_k$ converges to $G$ in $L^p(X)$ and almost everywhere.
    \textbf{Proof of the claim}:
    \begin{equation*}
        h_n \coloneqq \sum_{k=1}^n \abs{g_k}, \quad h \coloneqq \sum_{k=1}^\infty \abs{g_k} \in [0, +\infty]
    \end{equation*}
    $(h_n)$ is non-decreasing sequence since $h_n \leq h_{n+1}$, and $h_n \to h$ pointwise.
    Hence, \hyperlink{thm:Beppo}{Beppo-Levi} gives that
    \begin{equation*}
        \int_X h_n^p \, d\mu \to \int_X h^p  \, d\mu \in [0, +\infty]
    \end{equation*}
    By the assumtion on $(g_k)$
    \begin{align*}
        &\implies \norm{h_n}_{L^p(X)} \leq \sum_{k=1}^n \norm{g_k}_{L^p(X)} \leq M < +\infty
        &\implies \norm{h}_{L^p(X)} \text{ is finite and less than } M
    \end{align*}
    Hence $h$ finite almost everywhere, and $\sum g_k$ is absolutely convergent almost everywhere, so convergent almost everywhere.

    Let us call $G = \lim_{k \to \infty} \sum_{k=1}^n g_k$ (almost everywhere).
    \begin{equation*}
        \abs{G(x)} \leq \abs{\sum_{k=1}^n g_k} \leq \sum_{k=1}^\infty \abs{g_k} = h(x)
    \end{equation*}
    so $G \in L^p(X)$.

    Using the Dominated Convergence Theorem,
    \begin{equation*}
        \int_X \abs{G(x) - \sum_{k=1}^n g_k}^p \, d\mu \to 0
    \end{equation*}
    since the integrand converges pointwise to 0, and the domination is given by $\abs{G(x) - \sum_{k=1}^n g_k}^p \leq 2^p h(x)^p$, where $h^p$ integrable since $G \in L^p(X)$ and $\sum_{k=1}^m g_k \to G$ in $L^p(X)$ and almost everywhere.
    This proves the claim, so we go back to the main proof.

    Let $(f_k)$ be a Cauchy sequence in $L^p(X)$.
    Build a subsequence $(f_{\phi(k)})$ such that $g_k \coloneqq f_{\phi(k+1)} - f_{\phi(k)}$ satisfies $\norm{g_k}_{L^p(X)} \leq \frac{1}{2^k}$, so $g_k$ satisfies the assumptions of the claim.
    Hence, $\exists G \in L^p(X)$ such that $\sum_{k=1}^n g_k \to G$ almost everywhere and in $L^p(X)$. But $g_k = f_{\phi(n+1)} - f_{\phi(n)}$.
    So,
    \begin{equation*}
        f_{\phi(n)} \longrightarrow f_{\phi(1)} + G \eqqcolon F \text{ in } L^p(X) \text{ and almost everywhere}
    \end{equation*}
    But $(f_n)$ Cauchy in $L^p(X)$, so $f_n \to F$ in $L^p(X)$.
\end{proof}

\begin{remark}
    Take $(f_n)$ convergent in $L^p(X)$, $f_n \to F$ in $L^p(X)$. Then (we proved) $\exists$ subsequence $f_{\phi(n)} \to F$ converging almost everywhere.
\end{remark}
\begin{ex}
    \leavevmode
    \begin{enumerate}[label=\arabic*)]
        \item Find a sequence $(f_n)$ converging in $L^p(\R)$ and not converging almost everywhere to its $L^p$ limit (for $p \in [1, \infty)$). This shows passing to a subsequence was necessary, and not a defect of the argument.
        \item Complete the proof of Riesz-Fischer theorem in the $p=+\infty$ case.
    \end{enumerate}
\end{ex}

\begin{thm}[Abstract density result]
    Take a measure space $(X, \mathscr{A}, \mu)$ and $p \in [1, +\infty]$. Then simple functions that belong to $L^p(X)$ are dense in $L^p(X)$.
\end{thm}
\begin{proof}
    For $f$ real or complex, split into real/imaginary parts and positive/negative parts to reduce to approximating $f \geq 0$ by simple functions.
    Define
    \begin{equation*}
        S_n =
        \begin{cases}
            n & \text{on } B_n = \set{f \geq n} \\
            \frac{i-1}{2^n} & \text{on } A_n^i = \{f \in [\frac{i-1}{2^n}, \frac{i}{2^n})\}, 1 \leq i \leq n 2^n
        \end{cases}
    \end{equation*}
    as our usual approximation.
    In the case $p=\infty$, $\norm{f}_{L^\infty(X)} < \infty$, then for $n > \norm{f}_{L^\infty(X)}$, $\abs{S_n-f} \leq \frac{1}{2^n}$ almost everywhere. Then $\norm{S_n-f}_{L^\infty(X)} \leq \frac{1}{2^n} \to 0$.
    In the case $p \in [1, \infty)$, $0 \leq S_n \leq f$ and $S_{n+1} \geq S_n$, with $S_n \to f$ pointwise. By the \hyperlink{thm:Beppo}{Beppo-Levi theorem}, $\norm{S_n - f}_{L^p(X)} \to 0$.
\end{proof}

\begin{thm}[Density-separability of $L^p(\R^n)$, $p \in [1, +\infty)$]
    \leavevmode
    \begin{enumerate}[label=(\arabic*)]
        \item For $O$ an open set in $\R^n$, $L^p(O)$ is separable (has a countable dense subset).
        \item Smooth functions compactly supported in $O$ are dense in $L^p(O)$.
    \end{enumerate}
\end{thm}

We need and admit a theorem from Probability and Measure (this statement is non-examinable).
\begin{thm}[Regularity of the Lebesgue measure]
    A regular measure on a topological space $X$ with $\sigma$-algebra $\mathscr{A}$ of measurable sets is a measure such that every measurable set can be approximated from above by open measurable sets and from below by compact measurable sets.
    The Lebesgue measure on $\R^n$ is regular for the Lebesgue sets.
\end{thm}
Observe this implies that any Lebesgue set of finite measure in $\R^n$ is squeezed between two Borel sets with the same measure.
\begin{proof}
    \leavevmode
    \begin{enumerate}[label=(\arabic*)]
        \item Let $\mathcal{C} = \{\text{open sets which are hypercubes} \prod_{i=1}^n (a_i, b_i), a_i, b_i \in \Q\}$, a countable set.
            Claim: Any open set $O \subset \R^n$ can be covered with a countable union of elements of $\mathcal{C}$ with disjoint interiors.
            Use an inductive procedure: Split into $\Z^n$. Keep cubes fully inside, discard the rest. For borderline cubes, divide into $2^n$ cubes evenly and start 1 again.
            Check that $O = \bigcup_{n, k} C_{n, k}$, and note that the hypercubes have dyadic, hence rational, coordinates.
            \begin{center}
                \begin{tikzpicture}
                    \draw [->] (-0.8, 0) -- (7.9, 0);
                    \draw [->] (0, -0.8) -- (0, 4.9);
                    \draw[step=1,gray,very thin] (-0.7,-0.7) grid (7.7,4.7);
                    \draw (2, 2) circle (1pt);
                    \draw (4.1, 1.4) circle (1pt);
                    \draw (  6, 3.3) circle (1pt);
                    \draw (6.4, 4.2) circle (1pt);
                    \draw (2.6, 3.7) circle (1pt);
                    \draw [bblue] plot [smooth cycle] coordinates {(2,2) (4.1,1.4) (6,3.3) (6.4,4.2) (2.6,3.7)};
                \end{tikzpicture}
            \end{center}
    \end{enumerate}
\end{proof}
\end{document}
