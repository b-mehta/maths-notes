\documentclass[twoside]{article}

\def\npart {II}
\def\nyear {2017}
\def\nterm {Lent}
\def\nlecturer{Prof C.\ Mouhot}
\def\ncourse{Analysis of Functions}
% \def\draft{Rough}
\input{header}

% preamble
\usepackage{tikz}
\usepackage{mathrsfs}
\usepackage{bm}
\newcommand{\powerset}{\mathscr{P}}
\newcommand{\weakconv}{\overset{w}{\rightharpoonup}}
\usetikzlibrary{backgrounds}
\DeclarePairedDelimiter{\ceil}{\lceil}{\rceil}
\DeclarePairedDelimiter{\floor}{\lfloor}{\rfloor}
\DeclareMathOperator{\spn}{span}
%\setcounter{section}{-1}
% and here we go!

\begin{document}
% \iffalse
\maketitle
\tableofcontents

% Chapter 1: Integration of functions
% Chapter 2: Vector spaces of functions
% Chapter 3: Fourier decomposition of functions
% Chapter 4: Generalised derivatives of functions (and spaces using them)

% Chapter 1:
    % I. Lebesgue measure/integration
    % II. Integrability and convergence

% I)
\clearpage
\section{Lebesgue theory}
\begin{ex}
    Show pointwise limit of Riemann-integrable functions is not necessarily Riemann-integrable.
    (Hint: Dirichlet function).
\end{ex}

% 1)
\subsection{Recap of measure theory}
Consider a set $X$ and $\powerset(X)$ subsets of $X$.
\begin{defi}[Algebra]\hypertarget{def:algebra}
    $\mathscr{A} \subset \powerset(X)$ is an \textbf{algebra} if it is
    \begin{enumerate}[label=(\roman*)]
        \item stable under finite union
        \item stable under complementation
        \item $X \in \mathscr{A}$.
    \end{enumerate}
\end{defi}

\begin{defi}[$\sigma$-algebra]\hypertarget{def:sigAlg}
    $\mathscr{A} \subset \powerset(X)$ is a $\sigma$-\textbf{algebra} if it is
    \begin{enumerate}[label=(\roman*)]
        \item stable under countable union
        \item stable under complementation
        \item $X \in \mathscr{A}$.
    \end{enumerate}
\end{defi}

\begin{remark}
    Topologies $\mathscr{T} \subset \powerset(X)$ are (i) stable under \textit{any} union, (ii) finite intersection, (iii) include $X$ and $\emptyset$.
\end{remark}

\begin{remark}
    The property of being a \hyperlink{def:sigAlg}{$\sigma$-algebra} is stable under intersection.
    The smallest $\sigma$-algebra containing some topology $\mathscr{T}$ has elements called \hypertarget{def:borelSet}{\textbf{Borel} sets}, written $\mathcal{B}(X)$.
\end{remark}

\begin{defi}\hypertarget{def:measure}
    Consider $(X, \mathscr{A})$, where $\mathscr{A}$ is a \hyperlink{def:sigAlg}{$\sigma$-algebra}.
    A \textbf{measure} $\mu$ is a function $\mathscr{A} \to [0, \infty]$ such that $\mu(\emptyset) = 0$.
    It is \textbf{$\sigma$-additive} \hypertarget{def:sigAdd} if
    \begin{equation*}
        \mu\left( \bigcup_{n=1}^\infty A_n\right) = \mu\left( \bigsqcup_{n=1}^\infty A_n\right) = \sum_{n=1}^\infty \mu(A_n).
    \end{equation*}

    Then $(X, \mathscr{A}, \mu)$ is a \textbf{measure space}.
    It is called \textbf{complete} \hypertarget{def:completeMeasure} if $A \in \mathscr{A}$ with $B \subset A$ and $\mu(A) = 0$, then $B \in \mathscr{A}$ and $\mu(B)=0$.
\end{defi}

\begin{ex}
    Show \hyperlink{def:sigAdd}{$\sigma$-additivity} is implied by either of the following properties:
    \begin{itemize}
        \item finite additivity and continuity from below
        \item finite $\mu(X) < \infty$ and finite additivity and continuity from above at $\emptyset$
    \end{itemize}
    where
    \begin{itemize}
        \item continuity from below:
            \begin{equation*}
                A_n \in \mathscr{A}, \mu\left(\bigcup_{k=1}^\infty A_k\right)  = \lim_{n \to \infty} \mu\left(\bigcup_{k=1}^n A_k\right)
            \end{equation*}
        \item continuity from above
            \begin{equation*}
                A_n \in \mathscr{A}, \mu(A_1) < \infty, \mu\left(\bigcap_{k=1}^\infty A_k\right)  = \lim_{\mathclap{n \to \infty}} \mu\left(\bigcap_{k=1}^n A_k\right)
            \end{equation*}
    \end{itemize}
\end{ex}

\begin{ex}
    Find the cardinality of $\mathscr{T}(\R)$, $\mathcal{B}(\R)$, $\mathscr{L}(\R)$ where $\mathscr{L}(\R)$ are the Lebesgue sets, defined by adding all subsets of null sets to $\mathcal{B}(\R)$.
\end{ex}

\begin{thm}
    There is a unique \hyperlink{def:measure}{measure} on $(\R^n, \mathcal{B}(\R^n))$ such that
    \begin{equation*}
        \mu\left(\prod_{i=1}^n [a_i, b_i]\right) = \prod_{i=1}^n (b_i - a_i) \quad a_i \leq b_i \in \R
    \end{equation*}
    called the Lebesgue measure\hypertarget{def:lebMeas}.
\end{thm}
\begin{proof}
    See Probability and Measure.
\end{proof}

\begin{remark}
    \hyperlink{def:lebMeas}{Lebesgue measure} is \hypertarget{def:sigFinite}{$\sigma$-finite}: $\exists$ a countable increasing sequence of sets with finite measure covering $\R^n$.
\end{remark}

\begin{defi}[Measurable function]\hypertarget{def:measFunc}
    Take $(X, \mathscr{A})$, $(Y, \mathscr{B})$ two spaces with \hyperlink{def:sigAlg}{$\sigma$-algebras}.
    A function $f: X \to Y$ is said to be \textbf{measurable} if $\forall B \in \mathscr{B}$, $f^{-1}(B) \in \mathscr{A}$.
\end{defi}

\begin{prop}
    Take $(X, \mathscr{A}), (Y, \mathscr{B})$ two spaces with \hyperlink{def:sigAlg}{$\sigma$-algebras} where $Y$ is a metric space and $\mathscr{B}$ is the collection of \hyperlink{def:borelSet}{Borel sets}.
    Let $f_k: X \to Y$ be a sequence of \hyperlink{def:measFunc}{measurable functions} which converge pointwise to $f:X \to Y$.
    Then $f$ is measurable.
\end{prop}

\begin{proof}
    Since $\mathscr{B}$ is formed from open sets through countable union/intersection and difference, it is enough to prove that $\forall U \in \mathscr{T}(Y)$, $f^{-1}(U) \in \mathscr{A}$. (Exercise: Check.)

    Let
    \begin{align*}
        U_n &= \Set{y \in Y | d(y, Y \setminus U) > \frac{1}{n}} \\
        F_n &= \Set{y \in Y | d(y, Y \setminus U) \geq \frac{1}{n}}
    \end{align*}
    so that
    \begin{equation*}
        U_n \subset F_n \subset U_{n+1} \subset \dotsb \subset U
    \end{equation*}
    and $F_n$ are closed.

    We can see $U = \bigcup_{n \geq 1} U_n = \bigcup_{n \geq 1} F_n$ because $U$ is open. % why U open matters? so that all points are indeed included
    Hence,
    \begin{equation*}
        f^{-1}(U) = f^{-1} \left(\bigcup_{n \geq 1} U_n\right) = \bigcup_{n \geq 1} f^{-1}(U_n) \subset \bigcup_{n \geq 1} \bigcup_{l \geq 1} \bigcap_{k \geq l} f^{-1}_k(U_n).
    \end{equation*}
    We used the fact that
    \begin{equation*}f^{-1}(U_n) \subset \bigcup_{l \geq 1} \bigcap_{k \geq l} f_k^{-1}(U_n)\end{equation*}
    To show this, take $x \in f^{-1}(U_n)$, so $f(x) = y \in U_n$.
    We know
    \begin{equation*}
        f_k(x) \xrightarrow{k \to \infty} f(x).
    \end{equation*}
    Since $U_n$ open, $\exists l_x \geq 1$ such that $\forall k \geq l_x, f_k(x) \in U_n$ giving $x \in \bigcap_{k \geq l} f_k^{-1}(U_n)$.

    Continuing,
    \begin{align*}
        f^{-1}(U) &\subset \bigcup_{n \geq 1} \bigcup_{l \geq 1} \bigcap_{k \geq l} f_k^{-1}(U_n). \\
        &\subset \bigcup_{n \geq 1} \bigcup_{l \geq 1} \bigcap_{k \geq l} f_k^{-1}(F_n).
    \end{align*}
    $F_n$ closed, so
    \begin{equation*}
        \bigcup_{l \geq 1} \bigcap_{k \geq l} f_k^{-1} (F_n) \subset f^{-1}(F_n).
    \end{equation*}
    In particular, if $x \in$ LHS, $\exists l \geq 1$ such that $\forall k \geq l$, $f_k(x) \in F_n$.
    Pass to the limit, and $f_n$ closed gives $f(x) \in F_n$, $x \in f^{-1}(F_n)$.

    In conclusion,
    \begin{align*}
        f^{-1}(U) &\subset \bigcup_{n \geq 1} \bigcup_{l \geq 1} \bigcap_{k \geq l} f_k^{-1}(U_n) \subset \bigcup_{n \geq 1} \bigcup_{l \geq 1} \bigcap_{k \geq l} f_k^{-1}(F_n) \\
                  & \subset \bigcup_{n \geq 1} f^{-1}(F_n) = f^{-1}\left(\bigcup_{n \geq 1} F_n\right) = f^{-1}(U).
    \end{align*}
    So, all inclusions are equality: $f^{-1}(U)$ is formed of countable intersections and unions of preimages of sets in $\mathscr{B}$, hence $f^{-1}(U) \in \mathscr{A}$.
\end{proof}

\clearpage
\subsection{Lebesgue integration}
The important result from measures is the existence of Lebesgue measure, and that the `theory' is closed for pointwise convergence.

We move now from Riemann integration to Lebesgue integration.
In Riemann's theory of integration, we approximate the integral with Darboux sums, by dividing the domain. We require the domain to have a total order, while the codomain must be a Banach space.
Conversely, in Lebesgue integration we divide the codomain (needing a total order) while the domain must have a \hyperlink{def:measure}{measure} defined on it.
\begin{defi}[Simple]\hypertarget{def:simple}
    $f: (X, \mathscr{A}) \to (\R, \mathcal{B}(R))$ is \textbf{simple} if it is \hyperlink{def:measure}{measurable} and takes a finite number of values in $[0, \infty)$.
\end{defi}
From here on in, when working on the real line, subsets thereof, or the extended real line the \hyperlink{def:sigAlg}{$\sigma$-algebra} will be the \hyperlink{def:borelSet}{Borel sets}.
\begin{remark}
    $A \subset X$, $\chi_A$ is \hyperlink{def:simple}{simple} iff $A \in \mathscr{A}$ is \hyperlink{def:measFunc}{measurable}.
    The general form of a simple function is $s = \sum \alpha_i \chi_{A_i}$.
\end{remark}
\begin{notation}
    $[0, \infty] = [0, \infty) \cup \{\infty\}$, so the neighbourhoods of $\infty$ are $(a, \infty]$, which we can metrise with $d(x,y) = \abs{\arctan x - \arctan y}$.
\end{notation}
\begin{prop}
    Let $f: (X, \mathscr{A}) \to [0, \infty]$ \hyperlink{def:measFunc}{measurable}.
    Then there exists $(s_k)$, an increasing sequence of \hyperlink{def:simple}{simple} functions $s_{k+1} \geq s_k$ converging pointwise to $f$.
\end{prop}
\begin{proof}
    For $n \geq 1$, define
    \begin{align*}
        B_n &= \set{x | f(x) \geq n}  \\
        A_n^i &= \Set{x | f(x) \in \left[\frac{i-1}{2^n}, \frac{i}{2^n}\right]} \quad i=0, \dotsc, n 2^n
    \end{align*}
    Also, set
    \begin{equation*}
    s_n = \begin{cases*}\frac{i-1}{2^n} & on $A_n^i$ \\ n & on $B_n$\end{cases*}
    \end{equation*}
    Check
    \begin{itemize}
        \item $s_{n+1} \geq s_n$ $[A_n^i = A_{n+1}^{2i} \cup A_{n+1}^{2i+1}]$
        \item on $B_n^c$, $\abs{s_n - f} \leq \frac{1}{2^n}$
        \item on $x \in \bigcap_{k \geq 1} B_n$, $s_n(x) \to \infty$.\qedhere
    \end{itemize}
\end{proof}
Observe this construction is simply
\begin{equation*}
    s_n = \max\left(n, 2^{-n} \floor*{2^{n} f(x)}\right)
\end{equation*}
as used in Probability and Measure.

\begin{defi}[Integral of simple function]
    Take  $(X, \mathscr{A}, \mu)$ and $s$ a \hyperlink{def:simple}{simple} function on it given by $s=\sum_{i=1}^n \alpha_i \chi_{A_i}$, $\alpha_i \in [0, \infty)$.
    For $E \in \mathscr{A}$, define
    \begin{equation*}
        \int_E s \, d\mu = \sum_{i=1}^n \alpha_i \mu(A_i \cap E).
    \end{equation*}
\end{defi}
\begin{remark}
    This induces a new \hyperlink{def:measure}{measure} on $\mathscr{A}$, sending $E \mapsto \int_E s \, d\mu$.
\end{remark}

\begin{defi}[Integral of non-negative function]\hypertarget{def:integral}
    Take $f:(X, \mathscr{A}, \mu) \to [0, \infty]$ \hyperlink{measFunc}{measurable} and $E \in \mathscr{A}$.
    Then define
    \begin{equation*}
        \int_E f \, d \mu \coloneqq \sup\Set{\int_E s \, d\mu | s \text{ \hyperlink{def:simple}{simple}}, \ s \leq f} \in [0, \infty]
    \end{equation*}
\end{defi}
\begin{remark}
    This \hyperlink{def:integral}{integral} always makes sense. Also, $\int_E f \, d\mu = 0$ if $\mu(E) = 0$.
\end{remark}
\begin{ex}
    Check linearity of the \hyperlink{def:integral}{integral}. Show \hypertarget{def:chebyshev}{Chebyshev's inequality:}
    \begin{equation*}
        \mu(\set{x | f(x) \geq \alpha}) \leq \alpha^{-1} \int_X f \, d\mu \quad \forall \alpha > 0.
    \end{equation*}
    Also show that for $f$ \hyperlink{def:measFunc}{measurable}, $X \to [0, \infty]$,
    \begin{equation*}\int_X f \, d\mu < \infty \implies \mu(\set{x | f(x) = \infty}) = 0.\end{equation*}
\end{ex}

\begin{thm}[Beppo-Levi monotone convergence]\hypertarget{thm:Beppo}
    Take $f_k: (X, \mathscr{A}, \mu) \to [0, \infty]$ \hyperlink{def:measFunc}{measurable}, converging pointwise to $f$ with $f_k \leq f_{k+1}$.
    Then $\forall E \in \mathscr{A}$,
    \begin{equation*}\int_E f_k \, d\mu \xrightarrow{k \to \infty} \int_E f \, d\mu.\end{equation*}
\end{thm}
\begin{proof}
    Reduce to $E = X$ by considering $f_k \chi_E, f \chi_E$.
    Then $\left(\int_X f_k \, d\mu\right)_{k \geq 1}$ is a sequence in $[0, \infty]$, non-decreasing.

    By monotonicity, $f_k \nearrow f$, so $\int_X f_k \, d\mu \leq \int_X f \, d\mu$.
    Let
    \begin{equation*}
        \alpha \coloneqq \lim_{k \to \infty} \int_X f_k \, d\mu \leq \int_X f \, d\mu.
    \end{equation*}
    Consider a \hyperlink{def:simple}{simple} function $s \leq f$ and $c \in (0, 1)$.
    \begin{gather*}
        E_k = \Set{x\in X | f_k(x) \geq c s(x)} \in \mathscr{A} \text{ (using that $f_k, s$ are measurable)}\\
        E_k \subset E_{k+1}, \bigcup_{k \geq 1} E_k = X \text{ (by pointwise convergence)}
    \end{gather*}
    Thus $\int_X s \, d\mu = \lim_{k \to \infty} \int_{E_k} s \, d\mu$ (by continuity from below of $\mu$).
    \begin{align*}
        \int_X f_k \, d\mu \geq \int_{E_k} f_k \, d \mu &\geq c \int_{E_k} s \, d \mu \\
        \alpha &\geq c \int_X s \, d \mu \quad \text{by taking } k \to \infty \\
        \alpha &\geq \int_X s \, d \mu \quad \text{by letting } c \nearrow 1.
    \end{align*}
    Taking the supremum over $s \leq f$ for $s$ simple,
    \begin{equation*}
        \alpha \geq \int_X f \, d\mu.\qedhere
    \end{equation*}
\end{proof}

\begin{ex}
    Taking $f_k$ as above, show
    \begin{equation*}
        \int_X \left(\sum_{k \geq 1} f_k\right) \, d\mu = \sum_{k \geq 1} \int_X f_k \, d\mu.
    \end{equation*}
    Let $\nu: A \in \mathscr{A} \mapsto \int_A f \, d\mu$ (for $f: X \to [0, \infty]$ \hyperlink{def:measFunc}{measurable}).
    Show that for any \hyperlink{def:measure}{measure} $g: (X, \mathscr{A}, \mu) \to [0, \infty]$, $\int_X g \, d\nu = \int_X fg \, d\mu$.
\end{ex}
\begin{thm}[Fatou's lemma]\hypertarget{thm:fatou}
    Take $f_k$ as above, then
    \begin{equation*}
        \int_X \left(\liminf_{k \to \infty} f_k\right) \, d\mu \leq \liminf_{k \to \infty} \left(\int_X f_k \, d\mu\right)
    \end{equation*}
\end{thm}

\begin{proof}
    Let $F_k = \inf\set{f_l | l \geq k}$, non-decreasing, valued in $[0, \infty]$.
    These are measurable: $\{F_k \geq a\} = \bigcap_{l \geq k} \{f_l \geq a\}$.
    Observe that $\int \min(f, g) \, d\mu \leq \min(\int f \, d\mu, \int g \, d\mu)$.
    Now, by \hyperlink{thm:Beppo}{monotone convergence},
    \begin{align*}
        \int_X (\liminf f_k) \, d\mu &= \int_X (\lim F_k) \, d\mu = \lim_{k \to \infty} \int_X F_k \, d\mu \\
                                     &= \lim_{k \to \infty} \left(\int_X  \inf_{l \geq k} f_l \, d\mu\right) \\
                                     &\leq \lim_{k \to \infty} \inf_{l \geq k} \left(\int_X f_l \, d\mu\right)\\
                                     &= \liminf_{k \to \infty} \int_X f_k \, d\mu.\qedhere
    \end{align*}
\end{proof}
\begin{defi}[Integrable]
    $f: (X, \mathscr{A}, \mu) \to \C$ measurable is integrable if $\abs{f}: X \to [0, \infty)$ satisfies $\int_X \abs{f} \, d\mu < \infty$.
\end{defi}
Compute by splitting $f$ into real and imaginary parts, and each into nonnegative and nonpositive parts.

\begin{thm}[Lebesgue's Dominated Convergence]
    Take $f_k: (X, \mathscr{A}, \mu) \to \C$ where
    \begin{itemize}
        \item convergence: $f_k$ converges pointwise to $f$
        \item domination: $\exists g$ integrable such that $\abs{f_k} \leq g$ $\forall k \geq 1$.
    \end{itemize}
    Then $f_k, f$ integrable and $\int_X \abs{f_k - f} d \mu \to 0$.
\end{thm}

\begin{proof}
    Let $h_k = 2g - \abs{f - f_k}$, taking values in $[0, \infty)$.
    Then $h_k \to 2g$ pointwise.
    \begin{gather*}
        \begin{aligned}
        \int_X 2g \, d\mu &= \int_X \lim h_k \, d\mu \\
                          &\hyperlink{thm:fatou}{\leq} \liminf_{k \to \infty}  \left(\int_X h_k \, d\mu\right) \\
                          &= \liminf_{k \to \infty} \left(\int_X 2g - \abs{f_k - f}\, d\mu \right) \\
                          &= \int_X 2g \, d\mu - \limsup_{k \to \infty} \int_X \abs{f_k - f} \, d\mu
        \end{aligned} \\
        \implies \limsup_{k \to \infty} \int_X \abs{f_k - f} \, d\mu =0 \qedhere.
    \end{gather*}
\end{proof}

% lecture 3
% III)
\clearpage
\subsection{Lebesgue spaces}
\begin{defi}[$L^p$ space]\hypertarget{def:lpspace}
    Let $p \in [1, \infty]$, and $(X, \mathscr{A}, \mu)$ a measure space.
    $\bm{L^p(X)}$ is the set of equivalence classes for almost everywhere equality of functions $f: X \to  \R$ (or $\C$) such that $\abs{f}^p$ is integrable (for $p \in [1, \infty)$), and for $p = \infty$ that $f$ essentially bounded i.e. bounded outside null sets.
\end{defi}

\begin{thm}[Riesz-Fischer]\hypertarget{thm:rieszFischer}
    $(\hyperlink{def:lpspace}{L^p(X)}, \norm{\cdot}_{L^p})$ is a Banach space for $p \in [1, \infty]$, where
    \hypertarget{def:lpnorm}{
    \begin{equation*}
        \norm{f}_{L^p} \coloneqq \left(\int_X \abs{f}^p\right)^{\frac{1}{p}}, \quad \norm{f}_{L^\infty} \coloneqq \inf\set{M \geq 0 | \mu\{\abs{f(x)} \geq M\} = 0}.
    \end{equation*}}
\end{thm}
\begin{ex}
    Take $\mu(X) < \infty$, so the domain of $f$ is a finite \hyperlink{def:measure}{measure} space. Take $f \in \hyperlink{def:lpspace}{L^\infty(X)}$, then show $f \in L^p(X)$ for any $p \in [1, \infty)$ and
    \begin{equation*}
        \lim_{p \to \infty} \norm{f}_{L^p(X)} = \norm{f}_{L^\infty(X)}.
    \end{equation*}
\end{ex}

\begin{proof}
    Vector space axioms and triangular inequality (here called Minkowski) left as an exercise - see Linear Analysis.
    Instead, we focus on completeness.

    Start with $p \in [1, \infty)$.
    Initially, prove this auxiliary result.

    \textbf{Claim}: Take $p \in [1, \infty)$, and consider a sequence $(g_k) \in \hyperlink{def:lpspace}{L^p(X)}$ such that
    \begin{equation*}\sum_{k \geq 1} \norm{g_k}_{L^p(X)} = M < \infty.\end{equation*}
    Then there exists $G \in L^p(X)$ such that $\sum_{k=1}^n g_k$ converges to $G$ in $L^p(X)$ and almost everywhere.

    \textbf{Proof of the claim}: Let
    \begin{equation*}
        h_n(x) \coloneqq \sum_{k=1}^n \abs{g_k(x)}, \quad h(x) \coloneqq \sum_{k=1}^\infty \abs{g_k(x)} \in [0, \infty].
    \end{equation*}
    $(h_n)$ is a non-decreasing sequence and $h_n \to h$ pointwise.
    Hence, \hyperlink{thm:Beppo}{Beppo-Levi} gives that
    \begin{equation*}
        \int_X h_n^p \, d\mu \to \int_X h^p  \, d\mu \in [0, \infty].
    \end{equation*}
    By the assumption on $(g_k)$,
    \begin{align*}
        &\implies \norm{h_n}_{L^p(X)} \leq \sum_{k=1}^n \norm{g_k}_{L^p(X)} \leq M < \infty \\
        &\implies \norm{h}_{L^p(X)} \text{ is finite and less than } M.
    \end{align*}
    Hence $h$ finite almost everywhere, and $\sum g_k$ is absolutely convergent almost everywhere, so convergent almost everywhere.

    Let us call $G = \lim_{n \to \infty} \sum_{k=1}^n g_k$ (almost everywhere).
    \begin{equation*}
        \abs{G(x)} \leq \abs{\sum_{k=1}^n g_k} \leq \sum_{k=1}^\infty \abs{g_k} = h(x)
    \end{equation*}
    so $G \in L^p(X)$.

    Using the Dominated Convergence Theorem,
    \begin{equation*}
        \int_X \abs{G(x) - \sum_{k=1}^n g_k}^p \, d\mu \to 0
    \end{equation*}
    since the integrand converges pointwise to 0, and the domination is given by
    \begin{equation*}\abs{G(x) - \sum_{k=1}^n g_k}^p \leq 2^p h(x)^p,\end{equation*} where $h^p$ integrable since $G \in L^p(X)$ and $\sum_{k=1}^m g_k \to G$ in $L^p(X)$ and almost everywhere.
    This proves the claim, so we go back to the main proof.

    Let $(f_k)$ be a Cauchy sequence in $L^p(X)$.
    Build a subsequence $(f_{\phi(k)})$ such that $g_k \coloneqq f_{\phi(k+1)} - f_{\phi(k)}$ satisfies $\norm{g_k}_{L^p(X)} \leq \frac{1}{2^k}$, so $g_k$ satisfies the assumptions of the claim.
    Hence, $\exists G \in L^p(X)$ such that $\sum_{k=1}^n g_k \to G$ almost everywhere and in $L^p(X)$. But $g_k = f_{\phi(k+1)} - f_{\phi(k)}$.
    So,
    \begin{equation*}
        f_{\phi(n)} \longrightarrow f_{\phi(1)} + G \eqqcolon F
    \end{equation*}
    where the convergence is in $L^p(X)$ and almost everywhere.
    But $(f_n)$ Cauchy in $L^p(X)$, so $f_n \to F$ in $L^p(X)$.
\end{proof}

\begin{remark}
    Take $(f_n)$ convergent in $L^p(X)$, $f_n \to F$ in $L^p(X)$. Then (we proved) $\exists$ subsequence $f_{\phi(n)} \to F$ converging almost everywhere.
\end{remark}
\begin{ex}
    \leavevmode
    \begin{enumerate}[label=\arabic*)]
        \item Find a sequence $(f_n)$ converging in $\hyperlink{def:lpspace}{L^p(\R)}$ and not converging almost everywhere to its $L^p$ limit (for $p \in [1, \infty)$).
            This shows passing to a subsequence was necessary, and not a defect of the argument.
            (See sheet 1, question 10).
        \item Complete the proof of \hyperlink{thm:rieszFischer}{Riesz-Fischer} theorem in the $p=\infty$ case.
    \end{enumerate}
\end{ex}

\begin{thm}[Abstract density result]
    Take a measure space $(X, \mathscr{A}, \mu)$ and $p \in [1, \infty]$. Then \hyperlink{def:simple}{simple functions} that belong to \hyperlink{def:lpspace}{$L^p(X)$} are dense in $L^p(X)$.
\end{thm}
\begin{proof}
    For $f$ real or complex, split into real/imaginary parts and positive/negative parts to reduce to approximating $f \geq 0$ by \hyperlink{def:simple}{simple} functions.
    Define
    \begin{equation*}
        S_n =
        \begin{cases}
            n & \text{on } B_n = \set{f \geq n} \\
            \frac{i-1}{2^n} & \text{on } A_n^i = \{f \in [\frac{i-1}{2^n}, \frac{i}{2^n})\}, 1 \leq i \leq n 2^n
        \end{cases}
    \end{equation*}
    our usual approximation.
    In the case $p=\infty$, $\norm{f}_{L^\infty(X)} < \infty$, thus for $n > \norm{f}_{L^\infty(X)}$, $\abs{S_n-f} \leq \frac{1}{2^n}$ almost everywhere. Then $\norm{S_n-f}_{L^\infty(X)} \leq \frac{1}{2^n} \to 0$.
    In the case $p \in [1, \infty)$, $0 \leq S_n \leq f$ and $S_{n+1} \geq S_n$, with $S_n \to f$ pointwise. By \hyperlink{thm:Beppo}{Beppo-Levi monotone convergence}, $\norm{S_n - f}_{L^p(X)} \to 0$.
\end{proof}

\begin{thm}[Density-separability of $L^p(\R^n)$, $p \in [1, \infty)$]
    \leavevmode
    \begin{enumerate}[label=(\arabic*)]
        \item For $\mathcal{O}$ an open set in $\R^n$, $L^p(\mathcal{O})$ is separable (has a countable dense subset).
        \item Smooth functions compactly supported in $\mathcal{O}$ are dense in $L^p(\mathcal{O})$.
    \end{enumerate}
\end{thm}

We need and admit a theorem from Probability and Measure (this statement is non-examinable).
\begin{defi}[Regular measure]\hypertarget{def:regularMeasure}
    A regular \hyperlink{def:measure}{measure} on a topological space $X$ with \hyperlink{def:sigAlg}{$\sigma$-algebra} $\mathscr{A}$ of \hyperlink{def:measFunc}{measurable} sets is a measure such that every measurable set can be approximated from above by open measurable sets and from below by compact measurable sets.
\end{defi}
\begin{thm}[Regularity of the Lebesgue measure]
    The \hyperlink{def:lebMeas}{Lebesgue measure} on $\R^n$ is regular for the Lebesgue sets.
\end{thm}
Observe this implies that any Lebesgue set of finite \hyperlink{def:measure}{measure} in $\R^n$ is squeezed between two \hyperlink{def:borelSet}{Borel sets} with the same measure.
\begin{proof}
    \leavevmode
    \begin{enumerate}[label=(\arabic*)]
        \item Let $\mathcal{C} = \{\text{open sets of the form } \prod_{i=1}^n (a_i, b_i), a_i, b_i \in \Q\}$, a countable set.

            Claim: Any open set $\mathcal{U} \subset \R^n$ can be covered with a countable union of elements of $\mathcal{C}$ with disjoint interiors.

            Use an inductive procedure: Split into $\Z^n$.
            \begin{enumerate}[label=\arabic*.]
                \item Keep cubes that are fully inside, discard ones that are fully outside.
                \item For borderline cubes, divide into $2^n$ cubes evenly and go back to step 1.
            \end{enumerate}
            Check that $\mathcal{U} = \bigcup_{n, k} C_{n, k}$, and note that the hypercubes have dyadic, hence rational coordinates.
            The figure shows a few steps for an example in $\R^2$.
            \begin{center}
                \begin{tikzpicture}[scale=1.4]
                    \begin{scope}[every path/.append style={gray, ultra thin}]
                        \fill [orange!10] (2, 1) rectangle (6, 2);
                        \fill [orange!10] (3, 2) rectangle (6, 3);

                        \begin{scope}[xshift=4cm, yshift=3cm, scale=1/2]
                            \fill [orange!20] (1, 0) rectangle (2, 1);
                            \begin{scope}[every path/.append style={fill=orange!28, line width=0.06pt}, scale=1/2]
                                \foreach \y/\b/\e in {0/0/1,0/1/2,1/1/2}
                                \fill (\b,\y) rectangle (\e,\y+1);
                                \begin{scope}[every path/.append style={fill=orange!35}, scale=1/2]
                                    \fill (0, 2) rectangle (2, 3);
                                    \fill (4, 4) rectangle (8, 5);
                                    \fill (7, 5) rectangle (8, 6);
                                    \begin{scope}[every path/.append style={fill=orange!43, line width=0.03pt}, scale=1/2]
                                        \foreach \y/\b/\e in {6/1/4,7/3/4,8/5/8,10/10/14,11/13/14}
                                        \fill (\b,\y) rectangle (\e,\y+1);
                                        \begin{scope}[every path/.append style={fill=orange!50}, scale=1/2]
                                            \foreach \y/\b/\e in {12/0/2,13/1/2,14/4/6,16/8/10,18/13/16,19/15/16,20/18/20,22/23/26,24/29/32}
                                            \fill (\b,\y) rectangle (\e,\y+1);
                                            \foreach \y/\b/\e in {13/0/1, 14/0/4, 15/3/6, 16/5/8, 17/7/10, 18/9/13, 19/12/15,
                                                                  20/14/18, 21/17/20, 22/19/23, 23/22/26, 24/25/29, 25/28/32, 26/31/32}
                                            \draw [step=0.5] (\b,\y) grid (\e,\y+1);
                                        \end{scope}
                                        \foreach \x/\y/\z in {6/0/1, 7/0/3, 8/2/5, 9/4/8, 10/7/10, 11/9/13, 12/12/16, 13/15/16}
                                        \draw [step=0.5] (\y,\x) grid (\z,\x+1);
                                    \end{scope}
                                    \foreach \x/\y/\z in {3/0/2, 4/1/4, 5/3/7, 6/6/8}
                                    \draw [step=0.5] (\y,\x) grid (\z,\x+1);
                                \end{scope}
                                \draw [step=0.5] (0,1) grid (1,2);
                                \draw [step=0.5] (0,2) grid (4,3);
                                \draw [step=0.5] (3,3) grid (4,4);
                            \end{scope}
                            \draw [step=1] (0, 0) grid (2, 2);
                            \draw [step=0.5] (0, 0) grid (1, 1);
                            \draw [step=0.5] (0, 1) grid (1, 2);
                            \draw [step=0.5] (1, 1) grid (2, 2);
                            \begin{scope}[every path/.append style={line width=0.02pt}, scale=1/32]
                                \foreach \y/\b/\e in {27/0/2,28/1/4,29/3/7,30/6/9,31/8/11,32/10/13,33/12/16,34/15/18,
                                                      35/17/20,36/19/23,37/22/25,38/24/27,39/26/30,40/29/32,41/31/35,
                                                      42/34/37,43/36/40,44/39/43,45/42/45,46/44/48,47/47/51,48/50/54,
                                                      49/53/57,50/56/60,51/59/63,52/62/64}
                                \draw [step=0.5] (\b,\y) grid (\e,\y+1);
                            \end{scope}
                            \begin{pgfonlayer}{background}
                                \begin{scope}[every path/.append style={fill=orange!58}, scale=1/32]
                                    \foreach \y/\b/\e in {26/0/2,28/4/8,29/7/8,30/9/12,31/11/12,32/13/16,34/18/20,36/23/26,
                                                          37/25/26,38/27/30,40/32/36,41/35/36,42/37/40,44/43/46,45/45/46,
                                                          46/48/52,47/51/52,48/54/58,49/57/58,50/60/64,51/63/64}
                                    \fill (\b,\y) rectangle (\e,\y+1);
                                \end{scope}
                                \begin{scope}[every path/.append style={fill=orange!65}, scale=1/64,yshift=1pt,xshift=1pt]
                                    \foreach \y/\b/\e in {54/1/4,56/6/8,58/10/14,59/13/14,60/15/18,61/17/18,62/19/22,
                                                          64/24/26,66/29/32,67/31/32,68/33/36,70/38/40,72/43/46,73/45/46,
                                                          74/47/50,76/52/54,78/57/60,79/59/60,80/62/64,82/67/70,83/69/70,
                                                          84/72/74,86/77/80,87/79/80,88/82/86,89/85/86,90/87/90,92/93/96,
                                                          93/95/96,94/98/102,95/101/102,96/104/108,97/107/108,98/110/114,
                                                          99/113/114,100/116/120,101/119/120,102/122/126,103/125/126}
                                    \fill (\b,\y) rectangle (\e,\y+1);
                                \end{scope}
                            \end{pgfonlayer}
                        \end{scope}
                        %\begin{scope}[xshift=3cm, yshift=3cm, scale=1/2]
                        %    \begin{scope}[every path/.append style={fill=orange!30, line width=0.06pt}, scale=1/2]
                        %        \fill (3,0) rectangle (4,1);
                        %        \begin{scope}[every path/.append style={fill=orange!40}, scale=1/2]
                        %        \foreach \y/\b/\e in {0/3/6,1/5/6}
                        %        \fill (\b,\y) rectangle (\e,\y+1);
                        %        \begin{scope}[every path/.append style={fill=orange!50, line width=0.03pt}, scale=1/2]
                        %        \foreach \y/\b/\e in {0/3/6,2/8/10,4/12/16,5/15/16}
                        %        \fill (\b,\y) rectangle (\e,\y+1);
                        %            \begin{scope}[every path/.append style={fill=orange!60}, scale=1/2]
                        %            \foreach \y/\b/\e in {0/3/6,2/8/12,3/11/12,4/13/16,5/15/16,6/18/20,8/22/24,10/27/30,11/29/30,
                        %                                  12/31/32}
                        %            \fill (\b,\y) rectangle (\e,\y+1);
                        %            \begin{scope}[every path/.append style={fill=orange!80}, scale=1/2]
                        %            \foreach \y/\b/\e in {0/3/6,2/8/12,3/11/12,4/14/16,6/18/22,7/21/22,8/23/26,
                        %                                  10/28/30,12/33/36,13/35/36,14/37/40,15/39/40,16/41/44,
                        %                                  18/46/48,20/50/54,21/53/54,22/55/58,23/57/58,24/59/62}
                        %            \fill (\b,\y) rectangle (\e,\y+1);
                        %            \end{scope}
                        %            \foreach \y/\b/\e in {0/0/3,1/2/6,2/5/8,3/7/11,4/10/13,5/12/15,6/14/18,7/17/20,
                        %                                  8/19/22,9/21/24,10/23/27,11/26/29,12/28/31,13/30/32}
                        %            \draw [step=0.5] (\b,\y) grid (\e,\y+1);
                        %            \end{scope}
                        %        \foreach \x/\y/\z in {0/0/3, 1/2/6, 2/5/8, 3/7/10, 4/9/12, 5/11/15, 6/14/16}
                        %        \draw [step=0.5] (\y,\x) grid (\z,\x+1);
                        %        \end{scope}
                        %        \foreach \y/\b/\e in {0/0/3,1/2/5,2/4/8,3/7/8}
                        %        \draw [step=0.5] (\b,\y) grid (\e,\y+1);
                        %        \end{scope}
                        %        \foreach \y/\b/\e in {0/0/3,1/2/4}
                        %        \draw [step=0.5] (\b,\y) grid (\e,\y+1);
                        %    \end{scope}
                        %    \draw [step=1] (0, 0) grid (2, 2);

                        %    \draw [step=0.5] (0, 0) grid (1, 1);
                        %    \draw [step=0.5] (1, 0) grid (2, 1);
                        %\end{scope}
                        \node (A) at (1.0, 2.0) {};
                        \node (B) at (2.0, 1.0) {};
                        \node (C) at (6.0, 0.7) {};
                        \node (D) at (6.0, 3.8) {};
                        \node (E) at (3.0, 3.0) {};
                        \draw [bblue] plot [smooth cycle, tension=0.7] coordinates {(A) (B) (C) (D) (E)};
                    \end{scope}
                    \draw [gray, very thin, step=1] (-0.7,-0.7) grid (7.7,4.7);
                    \draw [->] (-0.8, 0) -- (7.9, 0);
                    \draw [->] (0, -0.8) -- (0, 4.9);
                \end{tikzpicture}
            \end{center}
            This proves the claim.

            % This gives
            % \begin{equation*}
            %     s = \sum_{i=1}^k \alpha_i \chi_{c_i} \quad c_i \in \mathcal{C}, \, \alpha_i \in \Q.
            % \end{equation*}

            Now take $f \in L^p(\mathcal{O})$, and $s_k = \sum_{i=1}^k \alpha_i \chi_{A_i}$ simple functions such that $s_k \nearrow f$.

            Each $A_i$ (measurable) can be approximated by $U_i$ open sets with $\frac{\epsilon}{k}$ error in measure (outer regularity).
            Each $U_i$ is covered by rational cubes $C_{l, i}$ by the claim:
            \begin{equation*}
                (\infty > \mu(A_i) + \epsilon >) \mu(U_i) = \sum_{l \geq 1} \mu(C_{l, i}).
            \end{equation*}
            Pick up enough (finitely many) $(C_{l, i})_{l=1}^{m_i}$ such that
            \begin{equation*}
                \abs{\mu(U_i) - \sum_{i=1}^{m_i} \mu(C_{l, i})} \leq \frac{\epsilon}{k}.
            \end{equation*}
            Putting together all cubes $(C_{l, i})^k_{i=1, l=1, \dotsc, m_i}$ with error in measure less than $2\epsilon$,
            \begin{align*}
                \tilde{s_k} &= \sum_{i=1}^k \alpha_i \left(\sum_{l=1}^{m_i} \chi_{C_{l, i}}\right)\\
                \tilde{\tilde{s_k}} &= \sum_{i=1}^k \tilde{\alpha_i} \left(\sum_{l=1}^{m_i} \chi_{C_{l, i}}\right)
            \end{align*}
            where $\abs{\alpha_i  -\tilde{\alpha_i}} \leq \frac{\epsilon}{k}$, and $\tilde{\alpha_i} \in \Q$, so $\tilde{\tilde{s_k}}$ belongs to the target set.

            One more approximation step: $L^\infty$ bound on coefficients.
        \item On each $C_{l, i}$ approximate $\chi_{C_{l, i}}$.
            In $C^0$ we can do this easily with affine functions. To approximate with $C^\infty$ functions, we can use translations and copies from a smooth compactly supported functions, for instance $e^{-\frac{1}{x^2}}$.
            % pic of affine functions and the exp thing
            This requires on the continuity of the translation operator in $L^p$. In particular, with the translation operator $\tau_h f = f(\cdot + h_n)$, we need
            \begin{equation*}
                \norm{\tau_h f - f}_{L^p} \xrightarrow{h \to 0} 0.
            \end{equation*}
            We can show this by proving for simple functions, then approximate. \qedhere
    \end{enumerate}
\end{proof}
\begin{ex}
    Prove $L^\infty(\R^n)$ is not separable. (Hint: consider $(\chi_{B(0, r)})_{r > 0}$).
\end{ex}

\clearpage
\subsection{How regular are integrable/measurable functions}
Take $f \in L^1(\R)$, and let
\begin{equation*}
    \int_0^x f(y) \, dy \eqqcolon F(x).
\end{equation*}
Is $F$ differentiable?
\begin{defi}[Lebesgue point]\hypertarget{def:lebPoint}
    Let $f: \R^n \to \C$ be \hyperlink{def:measFunc}{measurable}. $x \in \R^n$ is a \textbf{Lebesgue point} if
    \begin{equation*}
        \frac{1}{\mu(B(x, r))} \int_{B(x, r)} \abs{f(y) - f(x)} \, dy \xrightarrow{r \to 0} 0.
    \end{equation*}
\end{defi}
\begin{remark}
    \begin{align*}
        \frac{F(x+r)-F(x)}{r} &= \frac{1}{r} \int_x^{x+r} f(y) \, dy \\
        \implies \abs{\frac{F(x+r)-F(x)}{r} - f(x)} &\leq \frac{2}{\mu(B(x,r))} \int_{B(x,r)} \abs{f(y) - f(x)} \, dy
    \end{align*}
    so if $x$ is a Lebesgue point of $f$, then $F'(x)$ exists and is equal to $f(x)$.
    % \begin{equation*}
    %     \frac{F(x+r)-F(x)}{r} = \frac{1}{r} \left(\int_0^{x+r} f - \int_0^x f\right) = \frac{1}{r} \int_x^{x+r} f \xrightarrow{?} f(x) = F'(x).
    % \end{equation*}
\end{remark}
\begin{ex}[Worked example]
    Prove that points of continuity are \hyperlink{def:lebPoint}{Lebesgue points}:
    \begin{equation*}
        x \text{ a point of continuity} \implies \forall \epsilon > 0, \, \exists r_0 > 0 \text{ s.t. } \forall y \in B(x, r_0) \, \abs{f(x) - f(y)} < \epsilon.
    \end{equation*}
    Hence for $r < r_0$,
    \begin{equation*}
        \frac{1}{\mu(B(x, r))} \int_{B(x,r)} \abs{f(y) - f(x)} \, d\mu < \epsilon.
    \end{equation*}
    True for any $\epsilon>0$, so we have a Lebesgue point.
\end{ex}
\begin{thm}[Lebesgue differentiation and density theorems]\leavevmode
    \begin{enumerate}[label=(\arabic*)]
        \item Differentiation: For $f \in L^1(\R^n)$, almost every $x \in \R^n$ is a Lebesgue point.
        \item Density: For any $E$ a \hyperlink{def:borelSet}{Borel set} of $\R^n$, for almost every $x \in \R^n$,
            \begin{equation*}
                \frac{\mu(E \cap B(x, r))}{\mu(B(x, r))} \xrightarrow{r \to 0} \chi_E(x). \label{1.4star} \tag{$*$}
            \end{equation*}
    \end{enumerate}
\end{thm}
Loosely speaking, the density theorem says that the `edge' of a Borel set has measure 0. It is straightforward to prove the density theorem from the differentiation theorem, so we do that first.
\begin{proof}[Proof (1) $\Rightarrow$ (2)]
    Consider $\abs{x} \leq M$, and wlog take $r < 1$.
    \begin{equation*}
        \frac{\mu(E \cap B(x, r))}{\mu(B(x, r))} = \frac{\mu(E \cap B(0, M+1) \cap B(x, r))}{\mu(B(x, r))}.
    \end{equation*}
    Apply (1) to $f \coloneqq \chi_{E \cap B(0, M+1)} \in L^1(\R^n)$, giving that \eqref{1.4star} holds for almost every $x \in B(0, M)$.
    Say $N_M$ is the subset of $B(0,M)$ on which \eqref{1.4star} fails.
    Then, $N_0 \coloneqq \bigcup_{M \geq 1} N_M$ is a null set, and \eqref{1.4star} holds for $x \in \R^n \setminus N_0$, as required.
    % Do that for any $M \in \N_{\geq 0}$, (2) true for almost every $x \in B(0, M)$, $\forall M \in N_{\geq 0}$, i.e. outside $N_M$.
    % $N_0 = \bigcup_{M \geq 1} N_M$ is a null set, (2) true on $\R^n \setminus N_0$.
    %  check phone for pictures of this - grammar is unclear.
\end{proof}
\color{gray}
\begin{proof}[Proof of (1)]
    \newcommand{\mf}{m \! f}
    \newcommand{\Mf}{M \! f}
    Note that this is immediately true if $f$ is continuous, from the exercise earlier. So, aim to write $f = g+h$ where $g$ continuous and $\norm{h}_{L^1(\R^n)}$ is as small as is needed.

    \textbf{Step 1}. Define the Hardy-Littlewood operator
    \begin{align*}
        \Mf(x) &\coloneqq \sup_{r \geq 0}  \mf (x, r), \quad \mf(x, r) \coloneqq \frac{1}{\mu(B(x, r))} \int_{B(x,r)} \abs{f} \, d\mu\\
        \shortintertext{and} \\
        \quad E_a &\coloneqq \set{x \in \R^n | \Mf(x) > a} \quad \text{for } a > 0
    \end{align*}
    Claim: $E_a$ is an open set, hence measurable.
    Take $x \in E_a$. $\Mf(x) > a$, so $\exists r >0$ such that $\mf(x) > a$ and $\frac{a}{\mf(x)} < 1$.
    Pick $\epsilon > 0$ small enough such that $(\frac{r}{r+\epsilon}) > \frac{a}{\mf(x, r)}$. Consider $y \in B(x, \epsilon)$, so $B(x, r) \subset B(y, r + \epsilon)$ by triangle inequality.
    \begin{align*}
        \mf(y, r+\epsilon) &= \frac{1}{\mu(B(y, r+\epsilon))} \int_{B(y, r+\epsilon)} \abs{f} \, d\mu \\
                          &\geq \left(\frac{r}{r+\epsilon}\right)^n \frac{1}{\mu(B(x,r))} \int_{B(x, r)} \abs{f} \, d\mu \\
                          &\geq \left(\frac{r}{r+\epsilon}\right)^n \mf(x, r) > a
    \end{align*}
    Conclude that $B(x, \epsilon) \subset E_a$, hence open.

    Now take $x \in E_a$. Relate the volume of a local ball to $\int \abs{f}$:

    \textbf{Step 2}. Vitali's covering lemma.
    Take $X \subset \R^n$, and $X \subset \bigcup_{i=1}^N B(x_i, r_i)$.  Then $\exists J \subset \{1, \dotsc, N\}$ subset of indices such that
    \begin{enumerate}[label=(\alph*)]
        \item $(B(x_i, r_i))_{i \in J}$ are pairwise disjoint
        \item
            \begin{equation*}
                X \subset \bigcup_{i \in J} B(x_i, 3 r_i)
            \end{equation*}
    \end{enumerate}
    Proof: WLOG, take $r_1 \geq r_2 \geq \dotsb \geq r_N$. Consider $B(x_1, r_1)$. All balls that intersect it are entirely included in $B(x_1, 3 r_1)$. % pic to demonstrate
    Remove these intersecting balls, to give a set of indices $J_1$. By induction, start the argument again on the second largest radius.
    The induction preserves the covering property, so we are done.

    % lecture 5
    \textbf{Step 3}. Claim: $\mu(E_a) \leq \frac{3^n}{a} \norm{f}_{L^1(\R^n)}$.

    Let $K \subset E_a$ be compact.
    For each $x \in K$ $\exists r_x$ with $\mf(x, r_x) > a$.
    \begin{align*}
        K &\subset \bigcup_{x \in K} B(x, r_x) \\
          &\subset \bigcup_{i=1}^N B(x_i, r_i) \\
          &\subset \bigcup_{i \in J} B(x_i, 3 r_i)
    \end{align*}
    using compactness to get to the second line, and Vitali's covering lemma for the third. Now,
    \begin{align*}
        \mu(K) &\leq \sum_J \mu(B(x_i, 3 r_i)) \\
               &= 3^n \sum_J \mu(B(x_i, r_i)) \\
               &\leq \frac{3^n}{a} \left(\sum_J \int_{B(x_i, r_i)} \abs{f} \, d\mu\right) \\
               &\leq \frac{3^n}{a} \int_{\bigcup_J B(x_i, r_i)} \abs{f} \, d\mu \\
               &\leq \frac{3^n}{a} \int_{\R^n} \abs{f} \, d\mu.
    \end{align*}
    This bound is independent of $K$, and by inner regularity \begin{equation*}\mu(E_a) = \sup\set{\mu(K) | K \subset E_a \text{ compact}},\end{equation*} giving the required result:
    \begin{equation*}
        \mu(E_a) \leq \frac{3^n}{a} \int \abs{f} \, d\mu = \frac{3^n}{a} \norm{f}_{L^1}.
    \end{equation*}

    \textbf{Step 4}.
    Say $f = g+h$ for $g \in L^1(\R^n)$ continuous, and $h \in L^1(\R^n)$, $\norm{h}_{L^1} < \epsilon$.
    Define
    \begin{equation*}
        t\!f(x, r) = \frac{1}{\mu(B(x, r)))} \int_{B(x, r)} \abs{f(y) - f(x)} \, d \mu(y).
    \end{equation*}
    So,
    \begin{equation*}
        t\!f(x, r) \leq t \! g(x, r) + \frac{1}{\mu(B(x, r))} \int_{B(x, r)} \abs{h(y)} \, dy + \abs{h(x)}.
    \end{equation*}
    Define $T \! f (x) = \limsup_{r \to 0} t \! f(x, r)$, so $T\! f(x) \leq T \! g(x) + M \! h(x) + \abs{h(x)}$, and $T\!g(x)  = 0$ as $g$ is continuous.
    Take $k \in \N$, then
    \begin{align*}
        \mu\left(\Set{x | T \! f > \frac{1}{k}}\right) &\leq \mu\left(\Set{x | M \! h > \frac{1}{k}}\right) + \mu\left(\Set{x | \abs{h} > \frac{1}{2k}}\right) \\
                                            &\leq 2k 3^n \norm{h}_{L^1} + 2k \norm{h}_{L^1} \\
                                            &\leq 2k (3^n+1) \epsilon
    \end{align*}
    using \hyperlink{def:chebyshev}{Chebyshev's inequality} and Step 3.
    This holds $\epsilon > 0$, since continuous functions are dense in $L^1$ so $\mu\left(\Set{x | T \! f > \frac{1}{k}}\right) = 0$.
    Take the (countable) union for all $k\geq 1$, giving $\mu\left(\Set{x | T\! f > 0}\right) = 0$.
    So, almost every $x$ is a \hyperlink{def:lebPoint}{Lebesgue point}.
\end{proof}
\color{black}
Pointwise convergence is `almost' uniform convergence.
\begin{thm}[Egorov's Theorem]\label{thm:egorov}
    Take $f_n: \R^d \to \C$ a sequence of \hyperlink{def:measFunc}{measurable functions}, and $A \subset \R^d$ a \hyperlink{def:borelSet}{Borel set} of finite measure, $f_n \to f$ pointwise on $A$.
    Then $\forall \epsilon > 0, \ \exists A_\epsilon \subset A$, $A_\epsilon$ a Borel set with $\mu(A \setminus A_\epsilon) \leq \epsilon$, and $f_n$ converges uniformly to $f$ on $A_\epsilon$.
\end{thm}
\begin{proof}
    Define for $k, n \geq 1$,
    \begin{equation*}
        E_n^{(k)} = \bigcap_{p \geq n} \Set{x \in A | \abs{f_p(x) - f(x)} \leq \frac{1}{k}}.
    \end{equation*}
    Check $E_n^{(k)} \subset E_{n+1}^{(k)}$, $E_n^{(k+1)} \subset E_n^{(k)}$ and for fixed $k \geq 1$ $A = \bigcup_{n \geq 1} E_n^{(k)}$ (pointwise convergence).
    Using continuity from below, $\mu(A) = \lim_n \mu(E_n^{(k)})$, so $\exists {n_k \geq 1}$ such that $\Delta_k = A \setminus E_{n_k}^{(k)}$ has measure $\mu(\Delta_k) \leq \frac{\epsilon}{2^k}$.
    Then $\Delta \coloneqq \bigcup_{k \geq 1} \Delta_k$ has measure $\mu(\Delta) \leq \sum \mu(\Delta_k) \leq \epsilon$, and let $A_\epsilon = A \setminus \Delta$.

    Observe there is uniform convergence on $A_\epsilon$: $\forall k \geq 1$, $\exists n_k \geq 1$ such that $A_\epsilon \subset E_{n_k}^{(k)}$.
    This means: $\sup_{x \in A_\epsilon} \abs{f_p(x) - f(x)} \leq \frac{1}{k} \ \forall p \geq n_k$.
\end{proof}

\begin{thm}[Lusin version 1]
    Take $f: \R \to \C$ \hyperlink{def:measFunc}{measurable}.
    Given any $\epsilon > 0$, $\exists E \subset \R$ measurable and $\mu(E) < \epsilon$ such that $f|_{\R \setminus E}$ is continuous.
\end{thm}
\begin{remark}
    Notice this is different from `$f$ continuous at all points in $\R \setminus E$' (in particular weaker).
\end{remark}
\begin{proof}[Sketch of long proof]
    Build a sequence $s_n$ of step functions converging to $f$, use \nameref{thm:egorov} and conclude... See full details in \href{https://cmouhot.files.wordpress.com/2017/01/notes-af-v21.pdf}{official notes} (Theorem 1.34).
\end{proof}
\begin{proof}[Short proof (discouraged)]
    It is enough to do it for $f: F \to \C$ (where $F = [l, l+1)$) for any $l \in \Z$, and $E = \bigcup_{l \in \Z} E_l$, $\mu(E_l) \leq \frac{\epsilon}{2^{l+1}}$.
    Take $(V_n)_{n \geq 1}$ an enumeration of open intervals with rational endpoints (intersected with $F$).
    By inner regularity, with $f^{-1}(V_n)$ measurable and $F \setminus f^{-1}(V_n)$ measurable, choose $K_n, K_n'$ compact sets such that $K_n \subset f^{-1}(V_n)$ and $K_n' \subset F\setminus f^{-1}(V_n)$ and $\mu(F \setminus (K_n \cup K_n')) < \frac{\epsilon}{2^n}$.
    Fix open sets $U_n$ such that $K_n \subset U_n$, $U_n \cap K_n' = \emptyset$ (using compactness).
    Now, $K \coloneqq \bigcap_{n \geq } (K_n \cup K_n')$ satisfies
    \begin{equation*}
        \mu(F \setminus K) \leq \sum_{n \geq 1} \mu(F \setminus (K_n \cup K_n')) \leq \epsilon.
    \end{equation*}
    Given $x \in K$, for any $n \geq 1$ such that $f(x) \in V_n$, $\Rightarrow x \in K_n$. Moreover, $K_n \subset U_n$, $U_n$ open hence $f(U_n \cap K) \subset V_n$.
\end{proof}
\begin{thm}[Lusin version 2]
    Take $f: \R \to \C$ \hyperlink{def:measFunc}{measurable}.
    Given any $\epsilon > 0$, $\exists G \subset \R$ with $\mu(G) < \epsilon$ and $g: \R \to \C$ such that $f = g$ on $\R \setminus G$, $g$ continuous.
\end{thm}
\begin{proof}
    The previous theorem implies that $\exists E$ measurable such that $\mu(E) < \frac{\epsilon}{2}$ where $f|_{R \setminus E}$ is continuous.
    Outer regularity gives $\exists G$ open, $G \supset E$, $\mu(G) < \epsilon$ where $G = \bigsqcup_{n \geq 1} I_n$, for $I_n$ open intervals.
    Define
    \begin{equation*}
        g(x) =
        \begin{cases}
            f(x) & x \in \R \setminus G \\
            f(a_n) + \frac{(x-a_n)}{b_n - a_n} (f(b_n) - f(a_n)) & x \in (a_n, b_n)=I_n.
        \end{cases}\qedhere
    \end{equation*}
\end{proof}
\begin{ex}
    Reprove from this that continuous functions are dense in $L^1(\R)$.
\end{ex}

\clearpage
\section{Vector spaces of functions}
\subsection{Recalls on vector spaces}
Omitted from lectures - see \href{https://cmouhot.files.wordpress.com/2017/01/chap2-v13.pdf}{official notes} for details. These are recalls from previous courses, mostly Linear Analysis.
\subsection{Separating points and Hahn-Banach theorem}
We restate the Hahn-Banach theorem from Linear Analysis, and give consequences. The consequences are important, but proofs thereof are non-examinable.
\begin{thm}[Hahn-Banach]\label{thm:hb}
    Take a normed vector space $E$.
    \begin{enumerate}[label=(\roman*)]
        \item Take $E_0$ subspace of $E$, $F:E_0 \to \R$ linear continuous. Then, $\exists \tilde{F}:E \to \R$ continuous linear which extends $F$, and
            \begin{equation*}
                \norm{F}_{E_0'} \coloneqq \sup\set{F(f) | f \in E_0, \norm{f} \leq 1} = \lVert\tilde{F}\rVert _{E'}= \sup\set{\tilde{F}(f)| f \in E, \norm{f} \leq 1}.
            \end{equation*}
            The letter $f$ is used to encourage thinking about function spaces.
        \item Let $A \subset E$ be open convex non-empty and $B \subset E$ convex non-empty with $A \cap B = \emptyset$.
            Then $\exists F: E \to \R$ linear continuous such that
            \begin{align*}
                F &< \alpha \text{ on } A \\
                F &\geq \alpha \text{ on } B
            \end{align*}
            for some $\alpha \in \R$.
        \item Take $A \subset E$ closed convex non-empty and $B \subset E$ compact convex non-empty with $A\cap B= \emptyset$.
            Then $\exists F: E \to \R$ linear continuous such that
            \begin{align*}
                F &\leq \alpha - \epsilon\text{ on }A \\
                F &\geq \alpha + \epsilon\text{ on }B
            \end{align*}
            for some $\alpha \in \R$, $\epsilon> 0$.
            % pictures for both
    \end{enumerate}
\end{thm}

\clearpage
\subsection{Duality and weak topologies}
We know that the Bolzano-Weierstrass theorem holds for $\R$, for $\R^n$ and more generally for $\C^n$.
But, the theorem fails in infinite dimensional vector spaces over $\R$. For example, take the basis vectors of $\ell^2$.
How can we restore this?
In order to get \emph{more} compact sets, we should try taking \emph{fewer} open sets, so try to weaken the topologies.
\begin{defi}[Initial topology]\hypertarget{def:initTop}
    Take $X$, $(Y_i)_{i \in I}$ topological spaces and a family of functions $\phi_i: X \to Y_i$.
    Then the \textbf{initial topology} is the weakest topology on $X$ that makes all $(\phi_i)_{i \in I}$ continuous.
\end{defi}
\begin{remark}
    There is also a notion of \hypertarget{def:finalTop}{final topology}, with $\phi_i: Y_i \to X$, taking the finest topology such that they are all continuous.
\end{remark}
\begin{ex}\leavevmode
    \begin{enumerate}[label=(\arabic*)]
        \item Construct the smallest topology $\mathscr{T}$ (subsets of $X$) that is stable under finite intersection and general union, that contains a given family of subsets $\mathcal{F}$.
        \item Check that $\mathscr{T}$ above is realised by first taking finite intersections of elements of $\mathcal{F}$ and second by taking any union of what you have obtained. (Hint: Prove the resulting $\mathscr{T}$ is stable by finite intersection).
        \item Check that if you reverse these two operations, you need to do a third union again.
    \end{enumerate}
\end{ex}
\begin{defi}[Neighbourhood]\hypertarget{def:neighbourhood}
    Take $X$ a topological space.
    \begin{itemize}
        \item A \textbf{neighbourhood} $V$ of $x \in X$ is a subset of $X$ that contains $U \in \mathscr{T}_X$, such that $x \in U \subset V$.
        \item Call $\mathcal{V}(x)$ the \textbf{neighbourhood system} of all such subsets.
        \item Say $\mathcal{B}(x)$ is a \textbf{neighbourhood basis} if any $V \in \mathcal{V}(x)$ contains a $B \in \mathcal{B}(x)$.
    \end{itemize}
\end{defi}
\begin{prop}
    Consider $X$, $(Y_i)_{i \in I}$ topological spaces, and $\phi_i:X \to Y_i$ functions.
    Take $\mathscr{T}$ the \hyperlink{def:initTop}{initial topology} on $X$ as above, $x \in X$, then a possible \hyperlink{def:neighbourhood}{neighbourhood basis} is
    \begin{equation*}
        \mathcal{B}(x) \coloneqq \Set{\bigcap_{\text{finite}} \phi_i^{-1}(\omega_i) | \omega_i \text{ open set of } Y_i \text{ containing }\phi_i(x)}
    \end{equation*}
\end{prop}
\begin{proof}
    Use the 2 steps from the exercise. Consider any $V \in \mathcal{V}(x)$, $x \in U \subset V$ for $U$ open.
    \begin{equation*}
        U = \bigcup_{j \in J} \left(\bigcap_{n =1}^{N_j} \phi_{i_n^j}^{-1} (\omega_{j, i_n})\right)
    \end{equation*}
    Hence $\exists j_0 \in J$ such that
    \begin{equation*}
        x \in \bigcap_{n=1}^{N_{j_0}} \phi_{i_n^{j_0}}^{-1} (\omega_{j_0, i_n}) \text{ open}. \qedhere
    \end{equation*}
\end{proof}
\begin{ex}\leavevmode
    \begin{itemize}
        \item Prove that $x_n \to x$ in $(X, \mathscr{T}_{\text{\hyperlink{def:initTop}{initial}}})$ iff
            \begin{equation*}
                \phi_i(x_n) \to \phi_i(x) \text{ in } Y_i, \text{ for all } i \in I
            \end{equation*}
        \item $Z$ another topological space, $\phi: Z \to X$ is continuous ($X$ has the initial topology) iff $\phi_i \circ \phi: Z \to Y_i$ is continuous for all $i \in I$.
    \end{itemize}
\end{ex}
\begin{remark}
    The product topology on $(\bigotimes_{i \in I} X_i)$ where each $(X_i, \mathscr{T}_i)$ a topological space, is the \hyperlink{def:initTop}{initial topology} with $Y_i = X_i$ each with topology $\mathcal{T}_i$ and $\phi_i$ as the canonical projection
    \begin{equation*}
        \phi_i: (x_j)_{j \in I} \in \bigotimes_{j \in I} X_j \to x_i
    \end{equation*}
    Describe the $B((x_i)_{i \in I})$ as above.

    The induced (subspace) topology is the initial topology for the canonical embedding, and $Y_1$ the whole space.

    The quotient topology can be seen as a \hyperlink{def:finalTop}{final topology}.
\end{remark}
\begin{defi}\hypertarget{def:dualSpace}
    Take $E$ a normed vector space. Then $E'$ is the space of linear continuous forms to $\R$:
    \begin{equation*}
        F: E \to \R
    \end{equation*}
    The \hypertarget{def:weak}{\textbf{weak topology}} on $E'$, denoted $\sigma(E, E')$ is the \hyperlink{def:initTop}{initial topology} for the family of functions $E'$.
\end{defi}
It is the coarsest topology that makes all dual forms continuous.
\begin{prop}
    The weak topology $\hyperlink{def:weak}{\sigma(E, E')}$ on $E$ is Hausdorff: distinct points can be separated by disjoint open sets.
\end{prop}
\begin{proof}
    Take the third formulation of the \nameref{thm:hb} theorem:
    Given $f \neq g$ in $E$, set $A = \{f\}$ which is closed convex non-empty and $B=\{g\}$ compact convex. Clearly $A \cap B = \emptyset$.
    Hence $\exists F \in E'$, $\alpha \in \R$ such that $f \in U_1 \coloneqq \{F < \alpha\}$ and $g \in U_2 \coloneqq \{F > \alpha\}$, $U_1 \cap U_2 = \emptyset$ by definition.
\end{proof}
\begin{remark}\leavevmode
    \begin{itemize}
        \item In functional analysis, the term `strong topology' refers to the topology induced by the norm.
        Prove the weak topology $\hyperlink{def:weak}{\sigma(E, E')}$ is not more refined than the strong topology.
        \item In finite dimension, prove the weak topology is the same as the strong topology. Give a counter-example in infinite dimensions.
        \item Show strong/weak convergences can still agree, e.g.\ on $C^1(\R)$.
    \end{itemize}
\end{remark}
% Lecture number
\begin{remark}
    Given a normed vector space $E$, we constructed a dual space $E'$ (in previous courses called $E^*$) consisting of the linear continuous forms.
    This also gives the dual norm,
    \begin{equation*}
        \norm{F}_{E'} \coloneqq \sup\set{\abs{F(f)} | \norm{f}_E \leq 1}.
    \end{equation*}
    This gives a new normed vector space, and so we could continue onto $E''$, called the double dual.

    In infinite dimensions, the Bolzano-Weierstrass theorem fails, and we would like to restore it by creating a weaker topology $\sigma(E, E')$.
    We will soon see the Banach-Alaoglu-Bourbaki theorem gives us that the unit ball in the topology $\sigma(E'', E')$ is compact, and try to identify $E''$ and $E$ (reflexivity).
\end{remark}
% f \in E, F \in E', \varphi \in E''
\begin{defi}[Weak-$*$ topology]\hypertarget{def:weakStar}
    Take $E'$ a normed vector space dual to $E$, with the norm as given above.
    The \textbf{weak-$*$ topology} on $E'$, called $\sigma(E', E)$ is generated by the linear maps
    \begin{align*}\varphi_f: E' &\longrightarrow \R \\ F &\longmapsto F(f)\end{align*}
    for all $f \in E$ (\hyperlink{def:initTop}{initial topology}).
\end{defi}
\begin{ex}\leavevmode
    \begin{enumerate}[label=(\arabic*)]
      \item A simple consequence of \nameref{thm:hb} (I) is that
            \begin{equation*}
                \norm{f}_E = \max\set{\abs{F(f)} | F \in E', \norm{F}_E' \leq 1}.
            \end{equation*}

            Proof: The RHS $\leq$ LHS by definition of $\norm{F}_{E'} \leq 1$.
            Take $F_0: \R f \to R$, given by $F_0(tf) = t \norm{f}$, and extend $F_0$ to $F \in E'$ without increasing the $\norm{\cdot}_{E'}$.
        \item $(E', \norm{\cdot}_{E'})$ is complete (Hint: $\R$ is complete). So the dual space with the norm metric is Banach.
        \item Describe a basis of neighbourhoods for the (recall how we did it for the weak topology).
    \end{enumerate}
\end{ex}
\begin{prop}
    The weak-$*$ topology $(E', \sigma(E', E))$ is Hausdorff.
\end{prop}
\begin{proof}
    Let $F_1 \neq F_2$, so $\exists f \in E$ where $F_1(f) \neq F_2(f)$, and wlog $F_1(f) < \alpha < F_2(f)$ for $\alpha \in \R$.
    Then define
    \begin{align*}
        U_1 &\coloneqq \varphi_f^{-1}((-\infty, \alpha)) \\
        U_2 &\coloneqq \varphi_f^{-1}((\alpha, \infty)).
    \end{align*}
    These separate the points and are open.
\end{proof}
\begin{remark}
    We know have three topologies on $E'$:
    \begin{equation*}
        \text{weak-}* \subset \text{weak} \subset \text{strong}.
    \end{equation*}
    Exercise: prove these inclusions. Hint: for the left inclusion, observe that $\phi_f \in E''$.
\end{remark}
\begin{thm}[Banach-Alaoglu(-Bourbaki)]\label{thm:bab}
    The closed unit ball of $E'$ is weak-$*$ compact.
\end{thm}
Unpacking this, the closed unit ball of $E'$ refers to the subset
\begin{equation*}
    B_{E'} (0, 1) = \set{F \in E | \norm{F}_{E'} \leq 1}
\end{equation*}
and weak-$*$ refers to the topology $\sigma(E', E)$.
\begin{proof}[Proof sketch]
    The proof is non-examinable.
    The Tychonoff theorem says: Product of compact topological spaces is compact for the product topology.
    Now, consider
    \begin{equation*}
        D = \prod_{f \in E} D_f = \prod_{f \in E} [-\norm{f}_E, \norm{f}_E]
    \end{equation*}
    This is compact for the product topology.
    Now, embed
    \begin{equation*}
        F \in B_{E'}(0, 1) \overset{\Psi}{\longmapsto} (F(f))_{f \in E}
    \end{equation*}
    $\Psi$ is injective and bicontinuous (from $\sigma(E', E) \to $ product topology) with closed image.
\end{proof}

\begin{remark}
    This illustrates our idea that fewer open sets can give more compact sets.
    What if $E$ is separable?
    Now we can use a weaker argument than Tychonoff's theorem, which required AC.
    Instead, Cantor's diagonal argument suffices, as we will see soon.
\end{remark}
\clearpage
\subsection{Reflexivity}
\begin{aim}
    We have the \nameref{thm:bab} theorem on \hyperlink{def:weakstar}{$(E'', \sigma(E'', E'))$} giving compactness of closed balls, can we bring this back to \hyperlink{def:weak}{$(E, \sigma(E, E'))$, the weak topology}?
\end{aim}
\begin{defi}[Reflexive]\hypertarget{def:refl}
    A normed vector space $E$ is called \textbf{reflexive} if
    \begin{align*}
        \Phi: E &\longrightarrow \hyperlink{def:dualSpace}{E''} \\
        f &\longmapsto \varphi_f
    \end{align*}
    is surjective.
\end{defi}
\begin{ex}
  Prove that $\Phi$ is isometric (using \nameref{thm:hb}).
    To talk about isometry, we need to say which topology on \hyperlink{def:dualSpace}{$E''$} is of interest.
    Here, endow $E''$ \hypertarget{def:doubleDualNorm}{with}
    \begin{equation*}
        \norm{\varphi}_{E''} = \sup\set{\varphi(F) | F \in E', \norm{F}_{E'} \leq 1}.
    \end{equation*}

    Prove also that finite-dimensional normed vector spaces are \hyperlink{def:refl}{reflexive}.
\end{ex}
\begin{thm}[Kakutani's theorem]\label{thm:kaku}
    A Banach space $E$ is \hyperlink{def:refl}{reflexive} iff its closed unit ball is weakly compact. (Compact in \hyperlink{def:weak}{$\sigma(E, E')$}).
\end{thm}

Denote the closed unit ball in some space $M$ as by $\overline{B}_M$.
For one direction of this result, we make use of an important lemma by Goldstine:
\begin{lemma}[Goldstine's lemma]\label{lem:goldstine}
  For a Banach space $E$, $\hyperlink{def:refl}{\Phi(}\overline{B}_E)$ is dense in $\overline{B}_{E''}$ with the \hyperlink{def:weakStar}{weak-$*$} topology $\sigma(E'', E')$.
\end{lemma}
We defer the proof of this.
\begin{proof}[Proof of \nameref{thm:kaku}]
    $(\Rightarrow)$ By \hyperlink{def:refl}{reflexivity} (and isometry), $\overline{B}_E=\Phi^{-1}(\overline{B}_{E''})$ so it is enough to prove that
    \begin{equation*}
        \Phi^{-1}: (E'', \sigma(E'', E')) \longrightarrow (E, \sigma(E, E'))
    \end{equation*}
    is continuous.
    Then $\Phi^{-1}(\overline{B}_{E''})$ is weakly compact since BAB gives $\overline{B}_{E''}$ is weak-$*$ compact.

    This continuity property is equivalent to proving that $\forall F \in E'$,
    \begin{equation*}
        F \circ \Phi^{-1}: (E'', \sigma(E'', E')) \to \R
    \end{equation*}
    is continuous.
    For such an $F \in E'$, consider $\varphi \in E''$. $\varphi = \varphi_f$ for some $f$, so
    \begin{align*}
        F \circ \Phi^{-1} (\varphi) &= F \circ \Phi^{-1} (\varphi_f) \\ % reflexivity
                                 &= F(f) \\
                                 &=\varphi_f(F) = \varphi(F).
    \end{align*}
    Hence $\psi_F \coloneqq F \circ \Phi^{-1}: \varphi \in E'' \mapsto \varphi(F)$, which is one of the maps generating $\sigma(E'', E')$, hence continuous in this topology.

    $(\Leftarrow)$ The reverse implication relies on \nameref{lem:goldstine}, which gives that $\Phi(\overline{B}_E) \subset \overline{B}_{E''}$ is weak-$*$ dense.
    If it is weak-$*$ closed we are done, and we prove the stronger fact that it is compact (compact sets in a Hausdorff space are closed).
    We have that $\overline{B}_E$ is weakly compact, so it is enough to have that
    \begin{equation*}
        \Phi: (E, \sigma(E, E')) \longrightarrow (E'', \sigma(E'', E'))
    \end{equation*}
    is continuous. First we show $\Phi: (E, \sigma(E, E')) \to (E'', \sigma(E'', E'''))$ is continuous.
    This is equivalent to the statement that $\zeta \circ \Phi: (E, \sigma(E, E')) \to \R$ is continuous $\forall \zeta \in E'''$.

    However $\zeta: (E'', \norm{\cdot}_{E''}) \to \R$ is continuous, and $\Phi: (E, \norm{\cdot}_E) \to (E'', \norm{\cdot}_{E''})$ is continuous, so $\zeta \circ \Phi: (E, \norm{\cdot}_E) \to \R$ is continuous.
    Hence, $\zeta \circ \Phi \in E'$, so $\zeta \circ \Phi: (E, \sigma(E, E')) \to \R$ is continuous, by definition of the weak topology.

    Moreover, since the weak-$*$ topology is weaker than the weak topology, this implies that $\Phi: (E, \sigma(E, E')) \to (E'', \sigma(E'', E'))$ is continuous, giving the required result.
    % $\Phi$ is continuous $E \to E''$ with the strong topologies, so it is continuous for the weak topologies $(E, \sigma(E, E')) \longrightarrow (E'', \sigma(E'', E'''))$.
    % This means $\forall \zeta \in E'''$,
    % some missing things

    % We now claim that $\Phi(B_E(0, 1))$ is closed in $(E'', \norm{\cdot}_{E''})$.
    % Assuming the lemma, $\Phi(B_E(0, 1)) \subset B_{E''}(0, 1)$ is dense with topology $(\sigma(E'', E'))$. If closed % what is closed?
    % we are done, and we prove the stronger fact that it is compact.
    % It is enough to have that $\Phi(E, \sigma(E, E')) \to (E'', \sigma(E'', E'))$ is continuous.
    % First we show $\Phi: (E, \sigma(E, E')) \to (E'', \sigma(E'', E'''))$ is continuous.
    % This is equivalent to $\zeta \circ \Phi: (E, \sigma(E, E')) \to \R$ is continuous $\forall \zeta \in E'''$.
    % But $\zeta \circ \Phi: (E, \norm{\cdot}_{E}) \to \R$ is continuous, hence by definition $\zeta \circ \Phi$ is continuous in $\sigma(E, E')$.
    % Moreover, since the weak-$*$ topology is weaker than the weak topology, this implies that
    % $\Phi: (E, \sigma(E, E')) \to (E'', \sigma(E'', E'))$ is continuous.
\end{proof}

It now only remains to prove \nameref{lem:goldstine}.
\begin{proof}[Proof of \nameref{lem:goldstine}]
    Consider $\varphi \in \overline{B}_{E''}$ and $V$ a neighbourhood of $\varphi$ for $\sigma(E'', E')$ that we take to be (wlog)
    \begin{equation*}
        V = \Set{\psi \in E'' | \abs{\psi(F_i) - \varphi(F_i)} < \epsilon} \quad \text{for some $\epsilon > 0$, $F_1, \dotsc, F_k \in E'$}
    \end{equation*}
    Denote $\alpha_i \coloneqq \varphi(F_i)$. Our goal is to show
    \begin{align*}
        \exists f \in \overline{B}_E: \quad |\varphi_f(F_i) - \varphi(F_i)| &< \epsilon, \quad i = 1, \dotsc, k \tag{$*$}\label{2.4star}\\
        |F_i(f) - \alpha_i| &< \epsilon.
    \end{align*}
    Now observe that $\forall \vec{\beta} \in \R^k$,
    \begin{equation*}
        \abs{\vec{\alpha} \cdot \vec{\beta}} = \abs{\sum \beta_i \alpha_i} = \abs{\varphi\left(\sum \beta_i F_i\right)} \leq \norm{\sum_{i=1}^k \beta_i F_i}_{E'}
    \end{equation*}
    since $\norm{\varphi}_{E''} \leq 1$.

    Define the linear continuous map
    \begin{align*}
        H : E &\longrightarrow \R^k \\
        f &\longmapsto (F_1(f), \dotsc, F_k(f)),
    \end{align*}
    If property \eqref{2.4star} fails, then $\vec{\alpha} \notin \overline{H(\overline{B}_E)}$.
    But observe $\overline{H(\overline{B}_E)}$ is a closed, bounded convex subset of $\R^k$.
    Separation in $\R^k$ gives that $\exists \vec{\beta} \in \R^k$, $\gamma \in \R$ such that
    \begin{equation*}
        \forall f \in \overline{B}_E \quad H(f) \cdot \vec{\beta} < \gamma < \vec{\alpha} \cdot \vec{\beta}.
    \end{equation*}
    But this contradicts the earlier observation, since
    \begin{equation*}
        \norm{\sum_{i=1}^k \beta_i F_i}_{E'} = \sup_{\norm{f}_E \leq 1} \left(H(f) \cdot \vec{\beta}\right) \leq \gamma < \vec{\alpha} \cdot \vec{\beta}. \qedhere
    \end{equation*}
\end{proof}

\begin{remark}
  We proved that $\hyperlink{def:refl}{\Phi}(\overline{B}_E)$ is \hyperlink{def:weakStar}{weak-$*$} dense in $\overline{B}_{E''}$.
  Observe it is also strongly closed in \hyperlink{def:doubleDual}{$E''$}: If $\Phi(f_n)$ is convergent in $(E'', \|\cdot\|_{E''})$, it is Cauchy.
  $\Phi$ is an isometry, so $f_n$ is also Cauchy in $E$, hence converges.
  So, $\lim \Phi(f_n) = \Phi(\lim f_n) \in \Phi(\overline{B}_E)$, and so $\Phi(\overline{B}_E)$ is never dense in $\overline{B}_{E''}$ when $E$ is not reflexive.
\end{remark}

\begin{cor}\leavevmode
    \begin{enumerate}[label=(\roman*)]
        \item A closed subspace of a \hyperlink{def:refl}{reflexive} Banach space is reflexive.
        \item A Banach space $E$ is reflexive iff $E'$ is reflexive.
    \end{enumerate}
\end{cor}
\begin{proof}\leavevmode
    \begin{enumerate}[label=(\roman*)]
        \item Take $M$ a closed subspace of $E$, then check (exercise) $\sigma(E, E') \cap M = \sigma(M, M')$.
            In addition, $\overline{B}_M$ is strongly closed, hence is $\sigma(E, E')$ closed (see sheet 2, question 2(ii)).
            By \nameref{thm:kaku}, $\overline{B}_E$ is $\sigma(E, E')$ compact, and hence $\overline{B}_M$ is a closed subset of a compact set, hence compact in $\sigma(E, E')$ and so compact in $\sigma(M, M')$.
            Again using \nameref*{thm:kaku}, this gives that $M$ is reflexive.
        \item ($\Rightarrow$) The identification $\Phi$ of $E$ with $E''$ shows $\sigma(E', E) = \sigma(E', E'')$.
            Thus \nameref{thm:bab} shows $\overline{B}_{E'}$ is compact in $\sigma(E', E'')$ so also $\sigma(E', E)$ compact.
            Hence by \nameref{thm:kaku}, $E'$ is reflexive.

            ($\Leftarrow$) Conversely, if $E'$ is reflexive then by the ($\Rightarrow$) direction, $E''$ is reflexive, and $\Phi(E)$ is a closed subspace of $E''$ hence reflexive.
            $E$ is isometric to it, so is reflexive. \qedhere
    \end{enumerate}
\end{proof}

\color{gray}
\begin{remark}[Not lectured]
  Alternate proof of (i): Let $\tilde{\varphi} \in M''$, and define $\varphi \in E''$ by $\varphi(F) = \tilde{\varphi}(F|_M)$.
  $E$ is reflexive, so $\varphi = \Phi(f_0)$ for some $f_0 \in E$.
  If $f_0 \notin M$, use Hahn-Banach (III) to separate $M$ and $\{f_0\}$, giving $F \in E'$ such that $\forall f \in M$, $F(f) < \alpha < F(f_0)$, hence $F|_M \equiv 0$.
  Then $0 = \tilde{\varphi}(0) = \tilde{\varphi}(F|_M) = \varphi(F) = \Phi(f_0)(F) = F(f_0) > 0$, a contradiction.
  It remains to show $\Phi|_M(f_0) = \tilde{\varphi}$. Let $\tilde{F} \in M'$, and use Hahn-Banach to extend to $F \in E'$, then
  \begin{align*}
    \Phi|_M(f_0)(\tilde{F}) &= \tilde{F}(f_0) = F(f_0)\\
                                  &= \Phi(f_0)(F) = \varphi(F) \\
                                  &= \tilde{\varphi}(F|_M) = \tilde{\varphi}(\tilde{F})
  \end{align*}
\end{remark}
\color{black}

\begin{defi}[Uniform convexity]\hypertarget{def:uc}
    A Banach space $E$ is called \textbf{uniformly convex} if $\forall \epsilon > 0$, $\exists \delta > 0$ such that $\forall f, g \in \overline{B}_E$, $\norm{f-g}_E > \epsilon \implies \norm{\frac{f+g}{2}}_E < 1 - \delta$.
\end{defi}
\begin{eg}
  The supremum norm and the $1$ norm in $\mathbb{R}^n$ are not reflexive, but the $p$ norm for $p \in (1, \infty)$ is.
    % pictures
    % sup norm in R^n and l1 norm are not UC but p norm for p in (1, inf) is.
\end{eg}

% Lecture number
\begin{thm}[Milman-Pettis]
    Any \hyperlink{def:uc}{uniformly convex} Banach space is \hyperlink{def:refl}{reflexive}.
\end{thm}
\begin{proof}
    Since $\Phi(\overline{B}_E)$ is closed in $(E'', \|\cdot\|_{E''})$, it is enough to prove that it is dense in $\overline{B}_{E''}$ in the strong topology.
    Consider $\varphi \in E''$, and say wlog that $\norm{\varphi}_{E''} = 1$. Let $\epsilon > 0$ so $\exists \delta$ with
    \begin{equation*}
        \|f - g\|_E > \epsilon \implies \left\|\frac{f+g}{2}\right\|_E < 1 - \delta.
    \end{equation*}
    By definition of $\|\cdot\|_{E''}$, $\exists F \in \overline{B}_{E'}$ such that $|\varphi(F)| > 1 - \frac{\delta}{2}$.

    The set $V = \set{\psi \in E'' | \abs{\psi(F) - \varphi(F)} < \frac{\delta}{2}}$ is $\sigma(E'', E')$ open.
    \nameref{lem:goldstine} gives that $\exists f \in \overline{B}_E$ such that $\Phi(f) \in V$.
    If $\norm{\Phi(f) - \varphi}_{E''} \leq \epsilon$, we are done.

    If not, define $\varphi \in W \coloneqq (\Phi(f) + \epsilon \overline{B}_{E''})^c$.
    Observe $\overline{B}_{E''} = \bigcap_{\|F\|_{E'} \leq 1} T_F^{-1}([-1, 1])$, where $T_F(\varphi) = \varphi(F)$, so $T_F$ weak-$*$ continuous and so $\overline{B}_{E''}$ is $\sigma(E'', E')$ closed.

    Hence, $W$ is open in $\sigma(E'', E')$, so, $V \cap W$ is open and non-empty (contains $\varphi$).
    Using \nameref*{lem:goldstine} again, $\exists g \in \overline{B}_E$, $\Phi(g) \in V \cap W$.
    \begin{gather*}
        \Phi(f) \in V \implies \bigg|\underbrace{\Phi(f)(F)}_{F(f)} - \varphi(F)\bigg| < \frac{\delta}{2} \\
        \Phi(g) \in V \implies \bigg|\underbrace{\Phi(g)(F)}_{F(g)} - \varphi(F)\bigg| < \frac{\delta}{2} \\
        \Phi(g) \in W \implies \norm{f-g} > \epsilon
    \end{gather*}
    The first two give $2 \varphi(F) \leq F(f+g) + \delta$, so $|\varphi(F)| \leq \left\|\frac{f+g}{2}\right\|_E + \frac{\delta}{2}$ and $\norm{f+g \over 2}_E \geq 1 - \delta$.
    But this together with $\norm{f-g} > \epsilon$ contradicts uniform convexity.
\end{proof}
\begin{notation}
    For a sequence $(f_n)$ in $E$, $f_n \weakconv f$ means $f_n$ converges to $f$ in the weak $(\sigma(E, E'))$ topology.
\end{notation}
\begin{prop}
    Take $E$ a \hyperlink{def:uc}{uniformly convex} Banach space, then a sequence $f_n$ of $E$ converges strongly to $f \in E$ iff $f_n \rightharpoonup f$ and $\norm{f_n} \to \norm{f}$.
\end{prop}
\begin{proof}
    $(\Rightarrow)$ left as an exercise.
    $(\Leftarrow)$ Consider $f_n \weakconv f$ with $\norm{f_n} \to \norm{f}$. If $f = 0$ we are done. Assume $f \neq 0$ and $ n \geq n_0$, $n_0$ large enough such that $\norm{f_n} \neq 0$.
    For $n \geq n_0$: take
    \begin{equation*}
        g_n \coloneqq \frac{f_n}{\norm{f_n}}, \quad g \coloneqq \frac{f}{\norm{f}}
    \end{equation*}
    and we aim to show $\norm{g_n - g} \to 0$.
    Observe that $\frac{g_n + g}{2} \in \overline{B}_E$, and $g_n \weakconv g$, as $\forall F \in E'$, $F(g_n) \to F(g)$:

    \begin{equation*}
        F\left(\frac{f_n}{\norm{f_n}}\right) = \frac{1}{\norm{f_n}} F(f_n) \longrightarrow \frac{1}{\norm{f}} F(f) = F(g)
    \end{equation*}
    since these are just converging sequences.

    Thus $\frac{g_n + g}{2} \weakconv g$ by linearity.
    Claim: Then $1=\norm{g} \leq \liminf_{n} \norm{\frac{g_n + g}{2}}$.
    Hence $\norm{\frac{g_n+g}{2}} \to 1$, as $\norm{\frac{g_n+g}{2}} \leq 1$ and UC implies that $\norm{g_n - g} \to 0$ and finally $\norm{f_n - f} \to 0$.

    It remains to prove the claim: If $h_n \weakconv h$ then $\norm{h}_E \leq \liminf \norm{h_n}_E$.
    Given $\epsilon > 0$, $\exists F \in \overline{B}_{E'}$ such that $F(h) \geq \norm{h}_E - \epsilon$, and so $\norm{h}_E \leq \epsilon + \lim F(h_n)$.
    But since $F(h_n) \leq \norm{h_n}_E$, this gives $\norm{h}_E \leq \epsilon + \liminf \norm{h_n}_E$ for any $\epsilon > 0$, proving the claim.
\end{proof}

\clearpage
\subsection{Separability}
\begin{defi}[Separable space]\hypertarget{def:separable}
  A topological space $X$ is \textbf{separable} if it contains a dense countable subset.
\end{defi}
\begin{ex}
    If $Y \subset X$ and $X$ a \hyperlink{def:separable}{separable} metric space, prove $Y$ is separable in the induced topology.
\end{ex}
\begin{prop}
  Take a Banach space $E$ with $(E', \|\cdot\|_{E'})$ \hyperlink{def:separable}{separable}. Then $(E, \|\cdot\|_{E})$ is separable.
\end{prop}
\begin{proof}
  Take $(F_n)$ dense in $(E', \|\cdot\|_{E'})$, and for each $n \geq 1$ pick $f_n \in B_E$ such that $F_n(f_n) \geq \frac{1}{2} \norm{F_n}_{E'}$ (by definition of $\|\cdot\|_{E'}$).
  $L = \spn \{(f_n)\}$ is separable (linear combinations with rational coefficients). Let us prove $L$ is dense in $(E, \|\cdot\|_E)$, which is enough to conclude.

  Claim: If $F \in E'$ is zero on $L$, then $F \equiv 0$. Using density of $(F_n)$, given $\epsilon > 0$, $\exists n_0 \geq 1$ such that $\|F - F_{n_0}\|_{E'} \leq \epsilon$.
    \begin{equation*}
        \norm{F_{n_0}}_{E'} \leq 2 F_{n_0} (f_{n_0}) = 2 (F_{n_0} - F)(f_{n_0}) \leq 2\epsilon
    \end{equation*}
    where the first inequality comes from the construction of $f_n$.
    Thus $\norm{F_{n_0}}_{E'} \leq 2 \epsilon$ and so $\norm{F}_{E'} \leq 3 \epsilon$. But this holds $\forall \epsilon > 0$, so $F = 0$.

    It implies that $L$ is dense in $E$:
    Otherwise use \nameref{thm:hb} (III) to separate $A = \overline{L}$, $B = \{f_0\}$ with $f_0 \in E \setminus L$.
    This gives $G \in E'$, $\alpha \in \R$ such that $\forall f \in L$, $G(f) < \alpha < G(f_0)$.
    This implies $G|_L \equiv 0$ by linearity, so $G \equiv 0$ by the earlier claim, a contradiction.
\end{proof}
\begin{ex}
    $E$ is Banach reflexive separable iff $E'$ is Banach reflexive separable.
\end{ex}
\begin{prop}
    A Banach space $E$ is separable iff $(\overline{B}_{E'}, \sigma(E', E))$ is metrisable.
\end{prop}
\begin{proof}
  $(\Rightarrow)$ Take $\{f_n\}$ a countable sequence dense in $\overline{B}_E$. Then for $F,G \in \overline{B}_{E'}$, define
  \begin{equation*}
    D(F,G) \coloneqq \sum_{n \geq 1} \frac{|F(f_n) - G(f_n)|}{2^n}
  \end{equation*}
  This is well defined, as partial sums are bounded by $\|F-G\|_{E'}$.
  It is a distance: The triangle inequality is obtained in the limit from partial sums. If $D(F,G) = 0$, then $F=G$ on $\{f_n\}$, hence they agree on $\overline{B}_E$, and hence on $E$.

  Claim: $D$ metrizes $\sigma(E', E)$ on $\overline{B}_{E'}$.
  For $F \in \overline{B}_E$, consider a $D$-neighbourhood
  \begin{equation*}\set{G \in \overline{B}_{E'} | D(F,G) < \epsilon}.\end{equation*}
  It contains the $\sigma(E', E)$-neighbourhood
  \begin{equation*}\Set{G \in \overline{B}_{E'} | \left|G(f_i) - F(f_i)\right| < \frac{\epsilon}{2}\ \forall i=1,\dotsc,n_0}\end{equation*}
  for $n_0$ satisfying $2 \sum_{n \geq n_0} \frac{1}{2^n} \leq \frac{\epsilon}{2}$.

  Vice versa, given a $\sigma(E',E)$-neighbourhood of $F$
  \begin{equation*}U\coloneqq\Set{G \in \overline{B}_{E'} | \left|G(g_i) - F(g_i)\right| < \epsilon\ \forall i=1,\dotsc,k}\end{equation*}
  then, by density, for each $i=1,\dotsc,k$, $\exists n_i$ such that $\|f_{n_i} - g_i\|_E < \frac{\epsilon}{3}$ and
  consider the $D$-neighbourhood
  \begin{equation*}
    V\coloneqq \Set{G \in \overline{B}_{E'} | D(F,G)< \frac{\epsilon}{3} \cdot 2^{-\max n_i}}.
  \end{equation*}
  If $G \in V$ then $D(F, G) < \frac{\epsilon}{3}\cdot2^{-\max n_i}$ implies $|F(f_{n_i}) - G(f_{n_i})| < \frac{\epsilon}{3}\ \forall i = 1\dotsc k$ hence
  \begin{equation*}
    |G(g_i) - F(g_i)| \leq \underbrace{|G(g_i)-G(f_{n_i})|}_{< \frac{\epsilon}{3}} + |G(f_{n_i})-F(f_{n_i})| + \underbrace{|F(f_{n_i})-F(g_i)|}_{< \frac{\epsilon}{3}} < \epsilon.
  \end{equation*}
  so $V \subset U$, as required.

  $(\Leftarrow)$ Conversely suppose $D$ is a distance on $(\overline{B}_{E'}, \sigma(E', E))$. For all $n \geq 1$,
  \begin{equation*}
    U_n \coloneqq \Set{G \in \overline{B}_E | D(G, 0) < \frac{1}{n}}
  \end{equation*}
  is open around $0$, so there is
  \begin{equation*}
    V_n = \set{G \in \overline{B}_E | \abs{G(f)}< \epsilon_n,\, f \in C_n} \subset U_n
  \end{equation*}
  with $\epsilon_n > 0$ and $C_n \subset E$ finite.
  Then $C_\infty \coloneqq \bigcup_{n \geq 1} C_n$ is countable, and $\bigcap_{n \geq 1} V_n = \{0\}$.
  Since $F|_{C_\infty} \equiv 0$ implies $F \in \bigcap_{n \geq 1} V_n$ i.e.\ $F \equiv 0$, it follows that $C_\infty$ is dense in $E$, following the argument at the end of the previous proof.
\end{proof}
\begin{prop}[`Countable BAB']\leavevmode
    \begin{enumerate}[label=(\roman*)]
        \item Take $E$ a Banach separable space, then closed bounded subsets of $E'$ are sequentially weak-$*$ compact ($\sigma(E', E)$).
        \item Take $E$ a Banach reflexive, then closed bounded subsets of $E$ are sequentially weakly compact ($\sigma(E, E')$).
    \end{enumerate}
\end{prop}

% missing things
\begin{proof}\leavevmode
    \begin{enumerate}[label=(\roman*)]
      \item Enough to prove that any $(F_n)$ sequence of $\overline{B}_E$ has a converging subsequence in $\sigma(E', E)$.
        Take $(f_k)$ dense in $E$, then $\forall k \geq 1$, $(F_n(f_k))_{k \geq 1}$ is a real sequence in $[-\|f_k\|,\|f_k\|]$.
        Hence by Bolzano-Weierstrass it has a converging subsequence.

        Using the Cantor diagonal process, $\exists \theta:\mathbb{N} \to \mathbb{N}$ strictly increasing such that $\forall k \geq 1$, $(F_{\theta(n)}(f_k))_{n \geq 1}$ converges.

        Let $f \in E$, then for any $\epsilon > 0$, there is $f_{k_0}$ such that $\|f - f_{k_0}\|_E \leq \frac{\epsilon}{3}$ by density.
        $(F_{\theta(n)}(f_{k_0}))_{n \geq 1}$ is Cauchy, so $\exists N \in \mathbb{N}$ such that
        \begin{equation*}
          \forall n_1, n_2 \geq N, \ \abs{F_{\theta(n_1)}(f_{k_0}) - F_{\theta(n_2)}(f_{k_0})} \leq \frac{\epsilon}{3}.
        \end{equation*}
        So using the triangle inequality,
        \begin{equation*}
          \forall n_1, n_2 \geq N, \ \abs{F_{\theta(n_1)}(f) - F_{\theta(n_2)}(f)} \leq \epsilon.
        \end{equation*}
        Hence, $(F_{\theta(n)}(f))$ is Cauchy in $\mathbb{R}$ and hence convergent, so $(F_{\theta(n)})$ is weak-$*$ convergent.
        \item Enough to prove $(f_n)$ sequence in $\overline{B}_E$ has a converging subsequence in $\sigma(E, E')$.
            Let $L$ be the closure of $\spn\{f_n\}$ in $E$. This is separable (take rational linear combinations).
            It is reflexive: $(\overline{B}_L, \sigma(L, L'))$ is weakly compact by restriction, and use \nameref{thm:kaku}.
            Then $(\overline{B}_L, \sigma(L, L'))$ identifies with $(\overline{B}_{L''}, \sigma(L'', L'))$ and $L'$ is separable so part (i) implies $(\overline{B}_{L''}, \sigma(L'', L'))$ is sequentially compact, hence so is $(\overline{B}_L, \sigma(L, L'))$.
    \end{enumerate}
\end{proof}
\subsection{Concrete functional spaces}
We have shown $L^p(\R)$ is separable for $p \in [1, \infty)$, and a Banach space.
\begin{thm}[Riesz representation]
    $L^p(\R)$ for $p \in (1, \infty)$ is reflexive.
    Moreover its dual identifies isometrically with $L^{p'}(\R)$ with $p' = \frac{p}{p-1} \in (1, \infty)$, with $g \in L^{p'}(\R) \mapsto F_g \in L^p(\R)'$, where $F_g(f) \coloneqq \int_\R f g \, d\mu$.
\end{thm}
\begin{proof}\leavevmode
  \begin{enumerate}[label=\arabic*)]
    \item In the case $p \in [2,\infty)$, show the first Clarkson inequality:
    \begin{equation*}
        \abs{\frac{x+y}{2}}^p + \abs{\frac{x-y}{2}}^p \leq \frac{\abs{x}^p + \abs{y}^p}{2}
    \end{equation*}
    which extends the parallelogram identity.

    Proof:
    Let $\theta \in [0, 1]$. $\theta^{\frac{p}{2}} + (1-\theta)^{\frac{p}{2}} \leq \theta + (1-\theta) = 1$, hence for $a, b \geq 0$ not both zero, $a^p + b^p \leq (a^2 + b^2)^{\frac{p}{2}}$.
    Taking $a = \abs{\frac{x+y}{2}}$, $b = \abs{\frac{x-y}{2}}$,
    \begin{align*}
        \abs{\frac{x+y}{2}}^p + \abs{\frac{x-y}{2}}^p &\leq \left(\abs{\frac{x+y}{2}}^2 + \abs{\frac{x-y}{2}}^2\right)^{\frac{p}{2}} \\
                                                      &\leq \left(\frac{x^2+y^2}{2}\right)^{\frac{p}{2}} \\
                                                      &\leq \frac{\abs{x}^p + \abs{y}^p}{2}
    \end{align*}
    where the parallelogram identity was used and the convexity of $\theta(r) = r^{p/2}$.

  \item Integrate with `$x=f$', `$y=g$':
    \begin{equation*}
        \forall f, g \in L^p(\R) \quad \norm{\frac{f+g}{2}}^p_{L^p} + \norm{\frac{f-g}{2}}^p_{L^p} \leq \frac{\norm{f}^p_{L^p} + \norm{g}^p_{L^p}}{2}
    \end{equation*}
    Then take $\norm{f} \leq 1, \norm{g} \leq 1$, $\|f-g\| > \epsilon$, so
    \begin{equation*}\left\|\frac{f+g}{2}\right\|_{L^p}^p \leq 1 - \left(\frac{\epsilon}{2}\right)^p\end{equation*}
    proving \hyperlink{def:uc}{uniform convexity}.
  \item Now consider $p \in (1,2)$ and $p'=p/(p-1) \in [2, \infty)$. Define
    \begin{align*}
      \mathcal{F}:L^p &\longrightarrow (L^{p'})' \\
      u &\longmapsto F_u
      \shortintertext{where}
      F_u(f) &= \int_\mathbb{R} uf\,dx.
    \end{align*}
    This is well defined by H\"older's inequality, since $\frac{1}{p} + \frac{1}{p'} = 1$.
    $\mathcal{F}$ is linear, and
    \begin{align*}
      |F_u(f)| &\leq \|f\|_{p'} \times \|u\|_p \\
      \implies \|F_u\|_{(L^{p'})'} &\leq \|u\|_p.
    \end{align*}
    Moreover with $f = |u|^{p-2} u \in L^{p'}$, $\|f\|_{L^{p'}} = \|u\|_{L^p}^{p-1}$ and
    \begin{gather*}
      |F_u(f)| = \int_\mathbb{R} |u|^p = \|u\|_{L^p} \|u\|_{L^p}^{p-1} = \|u\|_{L^p} \|f\|_{L^{p'}} \\
      \implies \|F_u\|_{(L^{p'})'} = \|u\|_{L^p}
    \end{gather*}
    so $\mathcal{F}$ is an isometry.
    Note then by completeness, $\mathrm{im}(\mathcal{F})$ is closed. So $\mathcal{F}(L^p)$ is a closed subspace $(L^{p'})'$.
    In 2) we proved $L^{p'}$ is reflexive and separable, hence so is its dual, and any closed subspace of the dual is also.
    Finally, $\mathcal{F}(L^p)$ is reflexive, so $L^p$ is.
  \item Take $p \in (1, \infty)$. Define
    \begin{align*}
      \mathcal{G}:L^{p'} &\longrightarrow (L^p)' \\
      g &\longmapsto F_g
      \shortintertext{where}
      F_g(f) &\coloneqq \int_\mathbb{R} gf\,dx.
    \end{align*}
    As before, $\mathcal{G}$ is linear and isometric, and $\mathcal{G}(L^{p'})$ is a closed subspace of $(L^p)'$.
    It remains to prove surjectivity, and density is sufficient.
    By the usual \nameref{thm:hb} argument, it suffices to show that $\forall \varphi\in (L^p)''$, if $\varphi \equiv 0$ on $\mathcal{G}(L^p)$ then $\varphi \equiv 0$.
    But by reflexivity of $L^p$, $\varphi = \varphi_h = \Phi(h)$ for $h \in L^p$.
    Let $g = |h|^{p-2} h \in L^{p'}$.  Then
    \begin{align*}
      0 = \varphi(F_g) &= \varphi_h(F_g) \\
                   &= F_g(h) \\
                   &= \int_\mathbb{R} gh\,d\mu \\
                   &= \int_\mathbb{R} |h|^p.
    \end{align*}
    So $h = 0$, hence $\varphi \equiv 0$, as required. \qedhere
  \end{enumerate}
\end{proof}
\subsubsection*{The case of $L^1$}
\begin{thm}
    $(L^1(\R))'$ identifies isometrically with $L^\infty(\R)$.
    That is, $\forall F \in (L^1(\mathbb{R}))'$, $\exists g \in L^\infty(\mathbb{R})$ such that
    \begin{equation*}
      F(f) = \int_\mathbb{R} fg \,d\mu.
    \end{equation*}
\end{thm}
\begin{proof}
\end{proof}
\begin{cor}
    $L^1$ is not reflexive.
\end{cor}
\begin{proof}
\end{proof}
\subsubsection*{$L^\infty(\R)$ spaces}
Recall
\begin{itemize}
    \item $(L^1)' = L^\infty$, hence we get weak-$*$ compactness of the unit ball, since $L^\infty$ is realised as a dual space.
    \item $L^\infty(\R)$ is not separable, e.g.\ $(\chi_{[-R, R]})_{R > 0}$ is an uncountable family of elements all separated by distance 1.
    \item The dual of $L^\infty(\R)$ is not $L^1(\R)$ hence $L^\infty$ is not reflexive.
\end{itemize}
\begin{prop}
    $(L^\infty)'$ is strictly greater than $L^1$.
\end{prop}
\begin{remark}
    What is the dual of $L^\infty$? In fact $(L^\infty)'$ identifies with finite additive measures on $\R$, absolutely continuous with respect to Lebesgue measure.
\end{remark}
\subsubsection*{The case of $L^2(\R)$}
\begin{prop}
    Say $H$ a Hilbert space, $C \subset H$, $C$ closed, convex, non-empty.
    Then $\forall x \in H$, $\exists$ unique $P_c(x) \in C$ such that $\norm{x - P_c(x)} = d(x, C)$.
    Note $P_c$ is a Lipschitz mapping with constant 1.
\end{prop}
\begin{thm}[Riesz Representation for Hilbert spaces]
    $H$ a Hilbert space, $F \in H'$, then $\exists ! y \in H$ such that $\forall x \in H$, $F(x) = \langle x , y\rangle$.
\end{thm}
\begin{proof}
\end{proof}
\subsubsection*{Subspace of continuous functions}
$C_c^0 \subset (L^p, \norm{\cdot}_p)$ is dense.  But, $C_c^0 \subset (L^\infty, \norm{\cdot}_\infty)$ has closure
\begin{equation*}
    C_0(\R) = \{ \text{continuous functions with tails going to 0}\}.
\end{equation*}
Note $(L^\infty)'$ is not usable but we have
\begin{thm}[Riesz-Markov]
    The dual of $C_0(\R)$ is the space of real valued Radon measures.
\end{thm}
\subsection{Baire's theorems: Local to Global}
\begin{lemma}[Baire]
    Let $X$ be a complete metric space.
    \begin{enumerate}[label=(\roman*)]
        \item A countable intersection of open dense sets is dense.
        \item A countable union of closed sets with empty interior has empty interior.
        \item If $X = \bigcup_n C_n$ with $C_n$ closed, then at least one of them has non-empty interior.
    \end{enumerate}
\end{lemma}
\begin{thm}[Banach-Steinhaus]
    Take $E_1$, $E_2$ Banach spaces.
    \begin{enumerate}[label=(\roman*)]
        \item Say $(T_i)_{i \in I}$ is a family of continuous maps $E_1 \to E_2$ such that
            \begin{equation*}
                \forall f \in E_1, \sup_{i \in I} \norm{T_i f}_2 < \infty.
            \end{equation*}
            Then $\exists C > 0$ such that $\forall i \in I$, $\forall f \in E_1$,
            \begin{equation*}
                \norm{T_i f}_2 \leq C \norm{f}_1.
            \end{equation*}
        \item Given a sequence $T_n$ of continuous linear maps $E_1 \to E_2$ such that $\forall f \in E_1$, $T_n f \to Tf$ in $E_2$, (for $T: E_1 \to E_2$) then $T$ is continuous and linear, and $\sup_n \norm{T_n} < \infty$ and $\norm{T} \leq \liminf_n \norm{T_n}$.
        \item A subset $B \subset E_1$ is bounded iff $\forall F \in E_1'$, $F(B) \subset \R$ is bounded.
        \item $B' \subset E'$ is bounded iff $\forall f \in E$, $\phi_f(B') \subset \R$ is bounded.
    \end{enumerate}
\end{thm}
\begin{proof}
\end{proof}
\begin{remark}
    (iii) means `weakly bounded' is equivalent to `strongly bounded', and that weak convergence implies boundedness. (iv) implies that weak-$*$ convergence implies boundedness.
\end{remark}
% Chapter 2
% I) Recalls on normed vector spaces (LA)
% II) Hahn-Banach (LA)
% III) Duality and weak topologies
% IV) Reflexivity
% V) Separability
% VI) L^p spaces
% VII) Recalls on Baire's category theorem and consequences
\end{document}
